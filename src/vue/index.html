<meta http-equiv="content-type" content="name/html; charset=UTF-8"/>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.0.3/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/1.0.3/vue-resource.min.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css">

<style>
    ::-webkit-scrollbar {
        display: none;
    }

    html {
        background: #f6f6f6;
        overflow: hidden;
    }

    body {
        background: white;
        margin: 0;
        padding: 0;
    }

    .top {
        position: fixed;
        top: 0px;
        width: 100%;
        display: block;
        background: white;
        padding: 5px;
        height: 85px;
        color: #ef835d;
        font-size: 200%;
        text-align: center;
        border-bottom: 1px solid #d1d1d1;
        box-shadow: 0 1px 2px rgba(0, 0, 0, .1);
    }

    .middle {
        background: #f6f6f6;
        /*margin-top: 50px;*/
        width: 100%;
        height: 100%;
        color: #ef835d;
        color: black;
        font-size: 200%;
        text-align: center;
        overflow-y: scroll;
        border-top: 1px solid #d1d1d1;
    }

    .bottom {
        position: fixed;
        bottom: 0px;
        width: 100%;
        /*background: red;*/
        background: #01579B;
        padding: 5px;
        height: 40px;
        color: white;
        font-size: 30px;
        text-align: center;
        border-top: 1px solid #d1d1d1;
    }

    .sidenav {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 1;
        top: 0;
        left: 0;
        background-color: #111;
        overflow-x: hidden;
        transition: 0.2s;
        padding-top: 60px;
        box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
    }

    .sidenav a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: 25px;
        color: #818181;
        display: block;
        transition: 0.2s;
    }

    .sidenav a:hover {
        color: #f1f1f1;
    }

    .sidenav .closebtn {
        position: absolute;
        top: 0;
        right: 5px;
        font-size: 36px;
        margin-left: 50px;
    }

    #main {
        transition: margin-left .2s;
    / / padding: 16 px;
    }

    @media screen and (max-height: 450px) {
        .sidenav {
            padding-top: 15px;
        }

        .sidenav a {
            font-size: 18px;
        }
    }

    ul {
        padding-inline-start: 0;
        font-size: 25px;
        /*text-shadow: #000 0.15em 0.15em 0.15em;*/
    }

    li {
        list-style-type: none;
        color: white;
        padding: 20px;
        border-bottom: solid 1px black;
    }

    li:hover {
        background: whitesmoke;
        color: black;
    }

    .active {
        background: white;
        color: black;
    }
</style>

<div id="app">
    <div id="mySidenav" class="sidenav">
        <div style="color: white;margin-top: -48px;margin-left: 12px;font-size: 30px;width: 200px;">
            Yard Management System
        </div>
        <div style="color: white;margin-top: 20px;margin-left: 15px;font-size: 20px;width: 200px;">
            by Eduard Tkachuk
        </div>
        <ul>
            <a href="" class="closebtn" onclick="event.preventDefault();closeNav()"> &times;</a>

            <li v-on:click="changeRoute('dispatcher')" v-bind:class="{ active: dispatcher }">
                <i class="fas fa-user-friends"></i><span style="margin: 15px;">Dispatcher</span></li>

            <li v-on:click="changeRoute('gatekeeper')" v-bind:class="{ active: gatekeeper }">
                <i class="fas fa-key"></i><span style="margin: 15px;">Gatekeeper</span></li>

            <li v-on:click="changeRoute('driver-reg')" v-bind:class="{ active: driver }">
                <i class="fas fa-truck-moving"></i><span style="margin: 15px;">Driver</span></li>

        </ul>
    </div>

    <div id="main">
        <div class="middle">
            <router-view></router-view>
        </div>
    </div>
</div>
</div>

<script>
    const appConfig = new Vue();
    appConfig.route = 'dispatcher';

    const Dispatcher = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top></top>
                        </div>
                            <div>
                                <div style="width: 49%;padding: 0 5px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                                    <vehicles-items></vehicles-items>
                                </div>
                                <div style="width: 49%;padding: 0 5px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                                    <locations-items></locations-items>
                                </div>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>
                    </div>`
    };
    const VehiclesEdit = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top></top>
                        </div>
                            <div>
                                <div style="margin-top:100px; width: 49%;padding: 0 5px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                                    <vehicle-edit></vehicle-edit>
                                </div>
                                <div style="width: 49%;padding: 0 5px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                                    <locations-items></locations-items>
                                </div>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>`
    };
    const VehicleAdd = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top></top>
                        </div>
                            <div>
                                <div style="margin-top:100px; width: 49%;padding: 0 5px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                                    <vehicle-add></vehicle-add>
                                </div>
                                <div style="width: 49%;padding: 0 5px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                                    <locations-items></locations-items>
                                </div>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>`
    };

    const DriverReg = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top></top>
                        </div>
                            <div>
                                <driver-reg></driver-reg>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>`
    };
    const DriverStatus = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top></top>
                        </div>
                            <div>
                                <driver-status></driver-status>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>`
    };

    Vue.component('top', {
        template: `<div>
        <div style="float: left; margin: 20px; margin-top: -3px;">
                <span title="Show menu" style="font-size:40px;cursor:pointer; color: black" onclick="openNav()">&#9776;</span>
        </div>
        <div style="float: left; margin: -34px 0px 0px 50px;">
                <span title="All" style="font-size:25px;cursor:pointer; color: black" v-on:click="filterStatusL('*')"><i class="fas fa-filter"></i></span>
                <span title="Vacated" style="color: #eee !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatusL('blank')"><i class="fas fa-filter"></i></span>
                <span title="Booked" style="color: green !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatusL('booked')"><i class="fas fa-filter"></i></span>
                <span title="Docked" style="color: red !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatusL('docked')"><i class="fas fa-filter"></i></span>
        </div>
        <div style="margin-top: 15px; color: red; font-size: 50px;margin-right: 100px;">
            <form class="search-form" id="search" style="">
                <label>
                    <input type="text" style="margin-left: -180px;font-size: 24px;height: 50px; width1: 400px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px;outline:none;"
                        placeholder="Search by PlateNo"
                        v-model="searchQuery" v-on:click="searchClear" v-on:keyup="changeView" v-on:keyup.enter="goSearch">
                </label>
                <div style="margin-top: -39px;font-size: 30px;margin-left: 230px;color: black;margin-right: -60px;" v-on:click="goSearch"><i class="fa fa-fw fa-search"></i></div>
            </form>
        </div>
        <div style="float: right; margin: -128px 140px;">
                <span title="All" style="font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('*')"><i class="fas fa-filter"></i></span>
                <span title="Created" style="color: #eee !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('created')"><i class="fas fa-filter"></i></span>
                <span title="Arrived" style="color: yellow !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('arrived')"><i class="fas fa-filter"></i></span>
                <span title="Booked" style="color: green !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('booked')"><i class="fas fa-filter"></i></span>
                <span title="Docked" style="color: red !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('docked')"><i class="fas fa-filter"></i></span>
                <span title="Undocked" style="color: dodgerblue !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('undocked')"><i class="fas fa-filter"></i></span>
                <span title="Departed" style="color: gray !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('departed')"><i class="fas fa-filter"></i></span>
        </div>
        <div style="float: right; margin: -113px 40px;">
                <span title="Add item" style="font-size:70px;cursor:pointer; color: black" v-on:click="vehicleAdd()">&#43;</span>
        </div>
        </div>`,
        data() {
            return {
                searchQuery: '',
            };
        },
        methods: {
            vehicleAdd() {
                appConfig.$emit('route', 'vehicle-add');
            },
            changeView() {
                let route;
                switch (appConfig.route) {
                    case "dispatcher":
                        route = 'searchQueryDispatcher';
                        break;
                    case "goods":
                        route = 'searchQueryGoods';
                        break;
                    case "phones":
                        route = 'searchQueryPhones';
                        break;
                    case "box":
                        route = 'searchQueryBox';
                        break;
                }
                appConfig.$emit(route, this.searchQuery);
            },
            searchClear() {
                this.searchQuery = '';
                this.changeView();
            },
            goSearch() {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('searchQueryDispatcher', this.searchQuery);
                }
            },
            filterStatus(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatus', status);
                }
            },
            filterStatusL(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatusL', status);
                }
            }
        },
    });
    Vue.component('bottom', {
        template: `<div>Records: {{count}}</div>`,
        data() {
            return {
                count: 0,
            };
        },
        created() {
            appConfig.$on('itemsCount', itemsCount => {
                this.count = itemsCount;
            });


        },
        methods: {},
    });

    Vue.component('vehicles-items', {
        template: `<div>
        <div v-if="loading">
            <div style="position: relative; top: 250px; -webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                <img src="./loading.gif" alt="">
            </div>
        </div>
        <div v-if="!loading">
            <div style="margin-top: 96px;margin-bottom: 50px; font-size: 30px">
                <div v-bind:style=renderStatus(item) style="height: 50px; padding-top: 15px;border: 1px solid #d1d1d1; border-top: 1px solid #eee; color: black; box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;" v-for="item in items" v-on:click="showDetails(item)">
                    {{ item.plateNo }} - {{ item.vehicleOid }} - {{ item.companyName }} -

                    <span v-if="item.status=='created'"> {{ new Date(parseInt(item.id)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(item.id)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0] }} </span>
                    <span v-if="item.status=='arrived' && item.arrived!=='n/a'"> {{ new Date(parseInt(item.arrived)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(item.arrived)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0] }} </span>
                    <span v-if="item.status=='booked' && item.booked!=='n/a'"> {{ new Date(parseInt(item.booked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(item.booked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0] }} </span>
                    <span v-if="item.status=='docked' && item.docked!=='n/a'"> {{ new Date(parseInt(item.docked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(item.docked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0] }} </span>
                    <span v-if="item.status=='undocked' && item.undocked!=='n/a'"> {{ new Date(parseInt(item.undocked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(item.undocked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0] }} </span>
                    <span v-if="item.status=='departed' && item.departed!=='n/a'"> {{ new Date(parseInt(item.departed)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(item.departed)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0] }} </span>

                    <span v-if="item.status=='booked' || item.status=='docked'"> - {{ item.standing }}</span>
                </div>
            </div>
        </div>
        <div v-if="error" style="color: red">
            Server error - try again
        </div>
        </div>`,
        data: function () {
            return {
                items: [],
                searchQuery: '',
                filteredItems: [],
                loading: true,
                error: false,
            };
        },
        created() {
            this.getVehicles();
            appConfig.$on('searchQueryDispatcher', searchQuery => {
                let arr = [].concat(appConfig.items);
                let items = arr.filter((el) => el.plateNo.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1);
                this.filteredItems = items;
                this.items = items;

                appConfig.$emit('itemsCount', items.length);
                if (searchQuery === '') {
                    this.items = appConfig.items;
                    this.filteredItems = appConfig.items;
                }
            });
            appConfig.$on('filterStatus', status => {
                let arr = [].concat(appConfig.items);
                let items = arr.filter((el) => el.status === status);
                if (status === '*') {
                    items = [].concat(appConfig.items);
                }
                this.filteredItems = items;
                this.items = items;

                appConfig.$emit('itemsCount', items.length);
            });
            appConfig.$emit('route', 'dispatcher');
        },
        methods: {
            renderStatus(item) {
                switch (item.status) {
                    case 'arrived':
                        return {
                            background: 'yellow',
                            color: 'blue'
                        };
                        break;
                    case 'booked':
                        return {
                            background: 'green',
                            color: 'white'
                        };
                        break;
                    case 'docked':
                        return {
                            background: 'red',
                            color: 'white'
                        };
                        break;
                    case 'undocked':
                        return {
                            background: 'dodgerblue',
                            color: 'white'
                        };
                        break;
                    case 'departed':
                        return {
                            background: 'gray',
                            color: 'white'
                        };
                        break;
                }
            },
            getToken() {
                this.error = false;
                this.$http.get(appConfig.url + 'api/auth')
                    .then(result => {
                        appConfig.access_token = result.body;
                        localStorage.setItem('access_token', result.body);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            getVehicles() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.getToken();
                    return;
                }

                this.$http.get(appConfig.url + 'api/vehicles/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data.sort(this.sort);
                        this.filteredItems = result.data.sort(this.sort);
                        appConfig.items = this.filteredItems.sort(this.sort);
                        this.loading = false;
                        appConfig.$emit('itemsCount', this.items.length);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.getToken();
                    });
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            showDetails(item) {
                appConfig.item = item;
                this.$router.push('vehicle-edit');
            },
        },
    });
    Vue.component('vehicle-add', {
        template: `<div style="text-align: center;margin-top: 120px;">
        <div style="font-size: 40px;
                        color: black;
                        font-weight: bolder;
                        margin: 20px;">New record</div>

            <!--<span style="font-size: 24px; color: black;margin-left: -33px;">Name:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="VehicleOid"
            v-on:keypress="clearWarning"
            v-model="vehicleOid" ><br>

            <!--<span style="font-size: 24px; color: black;margin-left: -41px;">Salary:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="PlateNo"
            v-on:keypress="clearWarning"
            v-model="plateNo"><br>

            <!--<span style="font-size: 24px; color: black;margin-left: -19px;">Age:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="CompanyName"
            v-on:keypress="clearWarning"
            v-model="companyName" ><br>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
            </div>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;"
            v-on:click="addItem">Submit</button>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;margin-top: 20px;"
            v-on:click="goBack">Back</button>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./loading.gif" alt="">
                </div>
            </div>

            <div v-if="error" style="color: red; margin-top: 25px;">
                Server error - try again
            </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        </div>`,
        data: function () {
            return {
                id: '',
                title: '',
                vehicleOid: '',
                plateNo: '',
                companyName: '',
                invalidValue: false,
                error: false,
                loading: false,
            };
        },
        created() {
            this.init();
        },
        methods: {
            init() {
                appConfig.getAccessToken();
            },
            goBack() {
                this.$router.push('/dispatcher');
            },
            addItem() {
                if (this.vehicleOid === '') {
                    this.invalidValue = true;
                }

                if (this.plateNo === '') {
                    this.invalidValue = true;
                }

                if (this.companyName === '') {
                    this.invalidValue = true;
                }

                if (this.invalidValue) {
                    return;
                }

                this.loading = true;
                this.$http.post(appConfig.url + 'api/vehicles/add', {
                    vehicleOid: this.vehicleOid,
                    plateNo: this.plateNo,
                    companyName: this.companyName,
                    arrived: 'n/a',
                    booked: 'n/a',
                    departed: 'n/a',
                    docked: 'n/a',
                    undocked: 'n/a',
                    status: 'created',
                    standing: 'n/a',
                    message: 'n/a',

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.error) {
                            this.error = true;
                        } else {
                            this.$router.push('/dispatcher');
                        }
                        this.loading = false;

                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
            },
        },
    });
    Vue.component('vehicle-edit', {
        template: `<div style="text-align: center;margin-top: 50px;">
            <div style="font-size: 40px;color: black;font-weight: bolder;margin: 20px;">
                {{ title }}
            </div>

            <span style="font-size: 24px; color: black;">Created:</span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="created"
            v-model="created"><br>

            <span style="font-size: 24px; color: black;margin-left: 0px;">
                PlateNo:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="plateNo"
            v-on:keypress="clearWarning"
            v-model="plateNo" ><br>

            <span style="font-size: 24px; color: black;margin-left: -30px;">
                VehicleOid:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="vehicleOid"
            v-on:keypress="clearWarning"
            v-model="vehicleOid" ><br>

            <span style="font-size: 24px; color: black;margin-left: -18px;">
                Company:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="company"
            v-on:keypress="clearWarning"
            v-model="companyName" ><br>

            <span style="font-size: 24px; color: black;margin-left: 0px;">
                Arrived:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="arrived"
            v-on:keypress="clearWarning"
            v-model="arrived" ><br>

            <span style="font-size: 24px; color: black;margin-left: 0px;">
                Booked:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="booked"
            v-on:keypress="clearWarning"
            v-model="booked" ><br>

            <span style="font-size: 24px; color: black;margin-left: 0px;">
                Docked:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="docked"
            v-on:keypress="clearWarning"
            v-model="docked" ><br>

            <span style="font-size: 24px; color: black;margin-left: -24px;">
                Undocked:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="undocked"
            v-on:keypress="clearWarning"
            v-model="undocked" ><br>

            <span style="font-size: 24px; color: black;margin-left: -12px;">
                Departed:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="departed"
            v-on:keypress="clearWarning"
            v-model="departed" ><br>

            <span style="font-size: 24px; color: black;margin-left: -10px;">
                Standing:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="standing"
            v-on:keypress="clearWarning"
            v-model="standing" ><br>

            <span style="font-size: 24px; color: black;margin-left: -42px;">
                Set standing:
            </span>
            <select v-model="selected" @change="onChange($event)" style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;">
              <option disabled value="">Choose standing</option>
              <option v-for="option in options" v-bind:value="option">
                {{ option.name }}
              </option>
            </select><br>

            <span style="font-size: 24px; color: black;margin-left: 17px;">
                Status:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="status"
            v-on:keypress="clearWarning"
            v-model="status" ><br>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-bottom: 40px; padding-bottom: 10px;text-align: center;">
                <span v-show="invalidStandingValue" style="margin-left: 0px;">Value standing required - please provide.</span>
            </div>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-bottom: 20px; margin-top: -40px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Operation is prohibited for current status  - please change.</span>
            </div>

            <div v-if="error" style="color: red; margin: -20px 0px 20px;">
                Server error - try again
            </div>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./loading.gif" alt="">
                </div>
            </div>

            <button style="font-size: 24px;height: 50px;width: 150px;border-radius: 5px;background: yellow;color: blue;outline:none;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;"
            v-on:click="updateVehicle('arrived')">
                Arrived
            </button>

            <button style="font-size: 24px;height: 50px;width: 150px;border-radius: 5px;background: green;color: white;outline:none;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;"
            v-on:click="updateVehicle('booked')">
                Booked
            </button>

            <button style="font-size: 24px;height: 50px;width: 150px;border-radius: 5px;background: red;color: white;outline:none;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;"
            v-on:click="updateVehicle('docked')">
                Docked
            </button>

            <button style="font-size: 24px;height: 50px;width: 150px;border-radius: 5px;background: dodgerblue;color: white;outline:none;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;"
            v-on:click="updateVehicle('undocked')">
                Undocked
            </button>

            <button style="font-size: 24px;height: 50px;width: 150px;border-radius: 5px;background: gray;color: white;outline:none;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;"
            v-on:click="updateVehicle('departed')">
                Left
            </button><br>

            <button style="font-size: 24px;height: 50px;width: 150px;border-radius: 5px;background: #01579B;color: white;outline:none;margin-top: 20px;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;"
            v-on:click="goBack">
                Back
            </button><br><br><br><br><br><br><br><br><br><br>

        </div>`,
        data: function () {
            return {
                id: '',
                created: '',
                title: '',
                vehicleOid: '',
                plateNo: '',
                companyName: '',
                arrived: '',
                booked: '',
                docked: '',
                undocked: '',
                departed: '',
                status: '',
                standing: '',
                invalidValue: false,
                invalidStandingValue: false,
                error: false,
                loading: false,
                selected: [],
                locationID: '',
                locationName: '',
                locationStatus: 'booked',
                options: [],
            };
        },
        created() {
            if (!appConfig.item) {
                this.$router.push('/dispatcher');
            } else {
                this.init();
            }
            this.options = [].concat(appConfig.locations);
        },
        methods: {
            init() {
                this.id = appConfig.item.id;
                this.created = new Date(parseInt(appConfig.item.id) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0]
                    + ' ' + new Date(parseInt(appConfig.item.id) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0];
                this.title = appConfig.item.plateNo;
                this.plateNo = appConfig.item.plateNo;
                this.vehicleOid = appConfig.item.vehicleOid;
                this.companyName = appConfig.item.companyName;

                if (appConfig.item.arrived == 'n/a') {
                    this.arrived = appConfig.item.arrived;
                } else {
                    this.arrived = new Date(parseInt(appConfig.item.arrived) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0]
                        + ' ' + new Date(parseInt(appConfig.item.arrived) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0];
                }

                if (appConfig.item.booked == 'n/a') {
                    this.booked = appConfig.item.booked;
                } else {
                    this.booked = new Date(parseInt(appConfig.item.booked) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0]
                        + ' ' + new Date(parseInt(appConfig.item.booked) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0];
                }

                if (appConfig.item.docked == 'n/a') {
                    this.docked = appConfig.item.docked;
                } else {
                    this.docked = new Date(parseInt(appConfig.item.docked) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0]
                        + ' ' + new Date(parseInt(appConfig.item.docked) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0];
                }

                if (appConfig.item.undocked == 'n/a') {
                    this.undocked = appConfig.item.undocked;
                } else {
                    this.undocked = new Date(parseInt(appConfig.item.undocked) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0]
                        + ' ' + new Date(parseInt(appConfig.item.undocked) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0];
                }

                if (appConfig.item.departed == 'n/a') {
                    this.departed = appConfig.item.departed;
                } else {
                    this.departed = new Date(parseInt(appConfig.item.departed) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0]
                        + ' ' + new Date(parseInt(appConfig.item.departed) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0];
                }

                this.standing = appConfig.item.standing;
                this.status = appConfig.item.status;
                this.message = appConfig.item.message;
                appConfig.$emit('itemsCount', 1);
            },
            goBack() {
                this.$router.push('/dispatcher');
            },
            updateVehicle(status) {
                this.invalidValue = false;
                this.invalidStandingValue = false;

                if (this.standing !== 'n/a') {
                    let obj = this.options.filter((el) => (el.name === this.standing));
                    this.locationID = obj[0].id;
                    this.locationName = obj[0].name;
                }

                if ((this.status === 'created') && (status !== 'arrived')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                if ((status === 'booked') || (status === 'docked')) {
                    this.invalidValue = false;
                    if (this.standing === 'n/a') {
                        this.invalidStandingValue = true;
                    }
                }

                if ((status !== 'booked') && (status !== 'docked')) {
                    this.standing = 'n/a';
                }

                if ((this.invalidValue) || (this.invalidStandingValue)) {
                    return;
                }

                this.locationStatus = status;

                this.loading = true;
                this.$http.post(appConfig.url + 'api/vehicles/update', {
                    id: this.id,
                    vehicleOid: this.vehicleOid,
                    plateNo: this.plateNo,
                    companyName: this.companyName,
                    arrived: this.arrived,
                    booked: this.booked,
                    docked: this.docked,
                    undocked: this.undocked,
                    departed: this.departed,
                    status: status,
                    standing: this.standing,
                    message: this.message,

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.errors) {
                            this.error = true;
                        } else {
                            ws.send(this.plateNo + '###' + status + '###' + this.locationName);
                            this.updateLocation(status);
                        }
                        this.loading = false;
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            updateLocation() {
                var status;

                if (this.locationID === '') {
                    this.$router.push('/dispatcher');
                    return;
                }

                switch (this.locationStatus) {
                    case 'booked':
                        status = 'booked';
                        break;
                    case 'docked':
                        status = 'docked';
                        break;
                    default:
                        status = 'blank';
                }

                this.loading = true;
                this.$http.post(appConfig.url + 'api/locations/update', {
                    id: this.locationID,
                    name: this.locationName,
                    vehicle: this.plateNo,
                    status: status,
                    message: 'n/a',

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.errors) {
                            this.error = true;
                        } else {
                            this.$router.push('/dispatcher');
                        }
                        this.loading = false;
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            deleteItem() {
                this.loading = true;
                this.$http.delete('http://dummy.restapiexample.com/api/v1/delete/' + this.id)
                    .then(result => {
                        this.$router.push('/dispatcher');
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
            },
            onChange(event) {
                this.standing = this.selected.name;
                this.locationName = this.selected.name;
                this.locationID = this.selected.id;
                this.clearWarning();
            }
        },
    });

    Vue.component('locations-items', {
        template: `<div>
        <div v-if="loading">
            <div style="position: relative; top: 250px; -webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                <img src="./loading.gif" alt="">
            </div>
        </div>
        <div v-if="!loading">
            <div style="margin-top: 96px;margin-bottom: 50px; font-size: 30px">
                <div v-bind:style=renderStatus(item) style="height: 50px; padding-top: 15px;border: 1px solid #d1d1d1; border-top: 1px solid #eee; color: black;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;" v-for="item in items" v-on:click="showDetails(item)">
                    {{ item.name }}
                    <span v-if="item.status=='booked' || item.status=='docked'"> - {{ item.vehicle }}</span>
                </div>
            </div>
        </div>
        <div v-if="error" style="color: red">
            Server error - try again
        </div>
        </div>`,
        data: function () {
            return {
                items: [],
                searchQuery: '',
                filteredItems: [],
                loading: true,
                error: false,
            };
        },
        created() {
            this.getLocations();
            appConfig.$on('searchQueryDispatcher', searchQuery => {
                let arr = [].concat(appConfig.locations);
                let items = arr.filter((el) => el.vehicle.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1);
                this.filteredItems = items;
                this.items = items;

                if (searchQuery === '') {
                    this.items = appConfig.locations;
                    this.filteredItems = appConfig.locations;
                }
            });
            appConfig.$on('filterStatusL', status => {
                let arr = [].concat(appConfig.locations);
                let items = arr.filter((el) => el.status === status);
                if (status === '*') {
                    items = [].concat(appConfig.locations);
                }
                this.filteredItems = items;
                this.items = items;
            });
        },
        methods: {
            renderStatus(item) {
                switch (item.status) {
                    case 'arrived':
                        return {background: 'yellow', color: 'blue'};
                        break;
                    case 'booked':
                        return {background: 'green', color: 'white'};
                        break;
                    case 'docked':
                        return {background: 'red', color: 'white'};
                        break;
                    case 'undocked':
                        return {background: 'dodgerblue', color: 'white'};
                        break;
                    case 'departed':
                        return {background: 'gray', color: 'white'};
                        break;
                }
            },
            getToken() {
                this.error = false;
                this.$http.get(appConfig.url + 'api/auth')
                    .then(result => {
                        appConfig.access_token = result.body;
                        localStorage.setItem('access_token', result.body);
                    })
                    .catch(error => {
                        //this.getToken();
                        this.error = true;
                        this.loading = false;
                    });
            },
            getLocations() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.getToken();
                    //setTimeout(this.getVehicles, 100);
                    return;
                }

                this.$http.get(appConfig.url + 'api/locations/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data.sort(this.sort);
                        this.filteredItems = result.data.sort(this.sort);
                        appConfig.locations = this.filteredItems.sort(this.sort);
                        this.loading = false;
                        //appConfig.$emit('itemsCount', this.items.length);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.getToken();
                    });
            },
            sort(a, b) {
                return parseInt(a.id) - parseInt(b.id);
            },
            showDetails(item) {
                appConfig.item = item;
                this.$router.push('vehicle-edit');
            },
        },
    });

    Vue.component('driver-reg', {
        template: `<div style="text-align: center;margin-top: 120px;">
        <div style="font-size: 40px;
                        color: black;
                        font-weight: bolder;
                        margin: 30px;margin-top: 250px">Vehicle registration</div>

            <!--<span style="font-size: 24px; color: black;margin-left: -41px;">Salary:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="PlateNo"
            v-on:keypress="clearWarning"
            v-on:keypress.enter="doReg"
            v-model="plateNo"><br>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
            </div>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;"
            v-on:click="doReg">Submit</button>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;margin-top: 20px;"
            v-on:click="doClear">Clear</button>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./loading.gif" alt="">
                </div>
            </div>

            <div v-if="massage" style="color: red; margin-top: 25px;">
                Can't register this PlateNo - try another one
            </div>

            <div v-if="error" style="color: red; margin-top: 25px;">
                Server error - try again
            </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        </div>`,
        data: function () {
            return {
                id: '',
                title: '',
                vehicleOid: '',
                plateNo: '',
                companyName: '',
                invalidValue: false,
                error: false,
                loading: false,
                massage: false
            };
        },
        created() {
            this.init();
        },
        methods: {
            init() {
                appConfig.getAccessToken();
            },
            goBack() {
                this.$router.push('/dispatcher');
            },
            doClear() {
                this.plateNo = '';
                this.massage = false;
            },
            doReg() {
                if (this.plateNo === '') {
                    this.invalidValue = true;
                }

                if (this.invalidValue) {
                    return;
                }

                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.getToken();
                    return;
                }

                this.loading = true;
                this.massage = false;

                this.$http.get(appConfig.url + 'api/vehicles/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data;
                        let arr = this.items.filter((el) => el.plateNo.toLowerCase() === this.plateNo.toLowerCase());
                        if (arr[0]) {
                            if (arr[0].plateNo.toLowerCase() === this.plateNo.toLowerCase()) {
                                appConfig.driver = arr[0];
                                appConfig.driver.reg = new Date(+new Date() - (new Date()).getTimezoneOffset() * 60000).toISOString();
                                this.loading = false;
                                this.$router.push('/driver');
                            } else {
                                this.massage = true;
                                this.loading = false;
                            }
                            this.massage = true;
                            this.loading = false;
                        }
                        this.massage = true;
                        this.loading = false;
                    })
                    .catch(error => {
                        console.log(error)
                        this.error = true;
                        this.loading = false;
                        this.getToken()
                    });
            },
            getToken() {
                this.error = false;
                this.$http.get(appConfig.url + 'api/auth')
                    .then(result => {
                        appConfig.access_token = result.body;
                        localStorage.setItem('access_token', result.body);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
                this.massage = false;
            },
        },
    });
    Vue.component('driver-status', {
        template: `<div style="text-align: center;margin-top: 120px;">
            <div style="font-size: 50px;
                color: black;
                font-weight: bolder;
                margin: 20px;">
                {{driver.plateNo}}
            </div>

            <div style="font-size: 30px;
                color: black;
                font-weight: bolder;
                margin: 20px;">
                {{driver.companyName}}
            </div>

            <div style="font-size: 20px;
                color: black;
                font-weight: bolder;
                margin: 20px;">
                Created: {{
                    new Date(parseInt(driver.id)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(driver.id)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0]
                }}
            </div>

            <div v-if="driver.arrived !=='n/a'" style="font-size: 20px;
                color: black;
                font-weight: bolder;
                margin: 20px;">
                Arrived: {{
                    new Date(parseInt(driver.arrived)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(driver.arrived)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0]
                }}
            </div>

            <div v-if="driver.booked !=='n/a'" style="font-size: 20px;
                color: black;
                font-weight: bolder;
                margin: 20px;">
                Booked: {{
                    new Date(parseInt(driver.booked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(driver.booked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0]
                }}
            </div>

            <div v-if="driver.docked !=='n/a'" style="font-size: 20px;
                color: black;
                font-weight: bolder;
                margin: 20px;">
                Docked: {{
                    new Date(parseInt(driver.docked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(driver.docked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0]
                }}
            </div>

            <div v-if="driver.undocked !=='n/a'" style="font-size: 20px;
                color: black;
                font-weight: bolder;
                margin: 20px;">
                Undocked: {{
                    new Date(parseInt(driver.undocked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(driver.undocked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0]
                }}
            </div>

            <div v-if="driver.departed !=='n/a'" style="font-size: 20px;
                color: black;
                font-weight: bolder;
                margin: 20px;">
                Departed: {{
                    new Date(parseInt(driver.departed)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(driver.departed)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0]
                }}
            </div>

            <div style="font-size: 40px;
                color: black;
                font-weight: bolder;
                margin: 20px;
                margin-bottom: 0px;">
                Standing: {{driver.standing}}
            </div>

            <div style="font-size: 100px;
                color: red;
                font-weight: bolder;
                margin-bottom: 30px;">
                {{driver.status}}
            </div>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
            </div>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;"
            v-on:click="goBack">Quit</button>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./loading.gif" alt="">
                </div>
            </div>

            <div v-if="massage" style="color: red; margin-top: 25px;">
                Can't register this PlateNo - try another one
            </div>

            <div v-if="error" style="color: red; margin-top: 25px;">
                Server error - try again
            </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        </div>`,
        data: function () {
            return {
                id: '',
                title: '',
                vehicleOid: '',
                plateNo: '',
                companyName: '',
                invalidValue: false,
                error: false,
                loading: false,
                massage: false,
                driver: ''
            };
        },
        created() {
            if (!appConfig.driver) {
                this.$router.push('/driver-reg');
            } else {
                this.init();
            }
        },
        methods: {
            init() {
                this.driver = appConfig.driver;
            },
            goBack() {
                this.$router.push('/driver-reg');
            },
            doClear() {
                this.plateNo = '';
                this.massage = false;
            },
            doReg() {
                if (this.plateNo === '') {
                    this.invalidValue = true;
                }

                if (this.invalidValue) {
                    return;
                }

                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.getToken();
                    return;
                }

                this.loading = true;
                this.massage = false;

                this.$http.get(appConfig.url + 'api/vehicles/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data;
                        if (this.items.filter((el) => el.plateNo === this.plateNo)[0].plateNo == this.plateNo) {
                            appConfig.driver = this.items[0];
                            appConfig.driver.reg = new Date(+new Date() - (new Date()).getTimezoneOffset() * 60000).toISOString();
                            this.loading = false;
                            this.$router.push('/dispatcher');
                        } else {
                            this.massage = true;
                            this.loading = false;
                        }
                    })
                    .catch(error => {
                        this.massage = true;
                        this.loading = false;
                    });
            },
            getToken() {
                this.error = false;
                this.$http.get(appConfig.url + 'api/auth')
                    .then(result => {
                        appConfig.access_token = result.body;
                        localStorage.setItem('access_token', result.body);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
                this.massage = false;
            },
        },
    });

    const routes = [
        {path: '/', component: Dispatcher},
        {path: '/dispatcher', component: Dispatcher},
        {path: '/vehicle-add', component: VehicleAdd},
        {path: '/vehicle-edit', component: VehiclesEdit},
        {path: '/driver-reg', component: DriverReg},
        {path: '/driver', component: DriverStatus},
    ];

    const router = new VueRouter({
        routes,
    });

    new Vue({
        el: '#app',
        router,
        data: {
            items: [],
        },
        created() {
            this.init();
            appConfig.route = this.$route.path.split('/')[1];

            //appConfig.url = 'http://jwt-yard.herokuapp.com/';
            appConfig.url = 'http://localhost:3000/';

            appConfig.getAccessToken = () => {
                appConfig.access_token = localStorage.getItem('access_token');
            };

            appConfig.$on('route', route => {
                this.changeRoute(route);
            });

            if (window.ws === undefined) {
                //window.ws = new WebSocket('wss://jwt-chat.herokuapp.com');
                window.ws = new WebSocket('ws://localhost:3000/');
            }

            ws.onmessage = (e) => {
                let messageObject = e.data;
                console.log(messageObject)
                if (messageObject.split('###')[0] !== 'still alive') {
                    this.items.unshift({
                        id: +new Date(),
                        name: messageObject.split('###')[1],
                        date: messageObject.split('###')[2],
                        message: messageObject.split('###')[0]
                    });

                    let notification = new Notification('VU-Demo', {
                        icon: './message.jpg',
                        body: messageObject.split('###')[0] + ' ' + messageObject.split('###')[1] + ' ' + messageObject.split('###')[2],
                    });

                    switch (messageObject.split('###')[0].toLowerCase()) {
                        case 'reload':
                            appConfig.$emit('init', {});
                            break;
                        case 'set':
                            appConfig.$emit('set', {});
                            break;
                        case 'show':
                            appConfig.$emit('show', {});
                            break;
                        case 'get':
                            appConfig.$emit('get', {});
                            break;
                        case 'yard':
                            appConfig.$emit('yard', {});
                            break;
                    }
                }
            };
        },
        methods: {
            init() {
                this.dispatcher = appConfig.route === 'dispatcher';
                this.gatekeeper = appConfig.route === 'gatekeeper';
                this.driver = appConfig.route === 'driver';
            },
            changeRoute(route) {
                closeNav();

                if (route === 'gatekeeper' || route === 'driver') {
                    return;
                }

                appConfig.route = route;
                this.init();

                if (this.$router.currentRoute.path === '/' + route) {
                    return false;
                }

                this.$router.push('/' + route);
                return false;
            },
            emitEvent(event) {
                appConfig.$emit(event, {});
                this.map = true;
                closeNav();
            }
        },
    });

    function openNav() {
        document.getElementById('mySidenav').style.width = '250px';
    }

    function closeNav() {
        document.getElementById('mySidenav').style.width = '0';
        return false;
    }
</script>

