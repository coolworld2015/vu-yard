<meta http-equiv="content-type" content="name/html; charset=UTF-8"/>
<!--<meta name="viewport" content="initial-scale=1.0, user-scalable=no">-->

<title>Yard Management System by Eduard Tkachuk</title>
<link rel="shortcut icon" type="image/png" href="./img/yard.png"/>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.0.3/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/1.0.3/vue-resource.min.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDcEkMFV_WyhNdZrr8VLaCYOw4FP75u748"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css">

<style>
    ::-webkit-scrollbar {
        display: none;
    }

    html {
        background: #f6f6f6;
        overflow: hidden;
    }

    body {
        background: white;
        margin: 0;
        padding: 0;
    }

    .top {
        position: fixed;
        top: 0px;
        width: 100%;
        display: block;
        background: white;
        padding: 5px;
        height: 85px;
        color: #ef835d;
        font-size: 200%;
        text-align: center;
        border-bottom: 1px solid #d1d1d1;
        box-shadow: 0 1px 2px rgba(0, 0, 0, .1);
    }

    .middle {
        background: #f6f6f6;
        /*        margin-left: -5px;
                margin-right: 5px;*/
        width: 100%;
        height: 100%;
        color: black;
        font-size: 200%;
        text-align: center;
        overflow-y: scroll;
        border-top: 1px solid #d1d1d1;
    }

    .bottom {
        position: fixed;
        bottom: 0px;
        width: 100%;
        /*background: red;*/
        background: #01579B;
        padding: 5px;
        height: 40px;
        color: white;
        font-size: 30px;
        text-align: center;
        border-top: 1px solid #d1d1d1;
    }

    .sidenav {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 1;
        top: 0;
        left: 0;
        background-color: #111;
        overflow-x: hidden;
        transition: 0.2s;
        padding-top: 60px;
        box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
    }

    .sidenav a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: 25px;
        color: #818181;
        display: block;
        transition: 0.2s;
    }

    .sidenav a:hover {
        color: #f1f1f1;
    }

    .sidenav .closebtn {
        position: absolute;
        top: 0;
        right: 5px;
        font-size: 36px;
        margin-left: 50px;
    }

    #main {
        transition: margin-left .2s;
    / / padding: 16 px;
    }

    @media screen and (max-height: 450px) {
        .sidenav {
            padding-top: 15px;
        }

        .sidenav a {
            font-size: 18px;
        }
    }

    ul {
        padding-inline-start: 0;
        font-size: 25px;
        /*text-shadow: #000 0.15em 0.15em 0.15em;*/
    }

    li {
        list-style-type: none;
        color: white;
        padding: 20px;
        border-bottom: solid 1px black;
    }

    li:hover {
        background: whitesmoke;
        color: black;
    }

    .active {
        background: white;
        color: black;
    }
</style>

<div id="app">
    <div id="mySidenav" class="sidenav">
        <div style="color: white;margin-top: -48px;margin-left: 12px;font-size: 30px;width: 200px;">
            Yard Management System
        </div>
        <div style="color: white;margin-top: 20px;margin-left: 15px;font-size: 20px;width: 200px;">
            by Eduard Tkachuk
        </div>
        <ul>
            <a href="" class="closebtn" onclick="event.preventDefault();closeNav()"> &times;</a>

            <li v-on:click="changeRoute('dispatcher')" v-bind:class="{ active: dispatcher }">
                <i class="fas fa-user-friends"></i><span style="margin: 15px;">Dispatcher</span></li>

            <li v-on:click="changeRoute('registration')" v-bind:class="{ active: registration }">
                <i class="fas fa-user"></i><span style="margin: 15px;">Driver</span></li>

            <li v-on:click="changeRoute('vehicles-table')" v-bind:class="{ active: vehicles }">
                <i class="fas fa-truck-moving"></i><span style="margin: 15px;">Vehicles</span></li>

            <li v-on:click="changeRoute('locations-table')" v-bind:class="{ active: locations }">
                <i class="fas fa-parking"></i><span style="margin: 15px;">Locations</span></li>

            <li v-on:click="changeRoute('map')" v-bind:class="{ active: map }">
                <i class="fas fa-map-marked-alt"></i><span style="margin: 15px;">Map</span></li>

            <li v-on:click="changeRoute('targets')" v-bind:class="{ active: targets }">
                <i class="fas fa-crosshairs"></i><span style="margin: 15px;">Targets</span></li>

            <li v-on:click="changeRoute('positions')" v-bind:class="{ active: positions }">
                <i class="fas fa-map-marker-alt"></i><span style="margin: 15px;">Positions</span></li>

            <li v-on:click="changeRoute('operations')" v-bind:class="{ active: operations }">
                <i class="fas fa-history"></i><span style="margin: 15px;">Operations</span></li>

            <li v-on:click="changeRoute('audit')" v-bind:class="{ active: audit }">
                <i class="fas fa-shield-alt"></i><span style="margin: 15px;">Security log</span></li>

            <li v-on:click="changeRoute('guests')" v-bind:class="{ active: guests }">
                <i class="fas fa-id-card"></i><span style="margin: 15px;">Guests</span></li>

            <li v-on:click="logout()" v-bind:class="{ active: driver }">
                <i class="fas fa-sign-out-alt"></i><span style="margin: 15px;">Logout</span></li>

        </ul>
    </div>

    <div id="main">
        <div class="middle">
            <router-view></router-view>
        </div>
    </div>
</div>
</div>

<script>
    const appConfig = new Vue();
    appConfig.route = 'dispatcher';

    const Login = {template: '<login></login>'};

    const Dispatcher = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top></top>
                        </div>
                            <div>
                                <div style="width: 49%;padding: 0 5px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                                    <vehicles-items></vehicles-items>
                                </div>
                                <div style="width: 50%;padding: 0px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                                    <locations-items></locations-items>
                                </div>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>
                    </div>`
    };
    const VehiclesEdit = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top></top>
                        </div>
                            <div>
                                <div style="margin-top:100px; width: 49%;padding: 0 5px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                                    <vehicle-edit></vehicle-edit>
                                </div>
                                <div style="width: 50%;padding: 0px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                                    <locations-items></locations-items>
                                </div>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>`
    };
    const VehicleAdd = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top></top>
                        </div>
                            <div>
                                <div style="margin-top:100px; width: 49%;padding: 0 5px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                                    <vehicle-add></vehicle-add>
                                </div>
                                <div style="width: 50%;padding: 0px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                                    <locations-items></locations-items>
                                </div>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>`
    };
    const VehiclesTable = {
        template: `
                    <div>
                        <div class="top"><top-vehicles></top-vehicles></div>
                           <vehicles-items-table></vehicles-items-table>
                        <div class="bottom"><bottom></bottom></div>
                    </div>`
    };
    const VehiclesTableAdd = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-vehicles></top-vehicles>
                        </div>
                            <div>
                                <vehicle-table-add></vehicle-table-add>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>
                    </div>`
    };

    const DriverReg = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-driver></top-driver>
                        </div>
                            <div>
                                <driver-reg></driver-reg>
                            </div>`
    };
    const DriverStatus = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-driver></top-driver>
                        </div>
                            <div>
                                <driver-status></driver-status>
                        </div>`
    };

    const LocationsTable = {
        template: `
                    <div>
                        <div class="top"><top-locations></top-locations></div>
                           <locations-items-table></locations-items-table>
                        <div class="bottom"><bottom></bottom></div>
                    </div>`
    };
    const LocationAdd = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-locations></top-locations>
                        </div>
                            <div>
                                <location-add></location-add>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>
                    </div>`
    };

    const Audit = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-audit></top-audit>
                        </div>
                            <div>
                                <audit-items></audit-items>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>
                    </div>`
    };
    const Operations = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-operations></top-operations>
                        </div>
                            <div>
                                <operations-items></operations-items>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>
                    </div>`
    };

    const Targets = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-targets></top-targets>
                        </div>
                            <div>
                                <targets-items-table></targets-items-table>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>
                    </div>`
    };
    const TargetAdd = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-targets></top-targets>
                        </div>
                            <div>
                                <target-add></target-add>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>
                    </div>`
    };

    const Positions = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-positions></top-positions>
                        </div>
                            <div>
                                <positions-items-table></positions-items-table>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>
                    </div>`
    };
    const PositionAdd = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-positions></top-positions>
                        </div>
                            <div>
                                <position-add></position-add>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>
                    </div>`
    };

    const GoogleMap = {
        template: `
                    <div>
                        <div class="top"><top-map></top-map></div>
                        <div style="margin-top: 96px;"><google-map></google-map></div>
                    </div>`
    };

    const Guests = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-guests></top-guests>
                        </div>
                            <div>
                                <guests-items-table></guests-items-table>
                            </div>
                        <div class="bottom">
                            <bottom></bottom>
                        </div>`
    };
    const GuestAdd = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-guests></top-guests>
                        </div>
                            <div>
                                <guest-add></guest-add>
                            </div>`
    };
    const GuestEdit = {
        template: `
                    <div style="width: 100%">
                        <div class="top">
                            <top-guests></top-guests>
                        </div>
                            <div>
                                <guest-edit></guest-edit>
                            </div>`
    };

    Vue.component('login', {
        template: `<div style="background: #01579B;width: 100%;height: 100%;position: absolute;">
            <div class="content" style="background: #01579B">
                <div style="width: 400px; padding: 45px 90px 30px;
                    margin: 160px auto; border-radius: 3px;
                    color: #000; background: #fff;
                    box-shadow: 0px 2px 15px 0px rgba(0,0,0,0.5); text-align: center;">
                <div class="col-sm-12 d-flex flex-column justify-content-around">

                        <p class="h5" style="font-weight: bold;">Yard Management System</p>
                        <img src="./img/yard.png" style="margin-top: -20px;margin-bottom: 20px; width: 150px;">


                    <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
                        border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
                        width: 450px;outline:none;margin-right: 0px;"
                        placeholder="Login"
                        v-on:keypress="clearWarning"
                        v-on:keypress.enter="doLogin"
                    v-model="login"><br>

                    <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
                        border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
                        width: 450px;outline:none;margin-right: 0px;"
                        type="password"
                        placeholder="Password"
                        v-on:keypress="clearWarning"
                        v-on:keypress.enter="doLogin"
                    v-model="password"><br>

                    <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                        <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
                        <span v-show="error" style="margin-left: 0px;">Access denied</span>
                    </div>

                    <button style="font-size: 24px;
                        height: 50px;
                        width: 150px;
                        border-radius: 5px;
                        background: #01579B;
                        box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                        color: white;outline:none;"
                    v-on:click="doLogin">Submit</button>

                    <button style="font-size: 24px;
                        height: 50px;
                        width: 150px;
                        border-radius: 5px;
                        background: #01579B;
                        box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                        margin-bottom: 100px;
                        color: white;outline:none;margin-top: 20px;"
                    v-on:click="doClear">Cancel</button>

                        <div>
                            <img v-show="loading" src="./img/loading.gif" style="margin-bottom: -50px; margin-top: -120px;height: 150px;">
                        </div>
                </div>
                </div>
            </div>
        </div> `,
        data: function () {
            return {
                id: '',
                title: '',
                login: '',
                password: '',
                companyName: '',
                invalidValue: false,
                error: false,
                loading: false,
                massage: false
            };
        },
        created() {
            this.init();
        },
        methods: {
            init() {
                appConfig.getAccessToken();
            },
            doClear() {
                this.login = '';
                this.password = '';
                this.error = false;
            },
            doLogin() {
                if (this.login === '') {
                    this.invalidValue = true;
                }

                if (this.password === '') {
                    this.invalidValue = true;
                }

                if (this.invalidValue) {
                    return;
                }

                this.loading = true;
                this.massage = false;

                this.loading = true;
                this.error = false;
                this.$http.post(appConfig.url + 'api/login', {
                    name: this.login,
                    pass: this.password,
                    description: 'Web'
                })
                    .then(result => {
                        appConfig.access_token = result.body.token;
                        localStorage.setItem('access_token', result.body.token);
                        this.loading = false;
                        this.error = false;
                        this.$router.push('dispatcher');
                    })
                    .catch((error) => {
                        this.loading = false;
                        this.error = true;
                    })
            },
            getToken() {
                this.error = false;
                this.$http.get(appConfig.url + 'api/auth')
                    .then(result => {
                        appConfig.access_token = result.body.token;
                        localStorage.setItem('access_token', result.body);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
                this.massage = false;
            },
        },
    });

    Vue.component('top', {
        template: `<div>
        <div style="float: left; margin: 20px; margin-top: -3px;">
                <span title="Show menu" style="font-size:40px;cursor:pointer; color: black" onclick="openNav()">&#9776;</span>
        </div>
        <div style="float: left; margin: -34px 0px 0px 50px;">
                <span title="All" style="font-size:25px;cursor:pointer; color: black" v-on:click="filterStatusL('*')"><i class="fas fa-filter"></i></span>
                <span title="Vacated" style="color: #eee !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatusL('blank')"><i class="fas fa-filter"></i></span>
                <span title="Booked" style="color: green !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatusL('booked')"><i class="fas fa-filter"></i></span>
                <span title="Docked" style="color: red !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatusL('docked')"><i class="fas fa-filter"></i></span>
        </div>
        <div style="margin-top: 15px; color: red; font-size: 50px;margin-right: 100px;">
            <form class="search-form" id="search" style="">
                <label>
                    <input type="text" style="margin-left: -180px;font-size: 24px;height: 50px; width1: 400px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px;outline:none;"
                        placeholder="Search by PlateNo"
                        v-model="searchQuery" v-on:click="searchClear" v-on:keyup="changeView" v-on:keyup.enter="goSearch">
                </label>
                <div style="margin-top: -39px;font-size: 30px;margin-left: 230px;color: black;margin-right: -60px;" v-on:click="goSearch"><i class="fa fa-fw fa-search"></i></div>
            </form>
        </div>
        <div style="float: right; margin: -128px 140px;">
                <span title="All" style="font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('*')"><i class="fas fa-filter"></i></span>
                <span title="Created" style="color: #eee !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('created')"><i class="fas fa-filter"></i></span>
                <span title="Standby" style="color: yellow !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('arrived')"><i class="fas fa-filter"></i></span>
                <span title="Booked" style="color: green !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('booked')"><i class="fas fa-filter"></i></span>
                <span title="Docked" style="color: red !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('docked')"><i class="fas fa-filter"></i></span>
                <span title="Undocked" style="color: dodgerblue !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('undocked')"><i class="fas fa-filter"></i></span>
                <span title="Departed" style="color: gray !important;font-size:25px;cursor:pointer; color: black" v-on:click="filterStatus('departed')"><i class="fas fa-filter"></i></span>
        </div>
        <div style="float: right; margin: -113px 40px;">
                <span title="Add item" style="font-size:70px;cursor:pointer; color: black" v-on:click="vehicleAdd()">&#43;</span>
        </div>
        </div>`,
        data() {
            return {
                searchQuery: '',
            };
        },
        methods: {
            vehicleAdd() {
                appConfig.$emit('route', 'vehicle-add');
            },
            changeView() {
                let route;
                switch (appConfig.route) {
                    case "dispatcher":
                        route = 'searchQueryDispatcher';
                        break;
                    case "goods":
                        route = 'searchQueryGoods';
                        break;
                    case "phones":
                        route = 'searchQueryPhones';
                        break;
                    case "box":
                        route = 'searchQueryBox';
                        break;
                }
                appConfig.$emit(route, this.searchQuery);
            },
            searchClear() {
                this.searchQuery = '';
                this.changeView();
            },
            goSearch() {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('searchQueryDispatcher', this.searchQuery);
                }
            },
            filterStatus(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatus', status);
                }
            },
            filterStatusL(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatusL', status);
                }
            }
        },
    });
    Vue.component('top-vehicles', {
        template: `<div>
        <div style="float: left; margin: 20px; margin-top: -3px;">
                <span title="Show menu" style="font-size:40px;cursor:pointer; color: black" onclick="openNav()">&#9776;</span>
        </div>
        <div style="margin-top: 15px; color: red; font-size: 50px;margin-right: 100px;">
            <form class="search-form" id="search" style="">
                <label>
                    <input type="text" style="margin-left: -30px;font-size: 24px;height: 50px; width1: 400px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px;outline:none;"
                        placeholder="Search by PlateNo"
                        v-model="searchQuery" v-on:click="searchClear" v-on:keyup="changeView">
                </label>
                <div style="margin-top: -39px;font-size: 30px;margin-left: 230px;color: black;margin-right: -60px;"><i class="fa fa-fw fa-search"></i></div>
            </form>
        </div>
        <div style="float: right; margin: -113px 40px;">
                <span title="Add item" style="font-size:70px;cursor:pointer; color: black" v-on:click="vehicleAdd()">&#43;</span>
        </div>
        </div>`,
        data() {
            return {
                searchQuery: '',
            };
        },
        methods: {
            vehicleAdd() {
                appConfig.$emit('route', 'vehicle-table-add');
            },
            changeView() {
                appConfig.$emit('searchQueryVehicles', this.searchQuery);
            },
            searchClear() {
                this.searchQuery = '';
                this.changeView();
            },
            filterStatus(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatus', status);
                }
            },
            filterStatusL(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatusL', status);
                }
            }
        },
    });
    Vue.component('top-locations', {
        template: `<div>
        <div style="float: left; margin: 20px; margin-top: -3px;">
                <span title="Show menu" style="font-size:40px;cursor:pointer; color: black" onclick="openNav()">&#9776;</span>
        </div>
        <div style="margin-top: 15px; color: red; font-size: 50px;margin-right: 100px;">
            <form class="search-form" id="search" style="">
                <label>
                    <input type="text" style="margin-left: -30px;font-size: 24px;height: 50px; width1: 400px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px;outline:none;"
                        placeholder="Search by name"
                        v-model="searchQuery" v-on:click="searchClear" v-on:keyup="changeView" v-on:keyup.enter="goSearch">
                </label>
                <div style="margin-top: -39px;font-size: 30px;margin-left: 230px;color: black;margin-right: -60px;" v-on:click="goSearch"><i class="fa fa-fw fa-search"></i></div>
            </form>
        </div>
        <div style="float: right; margin: -113px 40px;">
                <span title="Add item" style="font-size:70px;cursor:pointer; color: black" v-on:click="vehicleAdd()">&#43;</span>
        </div>
        </div>`,
        data() {
            return {
                searchQuery: '',
            };
        },
        methods: {
            vehicleAdd() {
                appConfig.$emit('route', 'location-add');
            },
            changeView() {
                appConfig.$emit('searchQueryLocations', this.searchQuery);
            },
            searchClear() {
                this.searchQuery = '';
                this.changeView();
            },
            goSearch() {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('searchQueryDispatcher', this.searchQuery);
                }
            },
            filterStatus(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatus', status);
                }
            },
            filterStatusL(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatusL', status);
                }
            }
        },
    });

    Vue.component('bottom', {
        template: `<div style="margin-top: 3px;">Records: {{count}}</div>`,
        data() {
            return {
                count: 0,
            };
        },
        created() {
            appConfig.$on('itemsCount', itemsCount => {
                this.count = itemsCount;
            });


        },
        methods: {},
    });

    Vue.component('vehicles-items', {
        template: `<div>
        <div v-if="loading">
            <div style="position: relative; top: 250px; -webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                <img src="./img/loading.gif" alt="">
            </div>
        </div>
        <div v-if="!loading">
            <div style="margin-top: 96px;margin-bottom: 50px; font-size: 30px">
                <div v-bind:style=renderStatus(item) style="height: 90px; padding: 50px 10px 0px 10px;border: 1px solid #d1d1d1; border-top: 1px solid #eee; color: black; box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;" v-for="item in items" v-on:click="showDetails(item)">
                    {{ item.plateNo }} - {{ item.vehicleOid }} - {{ item.companyName }} -

                    <span v-if="item.status=='created'"> {{ new Date(parseInt(item.id)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(item.id)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0] }} </span>
                    <span v-if="item.status=='arrived' && item.arrived!=='n/a'"> {{ new Date(parseInt(item.arrived)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(item.arrived)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0] }} </span>
                    <span v-if="item.status=='booked' && item.booked!=='n/a'"> {{ new Date(parseInt(item.booked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(item.booked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0] }} </span>
                    <span v-if="item.status=='docked' && item.docked!=='n/a'"> {{ new Date(parseInt(item.docked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(item.docked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0] }} </span>
                    <span v-if="item.status=='undocked' && item.undocked!=='n/a'"> {{ new Date(parseInt(item.undocked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(item.undocked)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0] }} </span>
                    <span v-if="item.status=='departed' && item.departed!=='n/a'"> {{ new Date(parseInt(item.departed)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0] + ' ' + new Date(parseInt(item.departed)-(new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0] }} </span>

                    <span v-if="item.status=='booked' || item.status=='docked'"> - {{ item.standing }}</span>
                </div>
            </div>
        </div>
        <div v-if="error" style="color: red">
            Server error - try again
        </div>
        </div>`,
        data: function () {
            return {
                items: [],
                searchQuery: '',
                filteredItems: [],
                loading: true,
                error: false,
            };
        },
        created() {
            this.getVehicles();
            appConfig.$on('searchQueryDispatcher', searchQuery => {
                let arr = [].concat(appConfig.items);
                let items = arr.filter((el) => el.plateNo.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1);
                this.filteredItems = items;
                this.items = items;

                appConfig.$emit('itemsCount', items.length);
                if (searchQuery === '') {
                    this.items = appConfig.items;
                    this.filteredItems = appConfig.items;
                }
            });
            appConfig.$on('filterStatus', status => {
                let arr = [].concat(appConfig.vehicles);
                let items = arr.filter((el) => el.status === status);
                if (status === '*') {
                    items = [].concat(appConfig.items);
                }
                this.filteredItems = items;
                this.items = items;

                appConfig.$emit('itemsCount', items.length);
            });
            appConfig.$emit('route', 'dispatcher');
        },
        methods: {
            renderStatus(item) {
                switch (item.status) {
                    case 'arrived':
                        return {
                            background: 'yellow',
                            color: 'blue'
                        };
                        break;
                    case 'booked':
                        return {
                            background: 'green',
                            color: 'white'
                        };
                        break;
                    case 'docked':
                        return {
                            background: 'red',
                            color: 'white'
                        };
                        break;
                    case 'undocked':
                        return {
                            background: 'dodgerblue',
                            color: 'white'
                        };
                        break;
                    case 'departed':
                        return {
                            background: 'gray',
                            color: 'white'
                        };
                        break;
                }
            },
            getVehicles() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/vehicles/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        appConfig.vehicles = result.data.sort(this.sort);
                        let items = result.data.sort(this.sort);
                        items = items.filter(el => el.status !== 'departed');
                        appConfig.items = items;
                        this.items = items;
                        this.filteredItems = items;

                        this.loading = false;
                        appConfig.$emit('itemsCount', this.items.length);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.$router.push('login');
                    });
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            showDetails(item) {
                appConfig.item = item;
                this.$router.push('vehicle-edit');
            },
        },
    });
    Vue.component('vehicle-add', {
        template: `<div style="text-align: center;margin-top: 120px;">
        <div style="font-size: 40px;
                        color: black;
                        font-weight: bolder;
                        margin: 20px;">New record</div>

            <!--<span style="font-size: 24px; color: black;margin-left: -33px;">Name:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="VehicleOid"
            v-on:keypress="clearWarning"
            v-model="vehicleOid" ><br>

            <!--<span style="font-size: 24px; color: black;margin-left: -41px;">Salary:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="PlateNo"
            v-on:keypress="clearWarning"
            v-model="plateNo"><br>

            <!--<span style="font-size: 24px; color: black;margin-left: -19px;">Age:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="CompanyName"
            v-on:keypress="clearWarning"
            v-model="companyName" ><br>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
            </div>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;"
            v-on:click="addItem">Submit</button>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;margin-top: 20px;"
            v-on:click="goBack">Back</button>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./img/loading.gif" alt="">
                </div>
            </div>

            <div v-if="error" style="color: red; margin-top: 25px;">
                {{errorText}}
            </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        </div>`,
        data: function () {
            return {
                id: '',
                title: '',
                vehicleOid: '',
                plateNo: '',
                companyName: '',
                errorText: '',
                invalidValue: false,
                error: false,
                loading: false,
            };
        },
        created() {
            this.init();
        },
        methods: {
            init() {
                appConfig.getAccessToken();
                setTimeout(function () {
                    appConfig.$emit('itemsCount', 1)
                }, 100);
            },
            goBack() {
                this.$router.push('/dispatcher');
            },
            addItem() {
                if (this.vehicleOid === '') {
                    this.invalidValue = true;
                }

                if (this.plateNo === '') {
                    this.invalidValue = true;
                }

                if (this.companyName === '') {
                    this.invalidValue = true;
                }

                if (this.invalidValue) {
                    return;
                }

                this.loading = true;
                this.$http.post(appConfig.url + 'api/vehicles/add', {
                    vehicleOid: this.vehicleOid,
                    plateNo: this.plateNo,
                    companyName: this.companyName,
                    arrived: 'n/a',
                    booked: 'n/a',
                    departed: 'n/a',
                    docked: 'n/a',
                    undocked: 'n/a',
                    status: 'created',
                    standing: 'n/a',
                    message: 'n/a',

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.error) {
                            this.error = true;
                            this.errorText = result.body.error;

                        } else {
                            this.$router.push('/dispatcher');
                        }
                        this.loading = false;

                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
            },
        },
    });
    Vue.component('vehicle-edit', {
        template: `<div style="text-align: center;margin-top: 50px;">
            <div style="font-size: 40px;color: black;font-weight: bolder;margin: 20px;">
                {{ title }}
            </div>

            <span style="font-size: 24px; color: black;">Created:</span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="created"
            v-model="created"><br>

            <span style="font-size: 24px; color: black;margin-left: 0px;">
                PlateNo:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="plateNo"
            v-on:keypress="clearWarning"
            v-model="plateNo" ><br>

            <span style="font-size: 24px; color: black;margin-left: -30px;">
                VehicleOid:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="vehicleOid"
            v-on:keypress="clearWarning"
            v-model="vehicleOid" ><br>

            <span style="font-size: 24px; color: black;margin-left: -18px;">
                Company:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="company"
            v-on:keypress="clearWarning"
            v-model="companyName" ><br>

            <span style="font-size: 24px; color: black;margin-left: 0px;">
                Arrived:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="arrived"
            v-on:keypress="clearWarning"
            v-model="arrived" ><br>

            <span style="font-size: 24px; color: black;margin-left: 0px;">
                Booked:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="booked"
            v-on:keypress="clearWarning"
            v-model="booked" ><br>

            <span style="font-size: 24px; color: black;margin-left: 0px;">
                Docked:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="docked"
            v-on:keypress="clearWarning"
            v-model="docked" ><br>

            <span style="font-size: 24px; color: black;margin-left: -24px;">
                Undocked:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="undocked"
            v-on:keypress="clearWarning"
            v-model="undocked" ><br>

            <span style="font-size: 24px; color: black;margin-left: -12px;">
                Departed:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="departed"
            v-on:keypress="clearWarning"
            v-model="departed" ><br>

            <span style="font-size: 24px; color: black;margin-left: -10px;">
                Standing:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="standing"
            v-on:keypress="clearWarning"
            v-model="standing" ><br>

            <span style="font-size: 24px; color: black;margin-left: -42px;">
                Set standing:
            </span>
            <select v-model="selected" @change="onChange($event)" style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;">
              <option disabled value="">Choose standing</option>
              <option v-for="option in options" v-bind:value="option">
                {{ option.name }}
              </option>
            </select><br>

            <span style="font-size: 24px; color: black;margin-left: 17px;">
                Status:
            </span>
            <input readonly style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;width: 450px;outline:none;margin-right: 40px;"
            placeholder="status"
            v-on:keypress="clearWarning"
            v-model="status" ><br>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-bottom: 40px; padding-bottom: 10px;text-align: center;">
                <span v-show="invalidStandingValue" style="margin-left: 0px;">Value standing required - please provide.</span>
            </div>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-bottom: 20px; margin-top: -40px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Operation is prohibited for current status  - please change.</span>
            </div>

            <div v-if="error" style="color: red; margin: -20px 0px 20px;">
                Server error - try again
            </div>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./img/loading.gif" alt="">
                </div>
            </div>

            <button style="font-size: 24px;height: 50px;width: 150px;border-radius: 5px;background: yellow;color: blue;outline:none;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;"
            v-on:click="updateVehicle('arrived')">
                Standby
            </button>

            <button style="font-size: 24px;height: 50px;width: 150px;border-radius: 5px;background: green;color: white;outline:none;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;"
            v-on:click="updateVehicle('booked')">
                Booked
            </button>

            <button style="font-size: 24px;height: 50px;width: 150px;border-radius: 5px;background: red;color: white;outline:none;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;"
            v-on:click="updateVehicle('docked')">
                Docked
            </button>

            <button style="font-size: 24px;height: 50px;width: 150px;border-radius: 5px;background: dodgerblue;color: white;outline:none;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;"
            v-on:click="updateVehicle('undocked')">
                Undocked
            </button>

            <button style="font-size: 24px;height: 50px;width: 150px;border-radius: 5px;background: gray;color: white;outline:none;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;"
            v-on:click="updateVehicle('departed')">
                Left
            </button><br>

            <button style="font-size: 24px;height: 50px;width: 150px;border-radius: 5px;background: #01579B;color: white;outline:none;margin-top: 20px;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;"
            v-on:click="goBack">
                Back
            </button><br><br><br><br><br><br><br><br><br><br>

        </div>`,
        data: function () {
            return {
                id: '',
                created: '',
                title: '',
                vehicleOid: '',
                plateNo: '',
                companyName: '',
                arrived: '',
                booked: '',
                docked: '',
                undocked: '',
                departed: '',
                status: '',
                standing: '',
                invalidValue: false,
                invalidStandingValue: false,
                error: false,
                loading: false,
                selected: [],
                locationID: '',
                locationName: '',
                locationStatus: 'booked',
                options: [],
            };
        },
        created() {
            if (!appConfig.item) {
                this.$router.push('/dispatcher');
            } else {
                this.init();
            }
        },
        methods: {
            init() {
                this.locations = [].concat(appConfig.locations);
                var options = [].concat(appConfig.locations);
                this.options = options.filter((el) => el.status === 'blank');

                this.id = appConfig.item.id;
                this.created = new Date(parseInt(appConfig.item.id) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0]
                    + ' ' + new Date(parseInt(appConfig.item.id) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0];
                this.title = appConfig.item.plateNo;
                this.plateNo = appConfig.item.plateNo;
                this.vehicleOid = appConfig.item.vehicleOid;
                this.companyName = appConfig.item.companyName;

                if (appConfig.item.arrived == 'n/a') {
                    this.arrived = appConfig.item.arrived;
                } else {
                    this.arrived = new Date(parseInt(appConfig.item.arrived) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0]
                        + ' ' + new Date(parseInt(appConfig.item.arrived) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0];
                }

                if (appConfig.item.booked == 'n/a') {
                    this.booked = appConfig.item.booked;
                } else {
                    this.booked = new Date(parseInt(appConfig.item.booked) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0]
                        + ' ' + new Date(parseInt(appConfig.item.booked) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0];
                }

                if (appConfig.item.docked == 'n/a') {
                    this.docked = appConfig.item.docked;
                } else {
                    this.docked = new Date(parseInt(appConfig.item.docked) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0]
                        + ' ' + new Date(parseInt(appConfig.item.docked) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0];
                }

                if (appConfig.item.undocked == 'n/a') {
                    this.undocked = appConfig.item.undocked;
                } else {
                    this.undocked = new Date(parseInt(appConfig.item.undocked) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0]
                        + ' ' + new Date(parseInt(appConfig.item.undocked) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0];
                }

                if (appConfig.item.departed == 'n/a') {
                    this.departed = appConfig.item.departed;
                } else {
                    this.departed = new Date(parseInt(appConfig.item.departed) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[0]
                        + ' ' + new Date(parseInt(appConfig.item.departed) - (new Date()).getTimezoneOffset() * 60000).toISOString().split('T')[1].split('.')[0];
                }

                this.standing = appConfig.item.standing;
                this.status = appConfig.item.status;
                this.message = appConfig.item.message;

                if (this.status !== 'arrived') {
                    this.options = [];
                }

                setTimeout(function () {
                    appConfig.$emit('itemsCount', 1)
                }, 100);
            },
            goBack() {
                this.$router.push('/dispatcher');
            },
            updateVehicle(status) {
                this.invalidValue = false;
                this.invalidStandingValue = false;

                if (this.standing !== 'n/a') {
                    let obj = this.locations.filter((el) => (el.name === this.standing));
                    this.locationID = obj[0].id;
                    this.locationName = obj[0].name;
                }

                if ((status === 'booked') || (status === 'docked')) {
                    this.invalidValue = false;
                    if (this.standing === 'n/a') {
                        this.invalidStandingValue = true;
                    }
                }

                //Status - created (arrived)
                if ((this.status === 'created') && (status !== 'arrived')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                //Status - arrived (booked, departed)
                if ((this.status === 'arrived') && (status == 'arrived')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                if ((this.status === 'arrived') && (status == 'docked')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                if ((this.status === 'arrived') && (status == 'undocked')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                //Status - booked (arrived, docked)
                if ((this.status === 'booked') && (status == 'booked')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                if ((this.status === 'booked') && (status == 'undocked')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                if ((this.status === 'booked') && (status == 'departed')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                //Status - docked (undocked)
                if ((this.status === 'docked') && (status !== 'undocked')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                //Status - undocked (arrived, departed)
                if ((this.status === 'undocked') && (status == 'undocked')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                if ((this.status === 'undocked') && (status == 'booked')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                if ((this.status === 'undocked') && (status == 'docked')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                //Status - departed (arrived)
                if ((this.status === 'departed') && (status !== 'arrived')) {
                    this.invalidValue = true;
                    this.invalidStandingValue = false;
                }

                if ((this.invalidValue) || (this.invalidStandingValue)) {
                    return;
                }

                if ((status !== 'booked') && (status !== 'docked')) {
                    this.standing = 'n/a';
                }

                this.locationStatus = status;

                this.loading = true;
                this.$http.post(appConfig.url + 'api/vehicles/update', {
                    id: this.id,
                    vehicleOid: this.vehicleOid,
                    plateNo: this.plateNo,
                    companyName: this.companyName,
                    arrived: this.arrived,
                    booked: this.booked,
                    docked: this.docked,
                    undocked: this.undocked,
                    departed: this.departed,
                    status: status,
                    standing: this.standing,
                    message: this.message,

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.errors) {
                            this.error = true;
                        } else {
                            ws.send(this.plateNo + '###' + status + '###' + this.locationName);
                            this.updateLocation(status);
                        }
                        this.loading = false;
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            updateLocation() {
                var status, vehicle;

                if (this.locationID === '') {
                    this.$router.push('/dispatcher');
                    return;
                }

                switch (this.locationStatus) {
                    case 'booked':
                        status = 'booked';
                        vehicle = this.plateNo;
                        break;
                    case 'docked':
                        status = 'docked';
                        vehicle = this.plateNo;
                        break;
                    default:
                        status = 'blank';
                        vehicle = 'none';
                }

                this.loading = true;
                this.$http.post(appConfig.url + 'api/locations/update', {
                    id: this.locationID,
                    name: this.locationName,
                    vehicle: vehicle,
                    status: status,
                    message: 'n/a',

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.errors) {
                            this.error = true;
                        } else {
                            this.$router.push('/dispatcher');
                        }
                        this.loading = false;
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            deleteItem() {
                this.loading = true;
                this.$http.delete('http://dummy.restapiexample.com/api/v1/delete/' + this.id)
                    .then(result => {
                        this.$router.push('/dispatcher');
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
            },
            onChange(event) {
                this.standing = this.selected.name;
                this.locationName = this.selected.name;
                this.locationID = this.selected.id;
                this.clearWarning();
            }
        },
    });

    Vue.component('vehicles-items-table', {
        template: `<div>
        <div v-if="loading">
            <div style="position: relative; top: 250px; -webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                <img src="./img/loading.gif" alt="">
            </div>
        </div>
        <div v-if="!loading">
            <div style="margin-top: 95px;margin-bottom: 50px;">
                <div style="color: black;border:solid 1px;height: 80px;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;" v-for="item in items" v-on:click1="showDetails(item)">
                    <input v-model="item.plateNo" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <input v-model="item.status" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <input v-model="item.standing" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <button style="height: 40px;border-radius: 5px;width:100px;font-size:20px;" v-on:click="updateItem(item)">Update</button>
                    <button style="height: 40px;border-radius: 5px;width:100px;font-size:20px;" v-on:click="deleteItem(item)">Delete</button>
                    <button style="height: 40px;border-radius: 5px;width:100px;font-size:20px;" v-on:click="cancel">Cancel</button>
                </div>
            </div>
        </div>
        <div v-if="error">
            Server error - try again
        </div>
      </div>`,
        data: function () {
            return {
                items: [],
                searchQuery: '',
                filteredItems: [],
                loading: true,
                error: false,
            };
        },
        created() {
            this.getVehicles();
            appConfig.$on('searchQueryVehicles', searchQuery => {
                let arr = [].concat(appConfig.vehicles);
                let items = arr.filter((el) => el.plateNo.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1);
                this.filteredItems = items;
                this.items = items;

                appConfig.$emit('itemsCount', items.length);
                if (searchQuery === '') {
                    this.items = appConfig.vehicles;
                    this.filteredItems = appConfig.vehicles;
                }
            });
        },
        methods: {
            getVehicles() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/vehicles/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data.sort(this.sort);
                        this.filteredItems = result.data.sort(this.sort);
                        appConfig.vehicles = this.filteredItems.sort(this.sort);
                        this.loading = false;
                        appConfig.$emit('itemsCount', this.items.length);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.$router.push('login');
                    });
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            updateItem(item) {
                this.$http.post(appConfig.url + 'api/vehicles/update', {
                    id: item.id,
                    vehicleOid: item.vehicleOid,
                    plateNo: item.plateNo,
                    companyName: item.companyName,
                    arrived: item.arrived,
                    booked: item.booked,
                    docked: item.docked,
                    undocked: item.undocked,
                    departed: item.departed,
                    status: item.status,
                    standing: item.standing,
                    message: item.message,

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.errors) {
                            this.error = true;
                        } else {
                            this.getVehicles();
                        }
                        this.loading = false;
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            deleteItem(item) {
                this.loading = true;
                this.$http.post(appConfig.url + 'api/vehicles/delete', {
                    id: item.id,
                    authorization: appConfig.access_token
                })
                    .then(result => {
                        this.loading = true;
                        this.getVehicles();
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            cancel() {
                this.loading = true;
                this.getVehicles();
            },
        },
    });
    Vue.component('vehicle-table-add', {
        template: `<div style="text-align: center;margin-top: 120px;">
        <div style="font-size: 40px;
                        color: black;
                        font-weight: bolder;
                        margin: 20px;">New record</div>

            <!--<span style="font-size: 24px; color: black;margin-left: -33px;">Name:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="VehicleOid"
            v-on:keypress="clearWarning"
            v-model="vehicleOid" ><br>

            <!--<span style="font-size: 24px; color: black;margin-left: -41px;">Salary:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="PlateNo"
            v-on:keypress="clearWarning"
            v-model="plateNo"><br>

            <!--<span style="font-size: 24px; color: black;margin-left: -19px;">Age:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="CompanyName"
            v-on:keypress="clearWarning"
            v-model="companyName" ><br>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
            </div>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;"
            v-on:click="addItem">Submit</button>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;margin-top: 20px;"
            v-on:click="goBack">Back</button>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./img/loading.gif" alt="">
                </div>
            </div>

            <div v-if="error" style="color: red; margin-top: 25px;">
                {{errorText}}
            </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        </div>`,
        data: function () {
            return {
                id: '',
                title: '',
                vehicleOid: '',
                plateNo: '',
                companyName: '',
                errorText: '',
                invalidValue: false,
                error: false,
                loading: false,
            };
        },
        created() {
            this.init();
        },
        methods: {
            init() {
                appConfig.getAccessToken();
                setTimeout(function () {
                    appConfig.$emit('itemsCount', 1)
                }, 100);
            },
            goBack() {
                this.$router.push('/vehicles-table');
            },
            addItem() {
                if (this.vehicleOid === '') {
                    this.invalidValue = true;
                }

                if (this.plateNo === '') {
                    this.invalidValue = true;
                }

                if (this.companyName === '') {
                    this.invalidValue = true;
                }

                if (this.invalidValue) {
                    return;
                }

                this.loading = true;
                this.$http.post(appConfig.url + 'api/vehicles/add', {
                    vehicleOid: this.vehicleOid,
                    plateNo: this.plateNo,
                    companyName: this.companyName,
                    arrived: 'n/a',
                    booked: 'n/a',
                    departed: 'n/a',
                    docked: 'n/a',
                    undocked: 'n/a',
                    status: 'created',
                    standing: 'n/a',
                    message: 'n/a',

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.error) {
                            this.error = true;
                            this.errorText = result.body.error;
                        } else {
                            this.$router.push('/vehicles-table');
                        }
                        this.loading = false;

                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
            },
        },
    });

    Vue.component('locations-items', {
        template: `<div>
        <div v-if="loading">
            <div style="position: relative; top: 250px; -webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                <img src="./img/loading.gif" alt="">
            </div>
        </div>
        <div v-if="!loading">
            <div style="margin-top: 96px;margin-bottom: 50px; font-size: 30px">
                <div v-bind:style=renderStatus(item) style="height: 50px; padding-top: 15px;border: 1px solid #d1d1d1; border-top: 1px solid #eee; color: black;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;" v-for="item in items" v-on:click="showDetails(item)">
                    {{ item.name }}
                    <span v-if="item.status=='booked' || item.status=='docked'"> - {{ item.vehicle }}</span>
                </div>
            </div>
        </div>
        <div v-if="error" style="color: red">
            Server error - try again
        </div>
        </div>`,
        data: function () {
            return {
                items: [],
                searchQuery: '',
                filteredItems: [],
                loading: true,
                error: false,
            };
        },
        created() {
            this.getLocations();
            appConfig.$on('searchQueryDispatcher', searchQuery => {
                let arr = [].concat(appConfig.locations);
                let items = arr.filter((el) => el.vehicle.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1);
                this.filteredItems = items;
                this.items = items;

                if (searchQuery === '') {
                    this.items = appConfig.locations;
                    this.filteredItems = appConfig.locations;
                }
            });
            appConfig.$on('filterStatusL', status => {
                let arr = [].concat(appConfig.locations);
                let items = arr.filter((el) => el.status === status);
                if (status === '*') {
                    items = [].concat(appConfig.locations);
                }
                this.filteredItems = items;
                this.items = items;
            });
        },
        methods: {
            renderStatus(item) {
                switch (item.status) {
                    case 'arrived':
                        return {background: 'yellow', color: 'blue'};
                        break;
                    case 'booked':
                        return {background: 'green', color: 'white'};
                        break;
                    case 'docked':
                        return {background: 'red', color: 'white'};
                        break;
                    case 'undocked':
                        return {background: 'dodgerblue', color: 'white'};
                        break;
                    case 'departed':
                        return {background: 'gray', color: 'white'};
                        break;
                }
            },
            getLocations() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/locations/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data.sort(this.sort);
                        this.filteredItems = result.data.sort(this.sort);
                        appConfig.locations = this.filteredItems.sort(this.sort);
                        this.loading = false;
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.$router.push('login');
                    });
            },
            sort(a, b) {
                return parseInt(a.id) - parseInt(b.id);
            },
            showDetails(item) {
                appConfig.item = item;
                this.$router.push('vehicle-edit');
            },
        },
    });
    Vue.component('location-add', {
        template: `<div style="text-align: center;margin-top: 120px;">
        <div style="font-size: 40px;
                        color: black;
                        font-weight: bolder;
                        margin: 20px;">New record</div>

            <!--<span style="font-size: 24px; color: black;margin-left: -33px;">Name:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="Name"
            v-on:keypress="clearWarning"
            v-model="name" ><br>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
            </div>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;"
            v-on:click="addItem">Submit</button>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;margin-top: 20px;"
            v-on:click="goBack">Back</button>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./img/loading.gif" alt="">
                </div>
            </div>

            <div v-if="error" style="color: red; margin-top: 25px;">
                {{errorText}}
            </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        </div>`,
        data: function () {
            return {
                id: '',
                title: '',
                name: '',
                errorText: '',
                invalidValue: false,
                error: false,
                loading: false,
            };
        },
        created() {
            this.init();
        },
        methods: {
            init() {
                appConfig.getAccessToken();
                setTimeout(function () {
                    appConfig.$emit('itemsCount', 1)
                }, 100);
            },
            goBack() {
                this.$router.push('/locations-table');
            },
            addItem() {
                if (this.name === '') {
                    this.invalidValue = true;
                }

                if (this.invalidValue) {
                    return;
                }

                this.loading = true;
                this.$http.post(appConfig.url + 'api/locations/add', {
                    name: this.name,

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.error) {
                            this.error = true;
                            this.errorText = result.body.error;
                        } else {
                            this.$router.push('/locations-table');
                        }
                        this.loading = false;

                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
            },
        },
    });
    Vue.component('locations-items-table', {
        template: `<div>
        <div v-if="loading">
            <div style="position: relative; top: 250px; -webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                <img src="./img/loading.gif" alt="">
            </div>
        </div>
        <div v-if="!loading">
            <div style="margin-top: 95px;margin-bottom: 50px;">
                <div style="color: black;border:solid 1px;height: 80px;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;" v-for="item in items" v-on:click1="showDetails(item)">
                    <input v-model="item.name" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <input v-model="item.status" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 100px;"/>
                    <input v-model="item.vehicle" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <input v-model="item.message" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 100px;"/>
                    <button style="height: 40px;border-radius: 5px;width:100px;font-size:20px;" v-on:click="updateItem(item)">Update</button>
                    <button style="height: 40px;border-radius: 5px;width:100px;font-size:20px;" v-on:click="deleteItem(item)">Delete</button>
                    <button style="height: 40px;border-radius: 5px;width:100px;font-size:20px;" v-on:click="cancel">Cancel</button>
                </div>
            </div>
        </div>
        <div v-if="error">
            Server error - try again
        </div>
      </div>`,
        data: function () {
            return {
                items: [],
                searchQuery: '',
                filteredItems: [],
                loading: true,
                error: false,
            };
        },
        created() {
            this.getLocations();
            appConfig.$on('searchQueryLocations', searchQuery => {
                let arr = [].concat(appConfig.locations);
                let items = arr.filter((el) => el.name.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1);
                this.filteredItems = items;
                this.items = items;

                appConfig.$emit('itemsCount', items.length);
                if (searchQuery === '') {
                    this.items = appConfig.locations;
                    this.filteredItems = appConfig.locations;
                }
            });
        },
        methods: {
            getLocations() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/locations/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data.sort(this.sort);
                        this.filteredItems = result.data.sort(this.sort);
                        appConfig.locations = this.filteredItems.sort(this.sort);
                        this.loading = false;
                        appConfig.$emit('itemsCount', this.items.length);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.$router.push('login');
                    });
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            updateItem(item) {
                this.loading = true;
                this.$http.post(appConfig.url + 'api/locations/update', {
                    id: item.id,
                    name: item.name,
                    vehicle: item.vehicle,
                    status: item.status,
                    message: item.message,
                    authorization: appConfig.access_token
                })
                    .then(result => {
                        this.loading = true;
                        this.getLocations();
                    })
                    .catch(error => {
                        this.error = true;
                    });
            },
            deleteItem(item) {
                this.loading = true;
                this.$http.post(appConfig.url + 'api/locations/delete', {
                    id: item.id,
                    authorization: appConfig.access_token
                })
                    .then(result => {
                        this.loading = true;
                        this.getLocations();
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            cancel() {
                this.loading = true;
                this.getLocations();
            },
        },
    });

    Vue.component('top-driver', {
        template: `<div>
        <div style="float: left; margin: 20px; margin-top: -3px;">
                <span title="Show menu" style="font-size:40px;cursor:pointer; color: black" onclick="openNav()">&#9776;</span>
        </div>
        <div style="margin-top: 15px; color: #01579B; font-size: 50px;margin-right: 100px;">
            YMS - Driver
        </div>
        </div>`,
        data() {
            return {
                searchQuery: '',
            };
        },
        methods: {
            vehicleAdd() {
                appConfig.$emit('route', 'location-add');
            },
            changeView() {
                appConfig.$emit('searchQueryLocations', this.searchQuery);
            },
            searchClear() {
                this.searchQuery = '';
                this.changeView();
            },
            goSearch() {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('searchQueryDispatcher', this.searchQuery);
                }
            },
            filterStatus(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatus', status);
                }
            },
            filterStatusL(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatusL', status);
                }
            }
        },
    });
    Vue.component('driver-reg', {
        template: `<div style="text-align: center;margin-top: 120px;">
        <div style="font-size: 40px;
                        color: black;
                        font-weight: bolder;
                        margin: 30px;margin-top: 250px">Vehicle registration</div>

            <!--<span style="font-size: 24px; color: black;margin-left: -41px;">Salary:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="PlateNo"
            v-on:keypress="clearWarning"
            v-on:keypress.enter="doReg"
            v-model="plateNo"><br>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
            </div>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;"
            v-on:click="doReg">Submit</button>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;margin-top: 20px;"
            v-on:click="doClear">Cancel</button>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./img/loading.gif" alt="">
                </div>
            </div>

            <div v-if="massage" style="color: red; margin-top: 25px;">
                Can't register this PlateNo - try another one
            </div>

            <div v-if="error" style="color: red; margin-top: 25px;">
                Server error - try again
            </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        </div>`,
        data: function () {
            return {
                id: '',
                title: '',
                vehicleOid: '',
                plateNo: '',
                companyName: '',
                invalidValue: false,
                error: false,
                loading: false,
                massage: false
            };
        },
        created() {
            this.init();
        },
        methods: {
            init() {
                appConfig.getAccessToken();
                setTimeout(function () {
                    appConfig.$emit('itemsCount', 1)
                }, 100);
            },
            goBack() {
                this.$router.push('/dispatcher');
            },
            doClear() {
                this.plateNo = '';
                this.massage = false;
                this.invalidValue = false;
            },
            doReg() {
                if (this.plateNo === '') {
                    this.invalidValue = true;
                }

                if (this.invalidValue) {
                    return;
                }

                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.getToken();
                    return;
                }

                this.loading = true;
                this.massage = false;

                this.$http.get(appConfig.url + 'api/vehicles/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data;
                        let arr = this.items.filter((el) => el.plateNo.toLowerCase() === this.plateNo.toLowerCase());
                        if (arr[0]) {
                            if (arr[0].plateNo.toLowerCase() === this.plateNo.toLowerCase()) {
                                appConfig.driver = arr[0];
                                appConfig.driver.reg = new Date(+new Date() - (new Date()).getTimezoneOffset() * 60000).toISOString();

                                this.$http.post(appConfig.url + 'api/audit/add', {
                                    name: this.plateNo,
                                    description: 'Driver - Web',
                                    authorization: appConfig.access_token
                                })
                                    .then(result => {
                                        this.loading = false;
                                        this.$router.push('/driver');
                                    })
                                    .catch(error => {
                                        this.error = true;
                                        this.loading = false;
                                    });
                            }

                        } else {
                            this.massage = true;
                            this.loading = false;
                        }
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.$router.push('/login');
                    });
            },
            getToken() {
                this.error = false;
                this.$http.get(appConfig.url + 'api/auth')
                    .then(result => {
                        appConfig.access_token = result.body.token;
                        localStorage.setItem('access_token', result.body);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
                this.massage = false;
            },
        },
    });
    Vue.component('driver-status', {
        template: `<div style="text-align: center;margin-top: 120px;">
            <div style="font-size: 50px;
                color: white;
                font-weight: bolder;
                margin: 20px;
                background: #01579B;
                height: 85px;
                border-radius: 15px;
                padding-top: 30px;">
                {{driver.plateNo}}
            </div>

            <div style="font-size: 100px;
                color: white;
                font-weight: bolder;
                margin: 20px;
                background: red;
                height: 240px;
                border-radius: 15px;
                padding-top: 120px;">
                {{command}}
            </div>

            <div style="text-align: center;margin-top: 120px;">
            <div style="font-size: 30px;
                color: white;
                font-weight: bolder;
                margin: 20px;
                background: #01579B;
                height: 60px;
                border-radius: 15px;
                padding-top: 30px;
                margin-bottom: 50px;
                margin-top: -100px;">
                {{time}}
            </div>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
            </div>

            <button style="font-size: 24px;
                height: 50px;
                width: 150px;
                border-radius: 5px;
                background: #01579B;
                box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                color: white;outline:none;"
            v-on:click="goBack">Quit</button>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./img/loading.gif" alt="">
                </div>
            </div>

            <div v-if="massage" style="color: red; margin-top: 25px;">
                Can't register this PlateNo - try another one
            </div>

            <div v-if="error" style="color: red; margin-top: 25px;">
                Server error - try again
            </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        </div>`,
        data: function () {
            return {
                id: '',
                title: '',
                time: '',
                plateNo: '',
                companyName: '',
                invalidValue: false,
                error: false,
                loading: false,
                massage: false,
                driver: '',
                command: '',
            };
        },
        created() {
            if (!appConfig.driver) {
                this.$router.push('/driver-reg');
            } else {
                this.init();
            }

            ws.onmessage = (e) => {
                let messageObject = e.data;
                console.log(messageObject);
                if (messageObject.split('###')[0] !== 'still alive') {
                    if (messageObject.split('###')[0] === this.driver.plateNo) {
                        this.status = messageObject.split('###')[1];
                        this.driver.standing = messageObject.split('###')[2];
                        var date = new Date().toJSON().slice(0, 10);
                        var time = new Date().toTimeString().slice(0, 8);
                        this.time = date + ' ' + time;
                        this.renderStatus();
                    }
                }
            };
        },
        methods: {
            init() {
                var date = new Date().toJSON().slice(0, 10);
                var time = new Date().toTimeString().slice(0, 8);
                this.time = date + ' ' + time;
                this.driver = appConfig.driver;
                this.status = appConfig.driver.status;
                this.renderStatus();
                setTimeout(function () {
                    appConfig.$emit('itemsCount', 1)
                }, 100);

            },
            goBack() {
                this.$router.push('/registration');
            },

            renderStatus() {
                switch (this.status) {
                    case 'created':
                        this.command = 'Go to yard';
                        break;
                    case 'arrived':
                        this.command = 'Wait for destination';
                        break;
                    case 'booked':
                        this.command = 'Go to ' + this.driver.standing;
                        break;
                    case 'docked':
                        this.command = 'Wait for undocking';
                        break;
                    case 'undocked':
                        this.command = 'Go from yard';
                        break;
                    case 'departed':
                        this.command = 'You left the yard';
                        break;
                }
            },
        },
    });

    Vue.component('top-audit', {
        template: `<div>
        <div style="float: left; margin: 20px; margin-top: -3px;">
                <span title="Show menu" style="font-size:40px;cursor:pointer; color: black" onclick="openNav()">&#9776;</span>
        </div>
        <div style="margin-top: 15px; color: red; font-size: 50px;margin-right: 100px;">
            <form class="search-form" id="search" style="">
                <label>
                    <input type="text" style="margin-left: -30px;font-size: 24px;height: 50px; width1: 400px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px;outline:none;"
                        placeholder="Search by name"
                        v-model="searchQuery" v-on:click="searchClear" v-on:keyup="changeView" v-on:keyup.enter="goSearch">
                </label>
                <div style="margin-top: -39px;font-size: 30px;margin-left: 230px;color: black;margin-right: -60px;" v-on:click="goSearch"><i class="fa fa-fw fa-search"></i></div>
            </form>
        </div>
        </div>`,
        data() {
            return {
                searchQuery: '',
            };
        },
        methods: {
            vehicleAdd() {
                appConfig.$emit('route', 'location-add');
            },
            changeView() {
                appConfig.$emit('searchQueryLocations', this.searchQuery);
            },
            searchClear() {
                this.searchQuery = '';
                this.changeView();
            },
            goSearch() {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('searchQueryDispatcher', this.searchQuery);
                }
            },
            filterStatus(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatus', status);
                }
            },
            filterStatusL(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatusL', status);
                }
            }
        },
    });
    Vue.component('audit-items', {
        template: `<div>
        <div v-if="loading">
            <div style="position: relative; top: 250px; -webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                <img src="./img/loading.gif" alt="">
            </div>
        </div>
        <div v-if="!loading">
            <div style="margin-top: 96px;margin-bottom: 50px; font-size: 30px">
                <div style="height: 50px; padding-top: 15px;border: 1px solid #d1d1d1; border-top: 1px solid #eee; color: black;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;" v-for="item in items" v-on:click="showDetails(item)">
                    {{ item.name }} - {{ item.date }} - {{ item.description }}
                </div>
            </div>
        </div>
        <div v-if="error" style="color: red">
            Server error - try again
        </div>
        </div>`,
        data: function () {
            return {
                items: [],
                searchQuery: '',
                filteredItems: [],
                loading: true,
                error: false,
            };
        },
        created() {
            this.getAudit();
            appConfig.$on('searchQueryLocations', searchQuery => {
                let arr = [].concat(appConfig.audits);
                let items = arr.filter((el) => el.name.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1);
                this.filteredItems = items;
                this.items = items;

                if (searchQuery === '') {
                    this.items = appConfig.audits;
                    this.filteredItems = appConfig.audits;
                }
                appConfig.$emit('itemsCount', items.length);
            });
        },
        methods: {
            getAudit() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/audit/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data.sort(this.sort);
                        this.filteredItems = result.data.sort(this.sort);
                        appConfig.audits = this.filteredItems.sort(this.sort);
                        this.loading = false;
                        appConfig.$emit('itemsCount', this.items.length);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.$router.push('login');
                    });
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            showDetails(item) {
                appConfig.item = item;
                this.$router.push('vehicle-edit');
            },
        },
    });

    Vue.component('top-operations', {
        template: `<div>
        <div style="float: left; margin: 20px; margin-top: -3px;">
                <span title="Show menu" style="font-size:40px;cursor:pointer; color: black" onclick="openNav()">&#9776;</span>
        </div>
        <div style="margin-top: 15px; color: red; font-size: 50px;margin-right: 100px;">
            <form class="search-form" id="search" style="">
                <label>
                    <input type="text" style="margin-left: -30px;font-size: 24px;height: 50px; width1: 400px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px;outline:none;"
                        placeholder="Search by PlateNo"
                        v-model="searchQuery" v-on:click="searchClear" v-on:keyup="changeView">
                </label>
                <div style="margin-top: -39px;font-size: 30px;margin-left: 230px;color: black;margin-right: -60px;"><i class="fa fa-fw fa-search"></i></div>
            </form>
        </div>
        </div>`,
        data() {
            return {
                searchQuery: '',
            };
        },
        methods: {
            changeView() {
                appConfig.$emit('searchQueryOperations', this.searchQuery);
            },
            searchClear() {
                this.searchQuery = '';
                this.changeView();
            }
        },
    });
    Vue.component('operations-items', {
        template: `<div>
        <div v-if="loading">
            <div style="position: relative; top: 250px; -webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                <img src="./img/loading.gif" alt="">
            </div>
        </div>
        <div v-if="!loading">
            <div style="margin-top: 96px;margin-bottom: 50px; font-size: 30px">
                <div style="height: 50px; padding-top: 15px;border: 1px solid #d1d1d1; border-top: 1px solid #eee; color: black;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;" v-for="item in items" v-on:click="showDetails(item)">
                    {{ item.plateNo }} - {{ item.date }} - {{ item.status }} - {{ item.standing }}
                </div>
            </div>
        </div>
        <div v-if="error" style="color: red">
            Server error - try again
        </div>
        </div>`,
        data: function () {
            return {
                items: [],
                searchQuery: '',
                filteredItems: [],
                loading: true,
                error: false,
            };
        },
        created() {
            this.getOperations();
            appConfig.$on('searchQueryOperations', searchQuery => {
                let arr = [].concat(appConfig.operations);
                let items = arr.filter((el) => el.plateNo.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1);
                this.filteredItems = items;
                this.items = items;

                if (searchQuery === '') {
                    this.items = appConfig.operations;
                    this.filteredItems = appConfig.operations;
                }
                appConfig.$emit('itemsCount', items.length);
            });
        },
        methods: {
            getOperations() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/operations/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data.sort(this.sort);
                        this.filteredItems = result.data.sort(this.sort);
                        appConfig.operations = this.filteredItems.sort(this.sort);
                        this.loading = false;
                        appConfig.$emit('itemsCount', this.items.length);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.$router.push('login');
                    });
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            showDetails(item) {
                appConfig.item = item;
                this.$router.push('vehicle-edit');
            },
        },
    });

    Vue.component('top-targets', {
        template: `<div>
        <div style="float: left; margin: 20px; margin-top: -3px;">
                <span title="Show menu" style="font-size:40px;cursor:pointer; color: black" onclick="openNav()">&#9776;</span>
        </div>
        <div style="margin-top: 15px; color: red; font-size: 50px;margin-right: 100px;">
            <form class="search-form" id="search" style="">
                <label>
                    <input type="text" style="margin-left: -30px;font-size: 24px;height: 50px; width1: 400px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px;outline:none;"
                        placeholder="Search by PlateNo"
                        v-model="searchQuery" v-on:click="searchClear" v-on:keyup="changeView" v-on:keyup.enter="goSearch">
                </label>
                <div style="margin-top: -39px;font-size: 30px;margin-left: 230px;color: black;margin-right: -60px;" v-on:click="goSearch"><i class="fa fa-fw fa-search"></i></div>
            </form>
        </div>
        <div style="float: right; margin: -113px 40px;">
                <span title="Add item" style="font-size:70px;cursor:pointer; color: black" v-on:click="vehicleAdd()">&#43;</span>
        </div>
        </div>`,
        data() {
            return {
                searchQuery: '',
            };
        },
        methods: {
            vehicleAdd() {
                appConfig.$emit('route', 'target-add');
            },
            changeView() {
                appConfig.$emit('searchQueryTargets', this.searchQuery);
            },
            searchClear() {
                this.searchQuery = '';
                this.changeView();
            },
            goSearch() {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('searchQueryDispatcher', this.searchQuery);
                }
            },
            filterStatus(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatus', status);
                }
            },
            filterStatusL(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatusL', status);
                }
            }
        },
    });
    Vue.component('targets-items-table', {
        template: `<div>
        <div v-if="loading">
            <div style="position: relative; top: 250px; -webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                <img src="./img/loading.gif" alt="">
            </div>
        </div>
        <div v-if="!loading">
            <div style="margin-top: 95px;margin-bottom: 50px;">
                <div style="color: black;border:solid 1px;height: 80px;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;" v-for="item in items" v-on:click1="showDetails(item)">
                    <input v-model="item.vehicle" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <input v-model="item.lat" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <input v-model="item.lng" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <input v-model="item.date" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <button style="height: 40px;border-radius: 5px;width:100px;font-size:20px;" v-on:click="updateItem(item)">Update</button>
                    <button style="height: 40px;border-radius: 5px;width:100px;font-size:20px;" v-on:click="deleteItem(item)">Delete</button>
                    <button style="height: 40px;border-radius: 5px;width:100px;font-size:20px;" v-on:click="cancel">Cancel</button>
                </div>
            </div>
        </div>
        <div v-if="error">
            Server error - try again
        </div>
      </div>`,
        data: function () {
            return {
                items: [],
                searchQuery: '',
                filteredItems: [],
                loading: true,
                error: false,
            };
        },
        created() {
            this.getTargets();
            appConfig.$on('searchQueryTargets', searchQuery => {
                let arr = [].concat(appConfig.targets);
                let items = arr.filter((el) => el.vehicle.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1);
                this.filteredItems = items;
                this.items = items;

                appConfig.$emit('itemsCount', items.length);
                if (searchQuery === '') {
                    this.items = appConfig.targets;
                    this.filteredItems = appConfig.targets;
                }
            });
        },
        methods: {
            getTargets() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/targets/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data.sort(this.sort);
                        this.filteredItems = result.data.sort(this.sort);
                        appConfig.targets = this.filteredItems.sort(this.sort);
                        this.loading = false;
                        appConfig.$emit('itemsCount', this.items.length);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.$router.push('login');
                    });
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            updateItem(item) {
                this.loading = true;
                this.$http.post(appConfig.url + 'api/targets/update', {
                    id: item.id,
                    vehicle: item.vehicle,
                    lat: item.lat,
                    lng: item.lng,
                    authorization: appConfig.access_token
                })
                    .then(result => {
                        this.loading = true;
                        this.getTargets();
                    })
                    .catch(error => {
                        this.error = true;
                    });
            },
            deleteItem(item) {
                this.loading = true;
                this.$http.post(appConfig.url + 'api/targets/delete', {
                    id: item.id,
                    authorization: appConfig.access_token
                })
                    .then(result => {
                        this.loading = true;
                        this.getTargets();
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            cancel() {
                this.loading = true;
                this.getTargets();
            },
        },
    });
    Vue.component('target-add', {
        template: `<div style="text-align: center;margin-top: 120px;">
        <div style="font-size: 40px;
                        color: black;
                        font-weight: bolder;
                        margin: 20px;">New record</div>

            <!--<span style="font-size: 24px; color: black;margin-left: -41px;">Salary:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="PlateNo"
            v-on:keypress="clearWarning"
            v-model="plateNo"><br>

            <!--<span style="font-size: 24px; color: black;margin-left: -33px;">Name:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="Latitude"
            v-on:keypress="clearWarning"
            v-model="lat" ><br>

            <!--<span style="font-size: 24px; color: black;margin-left: -19px;">Age:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="Longitude"
            v-on:keypress="clearWarning"
            v-model="lng" ><br>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
            </div>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;"
            v-on:click="addItem">Submit</button>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;margin-top: 20px;"
            v-on:click="goBack">Back</button>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./img/loading.gif" alt="">
                </div>
            </div>

            <div v-if="error" style="color: red; margin-top: 25px;">
                {{errorText}}
            </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        </div>`,
        data: function () {
            return {
                id: '',
                title: '',
                plateNo: '',
                lat: '',
                lng: '',
                errorText: '',
                invalidValue: false,
                error: false,
                loading: false,
            };
        },
        created() {
            this.init();
        },
        methods: {
            init() {
                appConfig.getAccessToken();
                setTimeout(function () {
                    appConfig.$emit('itemsCount', 1)
                }, 100);
            },
            goBack() {
                this.$router.push('/targets');
            },
            addItem() {
                if (this.plateNo === '') {
                    this.invalidValue = true;
                }

                if (this.lat === '') {
                    this.invalidValue = true;
                }

                if (this.lng === '') {
                    this.invalidValue = true;
                }

                if (this.invalidValue) {
                    return;
                }

                this.loading = true;
                this.$http.post(appConfig.url + 'api/targets/add', {
                    vehicle: this.plateNo,
                    lat: this.lat,
                    lng: this.lng,

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.error) {
                            this.error = true;
                            this.errorText = result.body.error;
                        } else {
                            this.$router.push('/targets');
                        }
                        this.loading = false;
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
            },
        },
    });

    Vue.component('top-positions', {
        template: `<div>
        <div style="float: left; margin: 20px; margin-top: -3px;">
                <span title="Show menu" style="font-size:40px;cursor:pointer; color: black" onclick="openNav()">&#9776;</span>
        </div>
        <div style="margin-top: 15px; color: red; font-size: 50px;margin-right: 100px;">
            <form class="search-form" id="search" style="">
                <label>
                    <input type="text" style="margin-left: -30px;font-size: 24px;height: 50px; width1: 400px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px;outline:none;"
                        placeholder="Search by name"
                        v-model="searchQuery" v-on:click="searchClear" v-on:keyup="changeView" v-on:keyup.enter="goSearch">
                </label>
                <div style="margin-top: -39px;font-size: 30px;margin-left: 230px;color: black;margin-right: -60px;" v-on:click="goSearch"><i class="fa fa-fw fa-search"></i></div>
            </form>
        </div>
        <div style="float: right; margin: -113px 40px;">
                <span title="Add item" style="font-size:70px;cursor:pointer; color: black" v-on:click="vehicleAdd()">&#43;</span>
        </div>
        </div>`,
        data() {
            return {
                searchQuery: '',
            };
        },
        methods: {
            vehicleAdd() {
                appConfig.$emit('route', 'position-add');
            },
            changeView() {
                appConfig.$emit('searchQueryPositions', this.searchQuery);
            },
            searchClear() {
                this.searchQuery = '';
                this.changeView();
            },
            goSearch() {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('searchQueryDispatcher', this.searchQuery);
                }
            },
            filterStatus(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatus', status);
                }
            },
            filterStatusL(status) {
                if (appConfig.route === 'dispatcher') {
                    appConfig.$emit('filterStatusL', status);
                }
            }
        },
    });
    Vue.component('positions-items-table', {
        template: `<div>
        <div v-if="loading">
            <div style="position: relative; top: 250px; -webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                <img src="./img/loading.gif" alt="">
            </div>
        </div>
        <div v-if="!loading">
            <div style="margin-top: 95px;margin-bottom: 50px;">
                <div style="color: black;border:solid 1px;height: 80px;box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;" v-for="item in items" v-on:click1="showDetails(item)">
                    <input v-model="item.vehicle" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <input v-model="item.lat" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <input v-model="item.lng" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <input v-model="item.date" style="border-radius: 5px;height: 40px;margin: 20px;font-size: 20px;width: 200px;"/>
                    <button style="height: 40px;border-radius: 5px;width:100px;font-size:20px;" v-on:click="updateItem(item)">Update</button>
                    <button style="height: 40px;border-radius: 5px;width:100px;font-size:20px;" v-on:click="deleteItem(item)">Delete</button>
                    <button style="height: 40px;border-radius: 5px;width:100px;font-size:20px;" v-on:click="cancel">Cancel</button>
                </div>
            </div>
        </div>
        <div v-if="error">
            Server error - try again
        </div>
      </div>`,
        data: function () {
            return {
                items: [],
                searchQuery: '',
                filteredItems: [],
                loading: true,
                error: false,
            };
        },
        created() {
            this.getPositions();
            appConfig.$on('searchQueryPositions', searchQuery => {
                let arr = [].concat(appConfig.positions);
                let items = arr.filter((el) => el.vehicle.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1);
                this.filteredItems = items;
                this.items = items;

                appConfig.$emit('itemsCount', items.length);
                if (searchQuery === '') {
                    this.items = appConfig.positions;
                    this.filteredItems = appConfig.positions;
                }
            });
        },
        methods: {
            getPositions() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/positions/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data.sort(this.sort);
                        this.filteredItems = result.data.sort(this.sort);
                        appConfig.positions = this.filteredItems.sort(this.sort);
                        this.loading = false;
                        appConfig.$emit('itemsCount', this.items.length);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.$router.push('login');
                    });
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            updateItem(item) {
                this.loading = true;
                this.$http.post(appConfig.url + 'api/positions/update', {
                    id: item.id,
                    vehicle: item.vehicle,
                    lat: item.lat,
                    lng: item.lng,
                    authorization: appConfig.access_token
                })
                    .then(result => {
                        this.loading = true;
                        this.getPositions();
                    })
                    .catch(error => {
                        this.error = true;
                    });
            },
            deleteItem(item) {
                this.loading = true;
                this.$http.post(appConfig.url + 'api/positions/delete', {
                    id: item.id,
                    authorization: appConfig.access_token
                })
                    .then(result => {
                        this.loading = true;
                        this.getPositions();
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            cancel() {
                this.loading = true;
                this.getPositions();
            },
        },
    });
    Vue.component('position-add', {
        template: `<div style="text-align: center;margin-top: 120px;">
        <div style="font-size: 40px;
                        color: black;
                        font-weight: bolder;
                        margin: 20px;">New record</div>

            <!--<span style="font-size: 24px; color: black;margin-left: -41px;">Salary:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="PlateNo"
            v-on:keypress="clearWarning"
            v-model="plateNo"><br>

            <!--<span style="font-size: 24px; color: black;margin-left: -33px;">Name:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="Latitude"
            v-on:keypress="clearWarning"
            v-model="lat" ><br>

            <!--<span style="font-size: 24px; color: black;margin-left: -19px;">Age:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="Longitude"
            v-on:keypress="clearWarning"
            v-model="lng" ><br>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
            </div>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;"
            v-on:click="addItem">Submit</button>

            <button style="font-size: 24px;
                            height: 50px;
                            width: 150px;
                            border-radius: 5px;
                            background: #01579B;
                            box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                            color: white;outline:none;margin-top: 20px;"
            v-on:click="goBack">Back</button>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./img/loading.gif" alt="">
                </div>
            </div>

            <div v-if="error" style="color: red; margin-top: 25px;">
                {{errorText}}
            </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        </div>`,
        data: function () {
            return {
                id: '',
                title: '',
                plateNo: '',
                lat: '',
                lng: '',
                errorText: '',
                invalidValue: false,
                error: false,
                loading: false,
            };
        },
        created() {
            this.init();
        },
        methods: {
            init() {
                appConfig.getAccessToken();
                setTimeout(function () {
                    appConfig.$emit('itemsCount', 1)
                }, 100);
            },
            goBack() {
                this.$router.push('/positions');
            },
            addItem() {
                if (this.plateNo === '') {
                    this.invalidValue = true;
                }

                if (this.lat === '') {
                    this.invalidValue = true;
                }

                if (this.lng === '') {
                    this.invalidValue = true;
                }

                if (this.invalidValue) {
                    return;
                }

                this.loading = true;
                this.$http.post(appConfig.url + 'api/positions/add', {
                    vehicle: this.plateNo,
                    lat: this.lat,
                    lng: this.lng,

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.error) {
                            this.error = true;
                            this.errorText = result.body.error;
                        } else {
                            this.$router.push('/positions');
                        }
                        this.loading = false;
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
            },
        },
    });

    Vue.component('top-map', {
        template: `<div>
        <div style="float: left; margin: 20px; margin-top: -3px;">
                <span title="Show menu" style="font-size:40px;cursor:pointer; color: black" onclick="openNav()">&#9776;</span>
        </div>
        <div style="margin-top: 15px; color: #01579B; font-size: 50px;margin-right: 100px;">
            Google Maps API Demo
        </div>
        </div>`,
        data() {
            return {
                searchQuery: '',
            };
        },
        methods: {
            changeView() {
                appConfig.$emit('searchQuery', this.searchQuery);
            },
            searchClear() {
                this.searchQuery = '';
                appConfig.$emit('searchQuery', this.searchQuery);
            },
        },
    });
    Vue.component('googleMap', {
        template: `<div>
            <img v-if="loading" style="position: absolute; margin-left: -160px; top: 300px; z-index: 100" src="./img/loading.gif" alt="">
            <div class="middle" id="map"></div>
        </div>`,
        data() {
            return {
                map: '',
                items: [],
                loading: false,
                error: false,
                symbolOne: {
                    path: 'M -2,0 0,-2 2,0 0,2 z',
                    strokeColor: 'gold',
                    fillColor: 'gold',
                    fillOpacity: 1,
                    scale: 3,
                },
                image: './img/blue-circle.png',
                truck: './img/truck.png',
                truck_f: './img/truck_f.png',
                truck_long: './img/truck-long.png',
                locations: [
                    ['<div style="margin: 0px; color: black"><img src="./img/blue-circle.png" style="margin: 15px; width: 200px"><br><b>Point1</b></div>', 49.093086, 8.533068, 1],
                    ['Point2', 49.147995, 8.559998, 2],
                    ['Point3', 49.116544, 8.551161, 3]
                ],
                flightPath: new google.maps.Polyline({
                    path: [
                        {lat: 49.093086, lng: 8.533068},
                        {lat: 49.106580, lng: 8.544306},
                        {lat: 49.116544, lng: 8.551161},
                        {lat: 49.128808, lng: 8.550718},
                        {lat: 49.133488, lng: 8.551667},
                        {lat: 49.147995, lng: 8.559998},
                    ],
                    geodesic: true,
                    strokeColor: '#01579B',
                    strokeOpacity: 1.0,
                    strokeWeight: 6
                })
            }
        },
        created() {
            this.init();

            appConfig.$on('init', searchQuery => {
                this.init();
            });
            appConfig.$on('set', searchQuery => {
                this.getAllPositions();
            });
            appConfig.$on('show', searchQuery => {
                this.getSpecificPositionDataFromStart();
            });
            appConfig.$on('get', searchQuery => {
                this.getPos();
            });
            appConfig.$on('yard', searchQuery => {
                this.yard();
            });

            appConfig.$on('loaded', searchQuery => {
                this.loading = false;
            });

            appConfig.$on('error', searchQuery => {
                alert('Someting went wrong - server error');
            });

            /*            Notification.requestPermission().then(function (result) {
                            /!*let notification = new Notification('VU-Demo', {
                                icon: '../img/message.jpg',
                                body: 'Hey there! Chat is started!',
                            });*!/
                        });*/

            /*            if (window.ws === undefined) {
                            window.ws = new WebSocket('wss://jwt-chat.herokuapp.com');
                        }

                        ws.onmessage = (e) => {
                            let messageObject = e.data;
                            if (messageObject.split('###')[0] !== 'still alive') {
                                this.items.unshift({
                                    id: +new Date(),
                                    name: messageObject.split('###')[1],
                                    date: messageObject.split('###')[2],
                                    message: messageObject.split('###')[0]
                                });

                                let notification = new Notification('VU-Demo', {
                                    icon: './img/message.jpg',
                                    body: messageObject.split('###')[0],
                                });

                                switch (messageObject.split('###')[0].toLowerCase()) {
                                    case 'reload':
                                        appConfig.$emit('init', {});
                                        break;
                                    case 'set':
                                        appConfig.$emit('set', {});
                                        break;
                                    case 'show':
                                        appConfig.$emit('show', {});
                                        break;
                                    case 'get':
                                        appConfig.$emit('get', {});
                                        break;
                                    case 'yard':
                                        appConfig.$emit('yard', {});
                                        break;
                                }
                            }
                        };*/
        },
        methods: {
            init() {
                this.loading = true;
                setTimeout(this.setMap, 100);
                this.getVehiclesPositions();
                appConfig.map = true;
            },
            setMap() {
                let lat = '50.4272102';
                let lng = '30.6206667';

                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 11,
                    center: new google.maps.LatLng(lat, lng),
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                    //mapTypeId: google.maps.MapTypeId.SATELLITE
                });

                map.setCenter(new google.maps.LatLng(lat, lng));
                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(lat, lng),
                    draggable: true,
                    //animation: google.maps.Animation.BOUNCE,
                    icon: this.image,
                    map: map
                });
            },
            getPos() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(this.showPosition);
                } else {
                    alert("Geolocation is not supported by this browser.");
                }
            },
            showPosition(position) {
                let lat = position.coords.latitude;
                let lng = position.coords.longitude;

                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 11,
                    center: new google.maps.LatLng(lat, lng),
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                    //mapTypeId: google.maps.MapTypeId.SATELLITE
                });

                map.setCenter(new google.maps.LatLng(lat, lng));
                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(lat, lng),
                    draggable: true,
                    //animation: google.maps.Animation.BOUNCE,
                    icon: this.image,
                    map: map
                });
            },
            getVehiclesPositions() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/targets/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.positions = result.body.sort(this.sort);
                        appConfig.positions = result.body.sort(this.sort);
                        this.setPoints();
                        this.loading = false;
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.$router.push('login');
                    });
            },
            setPoints() {
                var infowindow = new google.maps.InfoWindow();
                var that = this;
                for (var i = 0; i < this.positions.length; i++) {
                    marker = new google.maps.Marker({
                        position: new google.maps.LatLng(this.positions[i].lat, this.positions[i].lng),
                        map: map
                    });
                    let positions = this.positions.map((item) => ['<h3>PlateNo: ' + item.vehicle + '&nbsp&nbsp&nbsp</h3><hr>'
                    + item.date + '<br><br>', item.lat, item.lng, item.vehicle]);
                    google.maps.event.addListener(marker, 'click', (function (marker, i) {
                        return function () {
                            infowindow.setContent(positions[i][0]);
                            infowindow.open(map, marker);
                            that.drawVehicleRoutes(positions[i][3])
                        }
                    })(marker, i));
                }
            },
            drawVehicleRoutes(vehicle) {
                this.$http.get(appConfig.url + 'api/positions/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.body;
                        let path = [];
                        let items = this.items.filter(item => item.vehicle === vehicle);

                        items.forEach((item) => {
                            let obj = {};
                            obj.lat = parseFloat(item.lat);
                            obj.lng = parseFloat(item.lng);
                            path.push(obj)
                        });

                        this.flightPath.setMap(null);
                        this.flightPath = new google.maps.Polyline({
                            path: path,
                            geodesic: true,
                            strokeColor: '#01579B',
                            strokeOpacity: 1.0,
                            strokeWeight: 6
                        });
                        this.flightPath.setMap(map);
                    })
                    .catch(error => {
                        appConfig.$emit('loaded', {});
                        appConfig.$emit('error', {});
                    });
            },
            showRoutes() {
                this.flightPath.setMap(map);
            },
        },
    });

    Vue.component('top-guests', {
        template: `<div>
        <div style="float: left; margin: 20px; margin-top: -3px;">
                <span title="Show menu" style="font-size:40px;cursor:pointer; color: black" onclick="openNav()">&#9776;</span>
        </div>
        <div style="margin-top: 15px; color: red; font-size: 50px;margin-right: 100px;">
            <form class="search-form" id="search" style="">
                <label>
                    <input type="text" style="margin-left: -30px;font-size: 24px;height: 50px; width1: 400px;padding: 20px;border-radius: 7px;border: 1px solid rgba(0,0,0,.15);margin-top: 2px;outline:none;"
                        placeholder="Search by name"
                        v-model="searchQuery" v-on:click="searchClear" v-on:keyup="changeView" v-on:keyup.enter="changeView">
                </label>
                <div style="margin-top: -39px;font-size: 30px;margin-left: 230px;color: black;margin-right: -60px;" v-on:click="changeView"><i class="fa fa-fw fa-search"></i></div>
            </form>
        </div>
        <div style="float: right; margin: -113px 40px;">
                <span title="Add item" style="font-size:70px;cursor:pointer; color: black" v-on:click="vehicleAdd()">&#43;</span>
        </div>
        </div>`,
        data() {
            return {
                searchQuery: '',
            };
        },
        methods: {
            vehicleAdd() {
                appConfig.$emit('route', 'guest-add');
            },
            changeView() {
                appConfig.$emit('searchQueryGuests', this.searchQuery);
            },
            searchClear() {
                this.searchQuery = '';
                this.changeView();
            },
        },
    });
    Vue.component('guests-items-table', {
        template: `<div>
        <div v-if="loading">
            <div style="position: relative; top: 250px; -webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                <img src="./img/loading.gif" alt="">
            </div>
        </div>
        <div v-if="!loading">
            <div style="margin-top: 96px;margin-bottom: 50px; font-size: 30px">
                <div v-bind:style=renderStatus(item) style="height: 150px;border: 1px solid #d1d1d1; border-top: 1px solid #eee; color: black; box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;" v-for="item in items" v-on:click="showDetails(item)">
                    <div style="float: left;width: 20%;border-radius: 10px; margin-top: 15px;">
                        <img :src="item.photo=='blank' ? './img/no-img.png' : item.photo" style="width: 120px;height: 120px;border-radius: 16px;">
                    </div>
                    <div style="float: left; width: 80%; margin-top: 55px;">
                        {{item.name}} - {{item.host}} - {{item.date}} - {{item.status}}
                    </div>
                </div>
            </div>
        </div>
        <div v-if="error">
            Server error - try again
        </div>
      </div>`,
        data: function () {
            return {
                items: [],
                searchQuery: '',
                filteredItems: [],
                loading: true,
                error: false,
            };
        },
        created() {
            this.getGuests();
            appConfig.$on('searchQueryGuests', searchQuery => {
                let arr = [].concat(appConfig.guests);
                let items = arr.filter((el) => el.name.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1);
                this.filteredItems = items;
                this.items = items;

                appConfig.$emit('itemsCount', items.length);
                if (searchQuery === '') {
                    this.items = appConfig.guests;
                    this.filteredItems = appConfig.guests;
                }
            });
        },
        methods: {
            renderStatus(item) {
                switch (item.status) {
                    case 'arrived':
                        return {
                            background: 'white',
                            color: 'blue'
                        };
                        break;
                    case 'booked':
                        return {
                            background: 'green',
                            color: 'white'
                        };
                        break;
                    case 'docked':
                        return {
                            background: 'red',
                            color: 'white'
                        };
                        break;
                    case 'undocked':
                        return {
                            background: 'dodgerblue',
                            color: 'white'
                        };
                        break;
                    case 'departed':
                        return {
                            background: 'gray',
                            color: 'white'
                        };
                        break;
                }
            },
            getGuests() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/guests/get', {
                    headers: {'Authorization': appConfig.access_token}
                })
                    .then(result => {
                        this.items = result.data.sort(this.sort);
                        this.filteredItems = result.data.sort(this.sort);
                        appConfig.guests = this.filteredItems.sort(this.sort);
                        this.loading = false;
                        appConfig.$emit('itemsCount', this.items.length);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                        this.$router.push('login');
                    });
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            showDetails(item) {
                appConfig.item = item;
                this.$router.push('guest-edit');
            }
        },
    });
    Vue.component('guest-add', {
        template: `<div style="text-align: center;margin-top: 120px;">
            <div style="font-size: 40px;color: #01579B;font-weight: bolder;margin: 30px;margin-top: 50px"
                v-on:click="doPlay()">
                    Guest registration
            </div>

            <!--<span style="font-size: 24px; color: black;margin-left: -41px;">Salary:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="Name"
            v-on:keypress="clearWarning"
            v-on:keypress.enter="doReg"
            v-model="name"><br>

            <!--<span style="font-size: 24px; color: black;margin-left: -41px;">Salary:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px;"
            placeholder="Host"
            v-on:keypress="clearWarning"
            v-on:keypress.enter="doReg"
            v-model="host"><br>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
            </div>

            <button style="font-size: 24px;
                height: 50px;
                width: 150px;
                border-radius: 5px;
                background: #01579B;
                box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                color: white;outline:none;"
            v-on:click="addItem">Submit</button>

            <button style="font-size: 24px;
                height: 50px;
                width: 150px;
                border-radius: 5px;
                background: #01579B;
                box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                color: white;outline:none;margin-top: 20px;"
            v-on:click="goBack">Back</button>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./img/loading.gif" alt="">
                </div>
            </div>

            <div v-if="massage" style="color: red; margin-top: 25px;">
                Can't register this PlateNo - try another one
            </div>

            <div v-if="error" style="color: red; margin-top: 25px;">
                Server error - try again
            </div><br><br><br>
        </div>`,
        data: function () {
            return {
                id: '',
                title: '',
                name: '',
                photo: '',
                host: '',
                invalidValue: false,
                error: false,
                loading: false,
                massage: false
            };
        },
        created() {
            this.init();
        },
        methods: {
            init() {
                appConfig.getAccessToken();
                setTimeout(function () {
                    appConfig.$emit('itemsCount', 1);
                }, 100);
            },
            goBack() {
                this.$router.push('/guests');
            },
            doClear() {
                this.name = '';
                this.massage = false;
                this.invalidValue = false;
            },
            addItem() {
                if (this.name === '') {
                    this.invalidValue = true;
                }

                if (this.host === '') {
                    this.invalidValue = true;
                }

                if (this.invalidValue) {
                    return;
                }

                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.getToken();
                    return;
                }

                this.loading = true;
                this.$http.post(appConfig.url + 'api/guests/add', {
                    photo: 'blank',
                    name: this.name,
                    host: this.host,
                    status: 'created',

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.error) {
                            this.error = true;
                            this.errorText = result.body.error;
                        } else {
                            this.$router.push('/guests');
                        }
                        this.loading = false;
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            getToken() {
                this.error = false;
                this.$http.get(appConfig.url + 'api/auth')
                    .then(result => {
                        appConfig.access_token = result.body.token;
                        localStorage.setItem('access_token', result.body);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
                this.massage = false;
            },
        },
    });
    Vue.component('guest-edit', {
        template: `<div style="text-align: center;margin-top: 120px;">
            <div style="font-size: 40px;color: #01579B;font-weight: bolder;margin: 30px;margin-top: 50px"
                v-on:click="doPlay()">
                    {{name}}
            </div>

            <div id="container" style="position: relative;" v-on:click="takePicture()">
                <div class="camera" style="position: absolute;top: 0;left:0;width: 100%;height: 100%;border-radius: 10px;">
                    <video id="video" style="border-radius: 10px;">Video stream not available.</video>
                </div>
                <div>
                    <canvas id="canvas" style="z-index: 10;width: 645px;height: 430px;border-radius: 10px;"></canvas>
                </div>
                <div id='photo' style="position: absolute;top: 0;left:0;width: 100%;height: 100%;border-radius: 10px;">
                    <img :src="this.photo" style="z-index: 10;width: 645px;height: 430px;border-radius: 10px;">
                </div>
            </div>
            <hr>

            <!--<span style="font-size: 24px; color: black;margin-left: -41px;">Salary:</span>-->
            <input style="font-size: 24px;height: 50px;padding: 20px;border-radius: 7px;
            border: 1px solid rgba(0,0,0,.15);margin-top: 2px; margin-bottom: 20px;
            width: 450px;outline:none;margin-right: 0px; "
            placeholder="Host"
            readonly
            v-on:keypress="clearWarning"
            v-on:keypress.enter="doReg"
            v-model="host"><br>

            <div style="font-weight: bold; font-size: 18px; color: #dc3545; margin-top: 0px; text-align: center;">
                <span v-show="invalidValue" style="margin-left: 0px;">Value required - please provide.</span>
            </div>

            <button style="font-size: 24px;
                height: 50px;
                width: 150px;
                border-radius: 5px;
                background: #01579B;
                box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                color: white;outline:none;"
            v-on:click="addItem">Submit</button>

            <button style="font-size: 24px;
                height: 50px;
                width: 150px;
                border-radius: 5px;
                background: #01579B;
                box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
                color: white;outline:none;margin-top: 20px;"
            v-on:click="goBack">Back</button>

            <div v-if="loading">
                <div style="margin-top: -55px;-webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box; font-size:54px">
                    <img src="./img/loading.gif" alt="">
                </div>
            </div>

            <div v-if="massage" style="color: red; margin-top: 25px;">
                Can't register this PlateNo - try another one
            </div>

            <div v-if="error" style="color: red; margin-top: 25px;">
                Server error - try again
            </div><br><br>
        </div>`,
        data: function () {
            return {
                id: '',
                title: '',
                name: '',
                photo: '',
                host: '',
                status: '',
                invalidValue: false,
                error: false,
                loading: false,
                massage: false
            };
        },
        created() {
            if (!appConfig.item) {
                this.$router.push('/guests');
            } else {
                this.init();
            }
        },
        methods: {
            init() {
                appConfig.getAccessToken();

                this.photo = appConfig.item.photo;
                if (this.photo === 'blank') {
                    this.photo = './img/no-img.png';
                }

                this.name = appConfig.item.name;
                this.host = appConfig.item.host;
                this.status = appConfig.item.status;

                setTimeout(function () {
                    appConfig.$emit('itemsCount', 1);

                    photo = document.getElementById('photo');
                    canvas = document.getElementById('canvas');
                    context = canvas.getContext('2d');
                    context.fillStyle = "#AAA";
                    context.fillRect(0, 0, canvas.width, canvas.height);

                    width = 240;
                    height = 0;
                    video = document.getElementById('video');
                }, 100);

                if (this.status === 'created') {
                    var that = this;
                    setTimeout(function () {
                        that.doPlay();
                    }, 100);
                }
            },
            doPlay() {
                photo.setAttribute("style", "display:none;width:100%;height: 100%;");
                navigator.mediaDevices.getUserMedia({audio: false, video: {width: 240, height: 160}})
                    .then(function (stream) {
                        video.srcObject = stream;
                        video.play();
                        height = video.videoHeight / (video.videoWidth / width);
                        height = width / (4 / 3);
                        video.setAttribute("style", "display:block;width:100%;height: 100%;");
                    })
                    .catch(function (err) {
                        console.log("An error occurred: " + err);
                    });
            },
            doStop() {
                video.srcObject.getTracks()[0].stop();
            },
            takePicture() {
                canvas = document.getElementById('canvas');
                photo = document.getElementById('photo');
                var context = canvas.getContext('2d');

                canvas.width = width;
                canvas.height = height;
                context.drawImage(video, 0, 0, width, height);

                this.photo = canvas.toDataURL('image/png');
                video.srcObject.getTracks()[0].stop();
                video.setAttribute("style", "display:none;width:100%;height: 100%;");
            },
            goBack() {
                if (video.srcObject) {
                    video.srcObject.getTracks()[0].stop();
                }
                this.$router.push('/guests');
            },
            doClear() {
                this.name = '';
                this.massage = false;
                this.invalidValue = false;
            },
            addItem() {
                if (this.name === '') {
                    this.invalidValue = true;
                }

                if (this.photo === '') {
                    this.invalidValue = true;
                }

                if (this.invalidValue) {
                    return;
                }

                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.getToken();
                    return;
                }

                this.loading = true;
                this.$http.post(appConfig.url + 'api/guests/add', {
                    photo: this.photo,
                    name: this.name,
                    host: this.host,
                    status: 'arrived',

                    authorization: appConfig.access_token
                })
                    .then(result => {
                        if (result.body.error) {
                            this.error = true;
                            this.errorText = result.body.error;
                        } else {
                            if (video.srcObject) {
                                video.srcObject.getTracks()[0].stop();
                            }
                            this.$router.push('/guests');
                        }
                        this.loading = false;
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            getToken() {
                this.error = false;
                this.$http.get(appConfig.url + 'api/auth')
                    .then(result => {
                        appConfig.access_token = result.body.token;
                        localStorage.setItem('access_token', result.body);
                    })
                    .catch(error => {
                        this.error = true;
                        this.loading = false;
                    });
            },
            clearWarning() {
                this.invalidValue = false;
                this.massage = false;
            },
        },
    });

    const routes = [
        {path: '/', component: Login},
        {path: '*', component: Login},
        {path: '/dispatcher', component: Dispatcher},
        {path: '/vehicle-add', component: VehicleAdd},
        {path: '/vehicle-edit', component: VehiclesEdit},
        {path: '/vehicles-table', component: VehiclesTable},
        {path: '/vehicle-table-add', component: VehiclesTableAdd},
        {path: '/registration', component: DriverReg},
        {path: '/driver', component: DriverStatus},
        {path: '/locations-table', component: LocationsTable},
        {path: '/location-add', component: LocationAdd},
        {path: '/audit', component: Audit},
        {path: '/operations', component: Operations},
        {path: '/targets', component: Targets},
        {path: '/target-add', component: TargetAdd},
        {path: '/positions', component: Positions},
        {path: '/position-add', component: PositionAdd},
        {path: '/map', component: GoogleMap},
        {path: '/guests', component: Guests},
        {path: '/guest-add', component: GuestAdd},
        {path: '/guest-edit', component: GuestEdit},
    ];

    const router = new VueRouter({
        routes,
    });

    new Vue({
        el: '#app',
        router,
        data: {
            items: [],
        },
        created() {
            this.init();
            appConfig.route = this.$route.path.split('/')[1];

            //appConfig.url = 'https://jwt-yard.herokuapp.com/';
            appConfig.url = 'http://localhost:3000/';

            appConfig.getAccessToken = () => {
                appConfig.access_token = localStorage.getItem('access_token');
            };

            appConfig.$on('route', route => {
                this.changeRoute(route);
            });

            if (window.ws === undefined) {
                window.ws = new WebSocket('wss://jwt-yard.herokuapp.com');
                //window.ws = new WebSocket('ws://localhost:3000/');
            }

            ws.onmessage = (e) => {
                let messageObject = e.data;
                console.log(messageObject);
                if (messageObject.split('###')[0] !== 'still alive') {
                    this.items.unshift({
                        id: +new Date(),
                        name: messageObject.split('###')[1],
                        date: messageObject.split('###')[2],
                        message: messageObject.split('###')[0]
                    });

                    let notification = new Notification('VU-Demo', {
                        icon: './img/yard.png',
                        body: messageObject.split('###')[0] + ' ' + messageObject.split('###')[1] + ' ' + messageObject.split('###')[2] + ' at ' + messageObject.split('###')[3].split('.')[0]
                    });

                    switch (messageObject.split('###')[0].toLowerCase()) {
                        case 'reload':
                            appConfig.$emit('init', {});
                            break;
                        case 'set':
                            appConfig.$emit('set', {});
                            break;
                        case 'show':
                            appConfig.$emit('show', {});
                            break;
                        case 'get':
                            appConfig.$emit('get', {});
                            break;
                        case 'yard':
                            appConfig.$emit('yard', {});
                            break;
                    }
                }
            };
        },
        methods: {
            init() {
                this.dispatcher = appConfig.route === 'dispatcher';
                this.vehicles = appConfig.route === 'vehicles-table';
                this.locations = appConfig.route === 'locations-table';
                this.operations = appConfig.route === 'operations';
                this.audit = appConfig.route === 'audit';
                this.registration = appConfig.route === 'registration';
                this.driver = appConfig.route === 'driver';
                this.positions = appConfig.route === 'positions';
                this.targets = appConfig.route === 'targets';
                this.map = appConfig.route === 'map';
                this.guests = appConfig.route === 'guests';
            },
            changeRoute(route) {
                closeNav();

                if (route === 'gatekeeper' || route === 'driver') {
                    return;
                }

                appConfig.route = route;
                this.init();

                if (this.$router.currentRoute.path === '/' + route) {
                    return false;
                }

                this.$router.push('/' + route);
                return false;
            },
            emitEvent(event) {
                appConfig.$emit(event, {});
                this.map = true;
                closeNav();
            },
            logout() {
                localStorage.setItem('access_token', null);
                this.changeRoute('login');
                closeNav();
            }
        },
    });

    function openNav() {
        document.getElementById('mySidenav').style.width = '250px';
    }

    function closeNav() {
        document.getElementById('mySidenav').style.width = '0';
        return false;
    }
</script>

