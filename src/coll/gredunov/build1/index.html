<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="logo.jpg"/>
    <title>Gredunov's Collection</title>
    <meta content="width=device-width,initial-scale=1,minimal-ui" name="viewport">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic|Material+Icons">
    <link rel="stylesheet" href="https://unpkg.com/vue-material/dist/vue-material.min.css">
    <link rel="stylesheet" href="https://unpkg.com/vue-material/dist/theme/default.css">

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <link href="https://demos.creative-tim.com/material-kit/assets-old/css/material-kit.min.css?v=2.0.7" rel="stylesheet" />

    <script src="https://unpkg.com/vue"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.2/umd/popper.min.js"></script>
    <script src="https://demos.creative-tim.com/material-kit/assets-old/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="https://demos.creative-tim.com/material-kit/assets-old/js/core/popper.min.js" type="text/javascript"></script>
    <script src="https://demos.creative-tim.com/material-kit/assets-old/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
    <script src="https://demos.creative-tim.com/material-kit/assets-old/js/plugins/moment.min.js"></script>
    <!--	Plugin for the Datepicker, full documentation here: https://github.com/Eonasdan/bootstrap-datetimepicker -->
    <script src="https://demos.creative-tim.com/material-kit/assets-old/js/plugins/bootstrap-datetimepicker.js" type="text/javascript"></script>
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="https://demos.creative-tim.com/material-kit/assets-old/js/plugins/nouislider.min.js" type="text/javascript"></script>
    <!--  Google Maps Plugin  -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>


    <link rel="stylesheet"
          href="css.css">
    <link rel="stylesheet" href="vue-material.min.css">
    <link rel="stylesheet" href="default.css">
    <script src="vue.js"></script>
    <script src="vue-material.min.js"></script>

    <script src="vue-resource.min.js"></script>
    <script src="vue-router.js"></script>

    <script src="axios.min.js"></script>
    <script src="moment.min.js"></script>
</head>

<style>
    ::-webkit-scrollbar {
    }
</style>

<body>
<div id="app">
    <template>
        <div class="page-container" class="sidenav">
            <md-app md-mode="fixed">
                <md-app-toolbar class="md-primary" v-show="login">
                    <md-button class="md-icon-button" @click="menuVisible = !menuVisible">
                        <md-icon>menu</md-icon>
                    </md-button>
                    <span class="md-title" style="color: white;font-size: 22px;font-weight: 900;">Ukraine Arms and Armour Collection of Gredunov Evgeniy</span>
                </md-app-toolbar>

                <md-app-drawer :md-active.sync="menuVisible" md-persistent1="mini"
                               style="background: black; background1: linear-gradient(45deg, black, transparent)">
                    <md-toolbar class="md-transparent" md-elevation="0"
                                style="color: white;font-size: 20px;font-weight: 500;">Gredunov's Collection
                    </md-toolbar>

                    <md-list @click="menuVisible = !menuVisible" style="background: #111; color: white">
                        <md-list-item to="/collection-items" style="color: white">
                            <md-icon style="color: white">camera_alt</md-icon>
                            <span class="md-list-item-text" style="color: white">Table Photos</span>
                        </md-list-item>
                        <md-divider style="background: white"></md-divider>

                        <md-divider style="background: white"></md-divider>
                        <md-list-item to="/table" style="color: white">
                            <md-icon style="color: white">contact_phone</md-icon>
                            <span class="md-list-item-text" style="color: white;">Demo Table</span>
                        </md-list-item>
                        <md-divider style="background: white"></md-divider>

                        <md-list-item to="/pictures">
                            <md-icon style="color: white">camera_alt</md-icon>
                            <span class="md-list-item-text" style="color: white">Pictures</span>
                        </md-list-item>
                        <md-divider style="background: white"></md-divider>

                        <md-list-item to="/users-items" style="color: white">
                            <md-icon style="color: white">people</md-icon>
                            <span class="md-list-item-text" style="color: white">Users</span>
                        </md-list-item>
                        <md-divider style="background: white"></md-divider>

                        <md-list-item to="/audit-items">
                            <md-icon style="color: white">update</md-icon>
                            <span class="md-list-item-text" style="color: white">Audit</span>
                        </md-list-item>
                        <md-divider style="background: white"></md-divider>

                        <md-list-item v-on:click="logout()">
                            <md-icon style="color: white">logout</md-icon>
                            <span class="md-list-item-text" style="color: white">Logout</span>
                        </md-list-item>
                        <md-divider style="background: white"></md-divider>

                    </md-list>
                </md-app-drawer>

                <md-app-content style="background: #eee">
                    <router-view></router-view>
                </md-app-content>
            </md-app>

        </div>
    </template>
</div>

<style lang="scss" scoped>
    .md-app {
        height: 100vh;
    }

    .md-drawer {
        width: 230px;
        max-width: calc(100vw - 125px);
    }

    .md-table {
        height: 88vh;
    }

    .md-title {
        overflow: hidden;
    }

    .md-table-content {
        height: 85vh !important;
        max-height: 85vh !important;
    }

    .md-tabs-navigation {
        background: rgb(238, 238, 238) !important;
    }

    .md-table-cell-container {
        overflow-wrap: break-word !important;
        width: 220px !important;
    }

    .md-app-scroller {
        background: rgb(238, 238, 238) !important;
    }

    .md-table-head-container {
        width: 220px !important;
    }

</style>

</body>
</html>

<script>
    const appConfig = new Vue();
    appConfig.login = false;
    appConfig.allRecords = false;

    const Login = {template: '<login></login>'};

    const Collection = {template: '<collection-items></collection-items>'};
    const CollectionEdit = {template: '<collection-edit></collection-edit>'};
    const CollectionAdd = {template: '<collection-add></collection-add>'};

    const UsersItems = {template: '<users-items></users-items>'};
    const UserAdd = {template: '<user-add></user-add>'};
    const UserEdit = {template: '<user-edit></user-edit>'};

    const AuditItems = {template: '<audit-items></audit-items>'};
    const AuditEdit = {template: '<audit-edit></audit-edit>'};

    const Table = {template: '<tableUI></tableUI>'};
    const Pictures = {template: `
        <div>
            <div style1="width: 49%;padding: 0 5px;overflow-y: scroll;float: right;left: 0;top: 0;height:100vh;">
                <pictures-items></pictures-items>
            </div>
        </div>
    `};

    Vue.component('login', {
        template: `
		    <div style="width:500px; margin: auto; padding-top: 5vh; min-width: 300px">
                <form class="md-layout">
                  <md-card class="md-layout-item md-size-100 md-small-size-50">
                    <md-card-header style="background: #448aff; color: white;margin-bottom: 20px;padding: 10px;">
                      <div class="md-title" style="font-weight: bold;">Ukraine Arms and Armour Collection of Gredunov Evgeniy</div>
                    </md-card-header>

                    <md-card-content style="padding-bottom: 0px;">

                        <md-field :class="messageClassLogin">
                            <label>Login</label>
                            <md-input v-model="login" required v-on:keypress="hasMessagesLogin=false" :disabled="loading"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <md-field :class="messageClassPassword">
                            <label>Password</label>
                            <md-input v-model="password" type="password" required v-on:keypress="hasMessagesPassword=false" :disabled="loading"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <div style="text-align: right; margin-top: 40px;">
                            <span v-if="error" class="md-error" style="color: #ff1744; font-weight: bold">Server response - access denied</span>
                        </div>
                    </md-card-content>

                    <md-progress-bar style="margin-top: 40px;" md-mode="indeterminate" v-if="loading" />

                    <md-card-actions style="margin: 20px;">
                      <md-button class="md-raised md-primary" v-on:click="onLogin" :disabled="loading">Submit</md-button>
                      <md-button class="md-raised md-primary" v-on:click="onClear" :disabled="loading">Clear</md-button>
                    </md-card-actions>
                  </md-card>

                  <md-snackbar :md-active.sync="snackbar" md-position="left" >
                    The login form is shown!
                    <md-button class="md-primary" @click="snackbar = false">Close</md-button>
                  </md-snackbar>
            </form>
  		</div>`,
        data: () => ({
            name: null,
            login: null,
            password: null,
            hasMessagesLogin: false,
            hasMessagesPassword: false,
            snackbar: true,
            loading: false,
            error: false
        }),
        created() {
            this.init();
            appConfig.$emit('logout', {});
        },
        computed: {
            messageClassLogin() {
                return {
                    'md-invalid': this.hasMessagesLogin
                }
            },
            messageClassPassword() {
                return {
                    'md-invalid': this.hasMessagesPassword
                }
            }
        },
        methods: {
            init() {
                window.setTimeout(() => {
                    this.snackbar = false;
                }, 2000)
            },
            onLogin() {
                if (!this.login) {
                    this.hasMessagesLogin = true;
                }

                if (!this.password) {
                    this.hasMessagesPassword = true;
                }

                if (this.login && this.password) {
                    this.loading = true;
                    this.error = false;

                    this.$http.post(appConfig.url + 'api/login', {
                        name: this.login,
                        pass: this.password,
                        description: 'Web'
                    })
                        .then(result => {
                            appConfig.access_token = result.body.token;
                            localStorage.setItem('access_token', result.body.token);
                            this.loading = false;
                            this.error = false;
                            //this.$router.push('phones-items');
                            this.$router.push('collection-items');
                        })
                        .catch((error) => {
                            this.loading = false;
                            this.error = true;
                        })
                }
            },
            onClear() {
                this.login = '';
                this.hasMessagesLogin = false;
                this.password = '';
                this.hasMessagesPassword = false;
                this.error = false;
            },
        }
    });

    Vue.component('collection-items', {
        template: `
		  <div>
		    <md-speed-dial style="position: absolute; z-index: 22; bottom: 100px;right: 100px;">
              <md-speed-dial-target v-on:click="addItem">
                <md-icon>add</md-icon>
              </md-speed-dial-target>
            </md-speed-dial>

			<md-table v-model="searched" md-sort="name" md-sort-order="asc" md-card md-fixed-header>
			  <md-table-toolbar>
				<div class="md-toolbar-section-start">
				  <h1 class="md-title">Items ({{ searched.length }}/{{count}})</h1>
				</div>

                 <div style="position: absolute; z-index: 11; left: 250px; top: 15px;">
                     <md-checkbox v-model="allRecords" v-on:change="allRecordsClick">All records</md-checkbox>
                </div>

				<md-field v-if=byName md-clearable class="md-toolbar-section-end">
				  <md-input placeholder="Search by name..." v-model="search" @input="searchOnTable" />
				  <md-button class="md-primary" v-on:click="onSearch('name')" style="margin-right: 20px;">Search</md-button>
				</md-field>

			  </md-table-toolbar>
              <div style="display: none">{{ searched.length }}</div>

			  <md-table-empty-state>
			    <div v-if="!loading"> No items</div>
			    <md-progress-spinner v-show="loading" :md-diameter="70" :md-stroke="10" md-mode="indeterminate"></md-progress-spinner>
			  </md-table-empty-state>

			    <md-table-row slot="md-table-row" slot-scope="{ item }" v-on:click="showDetails(item)">
			    <md-table-cell md-label="Pic" md-sort-by="pic">
			        <md-avatar class="md-large" style1="width: 126px;height: 115px;">
				        <img :src="item.pic" alt="N">
				    </md-avatar>
				</md-table-cell>
				<md-table-cell md-label="Name" md-sort-by="name">{{ item.name }}</md-table-cell>
				<md-table-cell md-label="Category" md-sort-by="category">{{ item.category }}</md-table-cell>
				<md-table-cell md-label="Description" md-sort-by="description">{{ item.description }}</md-table-cell>
			  </md-table-row>
			</md-table>
  		</div>`,
        data: () => ({
            items: [],
            filteredItems: [],
            recordsCount: 100,
            positionY: 0,
            search: null,
            searched: [],
            loading: true,
            byName: true,
            allRecords: true,
            count: 0,

        }),
        created() {
            this.getItems();
            this.allRecords = JSON.parse(localStorage.getItem('all_records'));
            this.searched = this.items;
            appConfig.$emit('login', {});
        },
        methods: {
            getItems() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }


                this.$http.get(appConfig.url + 'api/items/get')
                    .then(result => {
                        this.count = result.data.length;

                        this.items = [].concat(result.data.sort(this.sort).splice(0, 100));
                        this.filteredItems = [].concat(result.data.sort(this.sort));

                        this.searched = this.items;
                        this.loading = false;
                        setTimeout(() => {
                            //document.querySelector('.md-table-content').addEventListener('scroll', this.handleScroll)
                            if (this.allRecords === true) {
                                this.getItemsAll();
                            }
                        }, 100)
                    })
                    .catch(error => {
                        this.$router.push('login');
                    });
            },
            getItemsAll() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/items/getall')
                    .then(result => {
                        this.count = result.data.length;

                        this.items = [].concat(result.data.sort(this.sort).slice(1299, 2000));
                        this.filteredItems = [].concat(result.data.sort(this.sort));

                        this.searched = this.items;
                        this.loading = false;
                        setTimeout(() => {
                            //document.querySelector('.md-table-content').addEventListener('scroll', this.handleScroll)
                        }, 100)
                    })
                    .catch(error => {
                        this.$router.push('login');
                    });
            },
            allRecordsClick() {
                if (this.allRecords === true) {
                    localStorage.setItem('all_records', 'true');
                } else {
                    localStorage.setItem('all_records', 'false');
                }
                this.getItems()
            },
            onSearch(name) {
                this.loading = true;
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                if (this.search !== null && this.search !== "") {
                    this.loading = true;
                    let url;

                    if (name === 'name') {
                        url = 'api/items/findByName/'
                    } else {
                        url = 'api/items/findByPhone/'
                    }

                    this.$http.get(appConfig.url + url + this.search, {headers: {'Authorization': appConfig.access_token}})
                        .then(result => {
                            this.items = result.data;
                            this.filteredItems = [].concat(result.data.sort(this.sort));
                            this.searched = this.items;
                            this.loading = false;
                        })
                        .catch(error => {
                            this.$router.push('login');
                        });
                }
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            handleScroll() {
                let position = document.querySelector('.md-table-content').scrollTop;
                let items, positionY, recordsCount;
                recordsCount = this.recordsCount;
                positionY = this.positionY;
                console.log('position - ', position);
                console.log('items - ', this.items.length);
                items = [].concat(this.filteredItems.slice(0, recordsCount));
                if (position > positionY) {
                    this.items = [].concat(items.sort(this.sort));
                    this.searched = [].concat(items.sort(this.sort));
                    this.recordsCount = recordsCount + 100;
                    this.positionY = positionY + 5000;
                }
            },
            searchOnTable() {
                this.searched = this.searchByName(this.items, this.search)
            },
            searchByName(items, term) {
                if (term) {
                    return items.filter(item => this.toLower(item.name).includes(this.toLower(term)))
                }
                return items
            },
            searchOnTablePhone() {
                this.searched = this.searchByPhone(this.filteredItems, this.search)
            },
            searchByPhone(items, term) {
                if (term) {
                    return items.filter(item => this.toLower(item.phone).includes(this.toLower(term)))
                }
                return items
            },
            toLower(text) {
                return text.toString().toLowerCase()
            },
            showDetails(item) {
                appConfig.item = item;
                this.$router.push('collection-edit');
            },
            addItem() {
                appConfig.item = null;
                this.$router.push('/collection-add');
            },
        }
    });
    Vue.component('collection-edit', {
        template: `
		    <div style="width:500px; margin: auto; padding-top: 5vh; min-width: 300px">
                <form novalidate class="md-layout">
                  <md-card class="md-layout-item md-size-100 md-small-size-50">
                    <md-card-header style="background: #448aff; color: white;margin-bottom: 20px;padding: 10px;">
                      <div class="md-title" style="font-weight: bold;">{{ form.title }}</div>
                    </md-card-header>

                    <md-card-content style="padding-bottom: 0px;">

                        <!-- <md-avatar style="width: 90%;height: 50%; margin-left:25px; margin-bottom: 20px;">
                               <img :src="form.pic" :alt="form.name" v-on:click="onPhotoClick">
                             </md-avatar>-->

                        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                            <ol class="carousel-indicators">
                                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                                <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                                <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                            </ol>

                            <div class="carousel-inner" style="border-radius: 20px;">
                                    <div v-for="(item, index) in pictures" class="carousel-item" :class="{ 'active' : index === 0 }">
                                        <img class="d-block w-100" :src="item" alt="First slide">
                                    </div>

                                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                </a>
                                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </div>

                        </div>

                        <div class="md-layout-item md-small-size-100">
                          <md-field>
                            <label for="id">ID</label>
                            <md-input name="id" id="id" v-model="form.id" :disabled="true" />
                          </md-field>
                        </div>

                        <div class="md-layout-item md-small-size-100">
                          <md-field :class="messageClassName">
                            <label for="name">Name</label>
                            <md-input name="name" id="name" required v-on:keypress="hasMessagesName=false" v-model="form.name" :disabled1="true" />
                            <span class="md-error">Value is requred</span>
                          </md-field>
                        </div>

                        <div class="md-layout-item md-small-size-100">
                          <md-field :class="messageClassСategory">
                            <label for="category">Сategory</label>
                            <md-input name="category" id="category" required v-on:keypress="hasMessagesСategory=false" autocomplete="category" v-model="form.category" :disabled1="true" />
                            <span class="md-error">Value is requred</span>
                          </md-field>
                        </div>

                        <div class="md-layout-item md-small-size-100">
                          <md-field :class="messageClassGroup">
                            <label for="group">Group</label>
                            <md-input name="group" id="group" required v-on:keypress="hasMessagesGroup=false" autocomplete="group" v-model="form.group" :disabled1="true" />
                            <span class="md-error">Value is requred</span>
                          </md-field>
                        </div>

                        <div class="md-layout-item md-small-size-100">
                          <md-field :class="messageClassDescription">
                            <label for="description">Description</label>
                            <md-input name="description" id="description" required v-on:keypress="hasMessagesDescription=false" autocomplete="description" v-model="form.description" :disabled="false" />
                            <span class="md-error">Value is requred</span>
                          </md-field>
                        </div>

                        <div class="md-layout-item md-small-size-100">
                          <md-field :class="messageClassPhoto">
                            <label for="pic">Photo</label>
                            <md-file v-model="form.placeholder" id="picFileInput" v-on:click="hasMessagesPhoto=false" placeholder="Photo" @change="onSelectFile(form.placeholder)" multiple="multiple"/>
                            <span class="md-error">Value is requred</span>
                          </md-field>
                        </div>

                        <div style="text-align: right; margin-top: 40px;">
                            <span v-if="error" class="md-error" style="color: #ff1744; font-weight: bold; margin-right: 15px;">
                                Something went wrong
                            </span>
                        </div>

                    </md-card-content>

                    <md-progress-bar style="margin-top: 40px;" md-mode="indeterminate" v-if="loading" />

                    <md-dialog-confirm
                          :md-active.sync="dialog"
                          md-title="Delete item?"
                          :md-content=form.title
                          md-confirm-text="Delete"
                          md-cancel-text="Cancel"
                          @md-confirm="onDelete" />

                    <md-card-actions style="margin: 20px;">
                      <md-button class="md-raised md-primary" v-on:click="onItemEdit" :disabled="loading">Submit</md-button>
                      <md-button class="md-raised md-primary" v-on:click="onDeleteDialog" :disabled="loading">Delete</md-button>
                      <md-button type="button" class="md-raised md-primary" v-on:click="back">Back</md-button>
                    </md-card-actions>
                  </md-card>

                  <md-snackbar :md-active.sync="userSaved" md-position="left" >
                    The {{ form.name }} is shown!
                    <md-button class="md-primary" @click="userSaved = false">Close</md-button>
                  </md-snackbar>
                </form>
  		</div>`,
        data: () => ({
            form: {
                title: null,
                id: null,
                name: null,
                category: null,
                group: null,
                description: null,
                pic: '1',
                placeholder: null,
            },
            pictures: [],
            hasMessagesName: false,
            hasMessagesСategory: false,
            hasMessagesGroup: false,
            hasMessagesDescription: false,
            hasMessagesPhoto: false,
            userSaved: true,
            sending: false,
            lastUser: null,
            loading: false,
            error: false,
            snackbar: true,
            dialog: false
        }),
        created() {
            if (!appConfig.item) {
                this.$router.push('/collection-items');
            } else {
                this.init();
            }
        },
        computed: {
            messageClassName() {
                return {
                    'md-invalid': this.hasMessagesName
                }
            },
            messageClassСategory() {
                return {
                    'md-invalid': this.hasMessagesСategory
                }
            },
            messageClassGroup() {
                return {
                    'md-invalid': this.hasMessagesGroup
                }
            },
            messageClassDescription() {
                return {
                    'md-invalid': this.hasMessagesDescription
                }
            },
            messageClassPhoto() {
                return {
                    'md-invalid': this.hasMessagesPhoto
                }
            }
        },
        methods: {
            init() {
                this.form = appConfig.item;

                if (!appConfig.item.pictures) {
                    this.pictures.push(appConfig.item.pic);
                } else {
                    this.pictures = [].concat(appConfig.item.pictures);
                }

                this.form.title = appConfig.item.name;
                window.setTimeout(() => {
                    this.userSaved = false;
                }, 2000);
            },
            onSelectFile(event) {
                let arr = [];
                if (window.File && window.FileList && window.FileReader) {

                    let files = event.target.files;

                    for (let i = 0; i < files.length; i++) {
                        let file = files[i];
                        if (!file.type.match('image')) continue;

                        let picReader = new FileReader();
                        picReader.addEventListener("load", function (event) {
                            let picFile = event.target;
                            arr.push(picFile.result);
                        });
                        picReader.readAsDataURL(file);
                    }
                } else {
                    console.log("Your browser does not support File API");
                }
                window.setTimeout(() => {
                    this.pictures = [].concat(arr);
                    this.form.pic = this.pictures[0];
                }, 100);

            },
            onItemEdit() {
                if (!this.form.name) {
                    this.hasMessagesName = true;
                }

                if (!this.form.category) {
                    this.hasMessagesСategory = true;
                }

                if (!this.form.group) {
                    this.hasMessagesGroup = true;
                }

                if (!this.form.description) {
                    this.hasMessagesDescription = true;
                }

                if (!this.form.pic) {
                    this.hasMessagesPhoto = true;
                }

                if (this.form.name && this.form.category && this.form.group && this.form.description) {
                    this.loading = true;
                    this.error = false;

                    this.$http.post(appConfig.url + 'api/items/update', {
                        id: this.form.id,
                        name: this.form.name,
                        category: this.form.category,
                        group: this.form.group,
                        description: this.form.description,
                        pictures: this.pictures,
                        pic: this.pictures[0],
                        authorization: appConfig.access_token,
                    })
                        .then(result => {
                            this.loading = false;
                            this.error = false;
                            this.$router.push('collection-items');
                        })
                        .catch((error) => {
                            this.loading = false;
                            this.error = true;
                        })
                }
            },
            onPhotoClick() {
                let w = window.open('about:blank');
                let image = new Image();
                image.src = this.form.pic;
                setTimeout(function(){
                    w.document.write(image.outerHTML);
                }, 0);
            },
            onDeleteDialog() {
                this.dialog = true;
            },
            onDelete() {
                this.$http.post(appConfig.url + 'api/items/delete', {
                    id: this.form.id,
                    authorization: appConfig.access_token,
                })
                    .then(result => {
                        this.loading = false;
                        this.error = false;
                        this.$router.push('collection-items');
                    })
                    .catch((error) => {
                        this.loading = false;
                        this.error = true;
                    })
            },
            back() {
                this.$router.push('/collection-items');
            },
        }
    });
    Vue.component('collection-add', {
        template: `
		    <div style="width:500px; margin: auto; padding-top: 5vh; min-width: 300px">
                <form class="md-layout">
                  <md-card class="md-layout-item md-size-100 md-small-size-50">
                    <md-card-header style="background: #448aff; color: white;margin-bottom: 20px;padding: 10px;">
                      <div class="md-title" style="font-weight: bold;">Add item</div>
                    </md-card-header>

                    <md-card-content style="padding-bottom: 0px;">

                        <md-field :class="messageClassName">
                            <label>Name</label>
                            <md-input v-model="form.name" required v-on:keypress="hasMessagesName=false" :disabled="loading"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <md-field :class="messageClassPassword">
                            <label>Category</label>
                            <md-input v-model="form.category" required v-on:keypress="hasMessagesPassword=false" :disabled="loading"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <md-field :class="messageClassPassword">
                            <label>Group</label>
                            <md-input v-model="form.group" required v-on:keypress="hasMessagesPassword=false" :disabled="loading"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <md-field :class="messageClassDescription">
                            <label>Description</label>
                            <md-input v-model="form.description" required v-on:keypress="hasMessagesDescription=false" :disabled="loading"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <div style="text-align: right; margin-top: 40px;">
                            <span v-if="error" class="md-error" style="color: #ff1744; font-weight: bold; margin-right: 15px;">
                                Something went wrong
                            </span>
                        </div>
                    </md-card-content>

                    <md-progress-bar style="margin-top: 40px;" md-mode="indeterminate" v-if="loading" />

                    <md-card-actions style="margin: 20px;">
                      <md-button class="md-raised md-primary" v-on:click="onItemAdd" :disabled="loading">Submit</md-button>
                      <md-button class="md-raised md-primary" v-on:click="onClear" :disabled="loading">Clear</md-button>
                      <md-button class="md-raised md-primary" v-on:click="onBack" :disabled="loading">Back</md-button>
                    </md-card-actions>
                  </md-card>

                  <md-snackbar :md-active.sync="snackbar" md-position="left" >
                    The add form is shown!
                    <md-button class="md-primary" @click="snackbar = false">Close</md-button>
                  </md-snackbar>
            </form>
  		</div>`,
        data: () => ({
            form: {
                title: null,
                id: null,
                name: null,
                category: null,
                group: null,
                description: null,
            },
            hasMessagesName: false,
            hasMessagesPassword: false,
            hasMessagesDescription: false,
            snackbar: true,
            loading: false,
            error: false,
            dialog: false
        }),
        created() {
            this.init();
        },
        computed: {
            messageClassName() {
                return {
                    'md-invalid': this.hasMessagesName
                }
            },
            messageClassPassword() {
                return {
                    'md-invalid': this.hasMessagesPassword
                }
            },
            messageClassDescription() {
                return {
                    'md-invalid': this.hasMessagesDescription
                }
            }
        },
        methods: {
            init() {
                appConfig.getAccessToken();
                window.setTimeout(() => {
                    this.snackbar = false;
                }, 2000)
            },
            onItemAdd() {
                if (!this.form.name) {
                    this.hasMessagesName = true;
                }

                if (!this.form.category) {
                    this.hasMessagesPassword = true;
                }

                if (!this.form.group) {
                    this.hasMessagesPassword = true;
                }

                if (!this.form.description) {
                    this.hasMessagesDescription = true;
                }

                if (this.form.name && this.form.category && this.form.group && this.form.description) {
                    this.loading = true;
                    this.error = false;

                    this.$http.post(appConfig.url + 'api/items/add', {
                        id: +new Date,
                        name: this.form.name,
                        pic: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QBwRXhpZgAATU0AKgAAAAgABAEGAAMAAAABAAIAAAESAAMAAAABAAEAAAEoAAMAAAABAAIAAIdpAAQAAAABAAAAPgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAW6ADAAQAAAABAAAAWAAAAAD/4QkhaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiLz4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8P3hwYWNrZXQgZW5kPSJ3Ij8+AP/AABEIAFgAWwMBEQACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/3QAEAAz/2gAMAwEAAhEDEQA/AP7+KACgAoAKACgAoAKACgAoAKACgAoA/9D+/igAoAKACgAoAKAOd8VeLfDXgjRbnxD4s1my0PR7Qokt7eyMA80mRDa20MaS3N7e3DArbWVnDcXdy/yQQu52104PB4rH144bB0J4ivO7UILaK+KcpO0acIrWVSbjCK1k1dc3Ni8ZhcBQlicZXhh6ELJzqPeT+GEIr3qlST0hTgpTm9IxbspeJD9rf9n48/8ACdXPPr4J8fj9D4XBH4j8q93/AFO4j/6F8f8Awuy7/wCazwf9cuHP+g+f/hBmX/zIKv7Wv7P7EKPHVxliAN3gvx6oyTjlm8MBVHqzHAHJwBR/qfxF/wBC+P8A4XZf+mKb+5feC4x4cen1+evfAZkvxeFSXzdu9j3zR9Z0rxDpdjreh6jZ6tpGp26XWn6jYTx3Npd28n3ZYZo2ZGGQVYZ3I6tG4V1da+erUK2Gq1KGIpzo1qUnCpSqRcZwkt1KLs13Xdaq6dz6KhXo4mlTr4erCtRqxU6dWnJThOL2cZK6f6PR2asaVZGoUAf/0f7+KACgAoAKACgAoA+T/i3cpqfxe0iNFivj8MfhN438dLa3CJc2tj4j114tK8M3pgCzkailvo2um2Mtu8qWzzGzR3mkDfYZNB0smrSfNT/tXOMBgOeLcZVMLh71cVTveK9k5V8Pz2kk5JKbiopnyGcTVXOqCSjU/srJ8fmChJKUaeKxDVLCVOWzaqqGHxPI2pNRcuRXkyzp3hvWJ9N0q4k8Z/ES5lu9K0q8mnTU5o45Zr2wtbmZ40074T6vYpGZbg+WLbUr2FUHEzbHCzUxVCNWtFYHLYqFatCMXRptqMKk4xTdXN6VRu0deelCTf2VeKndLC15UqMnjsyk50aU3JVWk5Tpwk2lTymtTSvLTkrTjb7T15aXiHS9b0PQNV1218X+Ohc6Oul3cMOpXrXWn3fm63pdnLaXlvqfw08ORTW89tdzLKkGoi6XA2REB5YLw1ahXxFHDywWX8tZ1YN0qcYVIctCrNThKjmmJlGUZwi05U+R/wAzuiMTSr4fDVsRDG4/moeymo1anPTnzV6UHCcauWYZOMozkny1eddErScep+CKRaH4x+Nngq1VbbTdP8V6H4y0nTolSO1sLTx1oEU17FYRIdsNpNr2i6xeNGgWMXt1eOFLSvJLyZ83iMFkWOm3KrUwdfA1qju5VJ5fiJRg6jd25xw9ehC7bfJCC0SSj05Co4fG57gYJQpU8ZQx1GkrKFOGYYaLqKnFWUYSxNCvUaSS9pOo9b3l9F18yfTBQB//0v7+KAPzK/aB+LWq6hod18RbyGfxB8NI/Hk/gTwf4Dt9d1fwzpPiOLS4dWg1zxh4svNGeHUNchudZ0i6tND0OWaHS4NPg+1XFvc3cr+b+qcOZPRp4iGWQksNmksvWPxuYSw9DE1cNKrKjKhgsHCtz06DhQrRniK8VKtKrLkjKMIrl/K+JM4rTw8szmpYnK1mLy/BZdHEVsLRxKoqtHEY3GzoONTERlXoTp4fDtxoxpw9pKMpytL5V074yeDtVuvsWn/s2eAprhbTUb/y08V+NAY7PR9Pn1W/uObwbY7Kw09rhj122kKqGk2I/wBbVyLG0Ye0q8T5hGPPSp3eEwLvOtUjSpx+DedSpy9fik9tY/IUs9wVafs6XC2XSmoValljMdpToUpVqktZKyp06Tk3/cja7cYHQfG/xp4L8BePdR8HeFfhF4GS10CDTReX+tzeK72e9u77S9O1QtBHaeJNOhtLWzWaGCE/v3uBAk5kRViC8+Q5fjcxy+ljcXnOYOWIlV5KdCOEpxpwp1atH3nUwtSU5zcXKXw8vNy63bl1Z/j8DluY1cDg8ly9Qw0aXPVxDxc5VJ1KVKt7qhiqUYQppxjH4nLlUr6QRh2mrXsVnY6n4n8AfAr4f6ZqNtFeaXL4t/4WBDq2o2jrE0F5p3hXR/FWr+KJrKVI4HtL6bS7OwvFSI2t26qjLvOhTc6lLCZjxDmVWlNwqrB/2a6NKavzQq4ythKOFjNNyU6aqTqQu+eEbs54V6ihTq4vLeHstpVYxnReO/tKNerB2cZ0sFRxdbFyg1GDhOVKnTn7vJUkopki+KvBlwRFpcv7PclzuSOOLWvDHxt8NWzuWiWHbqd1qt3YW4zFEPMv5rG3h8uF5biKNNyr6ljoa1o8SKFrt0MXkWKktJN3pQw9OpLd6U4zk7tLmvaIsZgZaUZcMuV0ksRgs/wcG7xUbVqmIqU4/CtakqUY8sbtJXj6H8PvjVJ8MNUuPCfxE+HXhTwT4P8AHGnzI3i7wJaXuoi9ifT57G01aw1NNW8SWnizSrdZvI/0C9eTSllkcWoZGs287MciWbUY4zLMzxmOxmAqRf1LMJwpOm1VjUnRqUnRw88HVdr/ALymlW5UubVSPTy3PnlNaWDzTLMHl+BzCm/9ty6E6qqL2cqcK1OqquKhjaMU+VezquVBNvlVnCPt1v8AtG/DCytLa2/4W/pNytnZ2lmkv/CqPGSzSx2NtFZQlo7fxDa2wkNvCmfJhgiLBDtiwSngS4ZzapOU/wCxq0HOc5uP9q4Jxi6kvaSs5YWcmudv4pSe6XMmke/HijKKcIx/tqjJU4Qgn/Y+O5pKnFU43UcRCKfKl8Mbem8c/U/2j/hRqtjcaRffFNl0/Uvs0WpLpvwr8S29zPaQ3sF9JawXt74i1JbF5JLVAl9HYvNAQjQgsiRvrR4XzilUjWp5SvaUud0va5thZRjOVOVNSlCnhaXtLKT/AHcqqUteZq7lHOrxTk9anKjUzb93V5VVVLKMXGUoRnGo4xqVMTVVNtwVqipOUdHG7Vpe4fCr4h+E/Fnxpi8QeEtah1XRPH/w0u7AzxQ3Ns48SfD/AMRxXcumXlrcxxywXtrovjA3GyaJX+zsHEsqSxBPBzjLcZg8jeGxlCVGvl2aQqcspQmvquY4ZwVWE4e7KE6+C5bx05tPds1L3sozLBYzPY4nBV41qGZZVOnzRU4tYrLcUpypTjKzjUjQxzlZpPl11TgfY1fEn2oUAf/T/v4oA/OL4Y/DPwv8V/2c/hz4d8XLqTabZXWqavCulX/9nTm9h1vxLaRtJOIpi0Qhvpw0YC7mERLgJtb9OzTM8XlHEuY4rBOkqs4UqMva0vax9nKhhZtKLnCzvTVnfTVWd7x/M8pynB5zwvleGxvtXShKrWj7Go6UvaRr4qCvJJvl5akvdtq7O6tY888d+Ev2dv2fX/sS+1T4qWNx430W/tr/AE/wxqWmX95deG5i9jqEF/eXumxXVtpuquTaSW9veK10LSYJ9n2yvP6WAxfEvEf7+nSympHAVqcqdTFUatOEMVG1SlKnCnXlCdWivfUpQkoc6b5rxUfMzHB8McNP6vUrZvTlmFCpCpSwlWnVqTwr/d1Y1Kk6SnClWb5HGE1zcjty6yPnfxj410vU9f8AEfxzi0QJqXijXx4f+FOgazDDqYs38O6RplhqfjnWLIRT2Op3Gih9LsvD+mv51jP4nvZriYXQ8OPaXX0uCwNalh8NkDr/ALrCYf6xnGJoSlS5/rNWpOlgKFT3Z0Y17VamJqpqpHCwUY8n1lTj8xjsfRq4nFcQLD2q4vE/Vsmw1eMayg8LQo062YV6aUqdaWHvRp4WjeUHjJuUuf6tyS+o/A37K/gDwl4Uf4v/ALWPiS4fUtVMWoajpOta5f28NpPexmSGy12/tJhrniTxLONzS6fZSBYnR7KG3vBBLO/yWP4uzHGYtZLwfhYqlRvSpVqFCnKVSMHaVShCUVQw2Fi7WqVI+8n7ScqfMoH1mX8IZdg8G864xxUnVrctWrRxGIqRjCVRXjTxFSD9visVLW9OErRt7OMJ8rnLpNM079gD4q3a+ENFtNJ8Pazfyi30y7hh8UeCbue7d1SKHT9S1FLTTbq5mYqltYXn2j7U7BYLS4lGE5q1TxFyiH12vOviaFNc1WDlhcfCMFu6lKnerCKWsqkLciV5TS0l1UqXhxm81gsPToYavUlyUpxjjMvnKbdlGlVqqnTnKT0jSnfnfwwbR8z/ABa+E2p/s2a4nhPxVc3njX4F+PLmaWG58tI9R0m+hESzavp0G77No/j7w3C8V7a3dj5Fh4v0qGbTdQRbSa+stN+pybOKXFGHeMwkYYHiDL4pSim3SrQd+WjVlrKtl+JacJwqKVTB1ZKpTbnGFSr8rnOTVeFsQsHjJ1Mfw9mM5SUrJVaFRWUq9KOkKGZYSLVWE6cY08dRjKlVSg5wh816h4E1208cn4f2SRa1rU+r2ml6RLpxJtNch1RYLnRtWsHkI/4l2q6Xd2mrwySN+5spw05VopAv1NLMcPPL/wC0qjlQoRozq1o1fjw8qTlCvRqJX/e0asJ0ZJLWpG0b3R8vVy/EQzD+zYJV68q8KNF0vgxEaqjOhWpt/wDLqtRnCum37tOTcnGzP0f8A/sX/DrQ7G2l8eS3njbXTGHvIYb280jw3BO6KJLe1trKS21C+t4mDKlxe3cZuMtIbO2DCOL8yzHjfNMRUlHL1DAYe9oN04VsVKKekpzqc1OnKSteFOElHZVJO8j9Ry3gTLMPThLMXPH4i15xU50MLGTWsYQhJVKkU72lUlre7pxvyx9THh7QvCfxs/Zs0Pwxo+n6Bo8F18XTFpulW6WlorTeBJZppDHGB5kssoEkssrSSSOqs8jFUrx5YjEYvIuJq+KrVcTXlHJuarWk5zajj0oq72UU7KMdEttz13hcNgs94Ww+EoU8NQjPOrUqMVCCcsvlKTst25atttt6tux9t18GfdBQB//U/v4oA+Iv2aP+SH+BP+vbWf8A1JNZr77if/ke4/8AxUP/AFFoHw3Cn/JP5d/gr/8AqVXPi39uX/kpvhD/ALEQf+pBqdfc8A/8ivG/9h//ALr0j4PxB/5G2B/7Fz/9Sapzfw206w1X4w/sp6DqUcZ0SPw/4b1OKCfi1u7+78R+MPEt3I0UrKrPd+IbeKzkBZxcGzjijQwskC9GZ1alLJOL8RTk1iHicVSco/HCnTw2Dw0IqUdUoYeTmtI8vO222pTlx5XSp1s74Ow1VL2CwuFrKMvgnVqYnHYucnFtJupioRg9XzezSS5bQPpb9qz4wXnw6/aM8GX+reF7Xxhovg7wG+seE9A1K7ms9Li8WeILvVbJfFM3+i3MV1c6V/ZsEUUfku8SwiSynstQCXC/LcIZJDM+GcdTo4uWCr43MFRxmIpRjOs8Hh4Up/VF78ZRjW9rJt80VLmtUjUprkl9Vxhnc8s4nwNSthIY6hgcudfB4arOVOisbiqlan9bl+7nGc6KoxilyyaWtN06iUz4H8AWV98Qfi54Y0+7sk1W58ceObdNbs4YTHBcWviDVXn8RyRpExayhtLC41C+injlD6etslzHKXt1LfouZTp5bkuKqRqOlDAYBuhUlK8ozw1LlwybatOU6kaVNxaaqczi78x+dZdCpmWdYSnOmq08wzGKxFOMbRnDE1nLFNJa04wpTq1IyTTpcikpNxTP0h+Mzt4t/YbsdY8TX39q6nok3h2TStauCj3OrTaR4z/4RLTNaeVzLuvda8PSveXUyvvna+uAH/elW/L8jX1Pj6dHC0/ZUsQsQqtCN1Giq2B+uVaCX8lDEJQinZL2cXZWSP1DPX9c4Ap1sVU9tVoSwrpV5Wcq0qOOWDpV3LX95iMO3Ock7y9rOzd3zfK3whH2n43/ALNt/cxEXl18ONP+0O+GluH0iPx/4e0y53J5RcLpek6bbwuSz+RbJu86EK0/12cvkyHienF+5HNKnKl8MVWeX4irG3NJK9WtVlK9vem3ZNtR+RyX38/4WqTX7yeU0uZv4pOjHM8NSndNX/dUaUYu9+WP2l8f6q1+TH7EeSa//wAnA/s4/wDXz8Wf/UAmr1qP/JO8S/4co/8AVhE8TF/8lHwx/jzj/wBVsj7Dr4k+zCgD/9X+/igD4i/Zo/5If4E/69tZ/wDUk1mvvuJ/+R7j/wDFQ/8AUWgfDcKf8k/l3+Cv/wCpVc+Lf25f+Sm+EP8AsRB/6kGp19zwD/yK8b/2H/8AuvSPg/EH/kbYH/sXP/1JqniWj6jqd54S8MeKfDUwh8bfA7UjelEJM8vgyfXF1/Q9eit0zLcWvhXxTd6npXiEoyC10rxBokjbLQXksXuV6VKnjMVhMVFywOf0/Zpu3LHHRw7w9fDtu0YzxeEhTq4ZP462Hr6ubhA+fo1a08FhMZhXy4/h6r7Sy+J4CWIWJw+JUFrOGDxdSrQxVmuShiaDdoObj+ld1Y/CX9uDwZ4c1u01Oy8P/ErwpC7XGlXSLqF1o9xcCM6ho+t6R9p06513wreXMCXWnajY3dnPFtSezvrG9OoWbflsZ5zwHjsTQnSqYjK8XJctWF6cK8Y/w61CvyVI0MXCEnCpTnBp6xnTnBU5y/U508m4+wOFxEKtPDZpg03KjNKpOhOaXtKGIoc8JYjCTlFTp1KdSEtFOnVp1HOEbHgv9lG68JNfLJN8PfA+k3unz2fibxF4Oh8X6h421LRJVf8AtbSNO8SeNtf1C28C6XqNsWj1C80e0udUS1MkdvqFvKsd7BOO4wjjPZtRzLH1qdSM8Lhsa8HTwFKuv4NarhcDQhLMK1KdnThWnGi52cqUk3Cd4Hg+WD9prluAo1KcqeKxWBWNqY+rh5J+2oUsVj69RZfRqxuqk6MJ1lBtQrQkozj8/wD7UXxV0b4o3PhP9nT4LNp0vhvw/eQtrGs2skUPhi2h8OWEttbwWt/89uvhbwdpy3mra3rB36ePsVr9kmmFm8r/AEfCeUV8pjjOJs8VSOKxEJKhQmm8VOWKqKUpTp2UvreNqunSoUbOp78ueMedKPzXFucUM2lg+GMi9k8Lhqkfb14NLCQjhabjGMKmsVhMDTUq+Ir2dO9OCpuXJM8X+EevaVrX7T3gBtCLHw1ozQ+EvC0kkZhmutC8O+EtQ0yy1CaFiHjuNYliutcuIpC0sUuoyRyZaIrXu5zhqtDhTMfrCX1qvfG4tJ80YYjE4ylVqU4ySScaMXGhFpWappqydzw8mxNGvxZlzw/+6ULYLBtrllPDYXA1aVOpKLu1KvKM8RKLbknVak1b3f1pr8gP2g8k1/8A5OB/Zx/6+fiz/wCoBNXrUf8AkneJf8OUf+rCJ4mL/wCSj4Y/x5x/6rZH2HXxJ9mFAH//1v7+KAPjH4LWsfhPRdW+Et7Ls8R/DLW9Y025tpQI7jUvD2p6pd614a8UW0W9vM07VdM1KBHlj+S21CC5s5gkybK+6zubxdejm8FfDZpQoVYTWsaWJpUoUMVhJvpVo1aUmovWVOUZq8XzS+JyGKwdCtk1SVsVlVetSlGVlKrhq1adfCYuCv71OtSqxTlFWjVjOm+WScD49/bd8K+Jb3xr4Q8QWGg6vqGjDwm+lyajp2n3V/bwajFrV9ctaXLWiSm2maC4hliE4jWZHPktIySqn2nAmMwtPBY3D1MRRpVvraqqnVqQpylTdCnHnip8vMuaLi+VuzWtro+J4/weKqY/A4mnhq9WgsHKi6tKlOrGNVV5y5JezUnBuMlJcySl9m9ny/HuhW/jvw5qtjr2gaT4p07VLCSd7W9t/D+pv8nkFL62milsZ7a8sbmylkt9TsLuKezu7GeW3vYJLaV0f7TETy7FUamHxNfCVaVRRU4SxNJa816c4uNWM4VIzSlSqQlCcJxUoTUlePw+HhmGFrU8ThqONp1qbbhUjhaz05bVIyjKlKFSnODcatOacJ05ONSM4u0fRo9N0XW7+DVj4Z+Inwi8Txkvcaj4S8K61rPhP7QhmM13p2nfatI8TeEi5gui+n6dqWuaZbmOWKyt7G2jeFPLdWvh6bo/WsszrCPSNPGYuhQxii+XlhUqtVcLjLXharVp4erLmTnKcmmeoqWHxFSNb6pmmSYtayq4LBYivguZX5p0qSlRxmCb5Z/uqVfEUY2cYU6UU+Xe1TS9e1yyWz8U/GP4s+LNJAWNNH0/wT8Ttcluo9suFjtfFep6LpBXNqVDXFzLzG5Nu4ilC89Kth6E+fCZJk2ErO7darj8roKDfLq5YSliKy+L7C7JcvMnLorUcRiKahjM8zrGUNlQpZdm9eU1Z7QxlWhQfwf8vG9tYvlaOR1R/ENppF74W8BfDjxl4Z8P6nHHBr1/faLrOpeLvFlvBLHPDaa3qsOlWtpp+iJcRRXI8L6Ha2umPcxQy6nc6zLbWs8XbRWFnXp4zMc0wWLxNJuWHpU69ClgsHKScXOhSlVnOriOVuP1vETlVUZNUo0VKcZcVV4mFCpg8uyrH4TDVUo4mpUw+Iq43Gxi1KMMRWjQhClh1JKX1PDQhRcknVlXcYyj6B+zJ8PfHL/GfwbrM3hLxDYaR4fur3U9X1PVNIv9LsrW2k0W/toF+0X9vbpNcXM15AtvbQCWaRXMuwQo8q+fxVmWX/2JjaEcZhqlbEwhSo0qVanVqTkq1OUny05SajGMW5SlaK2vd2PS4UyzMHnuBrvBYqnRw06lWtVrUKtGnCLw9WEVzVYRUpTlUjywjzSabekYylL9dAM8DkngAd6/HD9rPNdJtYvGfx98LTaaWns/g5ofie+8QajCQ1pb+JfGtjBoWl+GWlUsj6lDo6anq+oWy/PYxPpwufKkuY0l9GvN4Lh3Fqr7s86xGEp4am1ac8Lgakq9XFJXuqTreyo052tUaq8qkoucfIpRjj+IsI6XvQyOhi6mJqx1hHFY+nHD0cLdaOrGgq1arBa006XPyucYy+sq+OPrwoA//9f+/igDzjx38KvB3xCe1vNatL2y17ToXt9J8V+HdSu9A8VaVBJIJpLez1vTZYbo2ckgLvYXZutPaRjM1oZtrr6eX5vjctU4UJwqYerJSrYTE0oYjCVZJcqlOhUTiqiWiqw5KiWinyto8zMMowWZOFSvCpTxFKLjRxmGqzw2Moxbu408RScZ8jau6c+em3q4OSvHy0fsz26nI+OH7QoJGCR8QNOBI9M/8IyeAf8AIr1v9aZvfIeHP/DdUf8A7t/18jyP9VorbP8AiT/w5UV/7o/18yX/AIZtX5v+L6/tFfNw3/FxLD5hjGG/4pnnjjndx+VT/rO/+hBw1pt/wmVP/mvQr/Vf/qoeJv8Aw509f/LP8+b9BP8AhmxBjHx0/aJGCCP+Lh6fwQSQR/xTHBBJI6cscYySz/1nf/Qg4b/8NtT/AOa/6+Qv9V/+qg4l/wDDnS/+Yv8ALytq5L/wzauc/wDC9f2is5zn/hYlhnPHP/Is9flXv/CPQbV/rO/+hBw1/wCGyp/81+b/AKY/9V/+qh4m/wDDnT/+Y/16enKD9m1Vzt+Ov7RS5wDj4iWAyAMKD/xTI6Dgeg9MgKf6zv8A6EHDX/hsqf8AzX/XzD/Vf/qoeJl/3U6f/wAxrb+raKMZ/Zogbr8cf2hjj1+IOnH/AN1lf8+n8Vf60SW2Q8Of+G6ov/dv+vmL/VaL3z/iX/w5UX/7o/18h0f7M2mb1+2/GH4+apaE4uNOvfiGkVpeREYaC4fTdGsb4RODh/s13BIR8vmBSwpPimtZ+zyXh+jP7NWnlt5wfSUVUxFSF105oSXk7e6R4VpXXtM74iqw+1TnmajCa6xk6WEpVEn15KkX0va6PcvCvhDw14H0eLQfCejWeiaVFNNcm2tEbdcXdwwa5vr25meW71DULpgGur++nuLy5ZVM88pVSvg4vG4rH1niMZWnXrNKPNNr3YR0jTpxilCnTgtIU6cYQitIxR7+EwWFwFFYfB0IUKKlKfJBP3pzd51KkpNzqVJvWdSpKc5PWUmdJXKdQUAf/9D+/igAoAKACgAoAKACgAoAKACgAoAKAP/R/v4oAKACgAoAKACgAoAKACgAoAKACgD/2Q==',
                        category: this.form.category,
                        group: this.form.group,
                        description: this.form.description,
                        authorization: appConfig.access_token,
                    })
                        .then(result => {
                            this.loading = false;
                            this.error = false;
                            this.$router.push('collection-items');
                        })
                        .catch((error) => {
                            this.loading = false;
                            this.error = true;
                            window.setTimeout(() => {
                                this.$router.push('login');
                            }, 1000)
                        })
                }
            },
            onBack() {
                this.$router.push('/collection-items');
            },
            onClear() {
                this.form.name = '';
                this.hasMessagesName = false;
                this.form.pass = '';
                this.hasMessagesPassword = false;
                this.form.description = '';
                this.hasMessagesDescription = false;
                this.error = false;
            },
        }
    });

    Vue.component('users-items', {
        template: `
		  <div>
		  <md-speed-dial style="position: absolute; z-index: 22; bottom: 100px;right: 100px;">
              <md-speed-dial-target v-on:click="addItem">
                <md-icon>add</md-icon>
              </md-speed-dial-target>
            </md-speed-dial>

			<md-table v-model="searched" md-sort="name" md-sort-order="asc" md-card md-fixed-header>
			  <md-table-toolbar>
				<div class="md-toolbar-section-start">
				  <h1 class="md-title">Users ({{ searched.length }})</h1>
				</div>

				<md-field md-clearable class="md-toolbar-section-end">
				  <md-input placeholder="Search by name..." v-model="search" @input="searchOnTable"/>
				</md-field>
			  </md-table-toolbar>
              <div style="display: none">{{ searched.length }}</div>

			  <md-table-empty-state>
			    <div v-if="!loading"> No items</div>
			    <md-progress-spinner v-show="loading" :md-diameter="70" :md-stroke="10" md-mode="indeterminate"></md-progress-spinner>
			  </md-table-empty-state>

			  <md-table-row slot="md-table-row" slot-scope="{ item }" v-on:click="showDetails(item)">
				<md-table-cell md-label="Login" md-sort-by="name">{{ item.name }}</md-table-cell>
				<md-table-cell md-label="Password" md-sort-by="pass">{{ item.pass }}</md-table-cell>
				<md-table-cell md-label="Description" md-sort-by="description">{{ item.description }}</md-table-cell>
			  </md-table-row>
			</md-table>

  		</div>`,
        data: () => ({
            items: [],
            search: null,
            count: 0,
            searched: [],
            loading: true
        }),
        created() {
            this.getItems();
            this.searched = this.items;
            appConfig.$emit('login', {});
        },
        methods: {
            getItems() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/users/get', {headers: {'Authorization': appConfig.access_token}})
                    .then(result => {
                        this.items = result.data.sort(this.sort);
                        this.filteredItems = result.data.sort(this.sort);
                        this.searched = this.items;
                        this.loading = false;
                    })
                    .catch(error => {
                        this.$router.push('login');
                    });
            },
            sort (a, b) {
                let nameA = a.name.toLowerCase();
                let nameB = b.name.toLowerCase();
                if (nameA < nameB) {
                    return -1
                }
                if (nameA > nameB) {
                    return 1
                }
                return 0
            },
            searchOnTable() {
                this.searched = this.searchByName(this.items, this.search)
            },
            searchByName(items, term) {
                if (term) {
                    return items.filter(item => this.toLower(item.name).includes(this.toLower(term)))
                }
                return items
            },
            toLower(text) {
                return text.toString().toLowerCase()
            },
            showDetails(item) {
                appConfig.item = item;
                this.$router.push('/user-edit');
            },
            addItem() {
                appConfig.item = null;
                this.$router.push('/user-add');
            },
        }
    });
    Vue.component('user-edit', {
        template: `
		    <div style="width:500px; margin: auto; padding-top: 5vh; min-width: 300px">
                <form class="md-layout">
                  <md-card class="md-layout-item md-size-100 md-small-size-50">
                    <md-card-header style="background: #448aff; color: white;margin-bottom: 20px;padding: 10px;">
                      <div class="md-title" style="font-weight: bold;">{{ form.title }}</div>
                    </md-card-header>

                    <md-card-content style="padding-bottom: 0px;">

                        <md-field>
                            <label>ID</label>
                            <md-input v-model="form.id" :disabled="true"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <md-field :class="messageClassName">
                            <label>Name</label>
                            <md-input v-model="form.name" required v-on:keypress="hasMessagesName=false" :disabled="loading"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <md-field :class="messageClassPassword">
                            <label>Password</label>
                            <md-input v-model="form.pass" required v-on:keypress="hasMessagesPassword=false" :disabled="loading"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <md-field :class="messageClassDescription">
                            <label>Description</label>
                            <md-input v-model="form.description" required v-on:keypress="hasMessagesDescription=false" :disabled="loading"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <div style="text-align: right; margin-top: 40px;">
                            <span v-if="error" class="md-error" style="color: #ff1744; font-weight: bold; margin-right: 15px;">
                                Something went wrong
                            </span>
                        </div>
                    </md-card-content>

                    <md-progress-bar style="margin-top: 40px;" md-mode="indeterminate" v-if="loading" />

                    <md-dialog-confirm
                          :md-active.sync="dialog"
                          md-title="Delete user?"
                          :md-content=form.title
                          md-confirm-text="Delete"
                          md-cancel-text="Cancel"
                          @md-confirm="onDelete" />

                    <md-card-actions style="margin: 20px;">
                      <md-button class="md-raised md-primary" v-on:click="onUserEdit" :disabled="loading">Submit</md-button>
                      <md-button class="md-raised md-primary" v-on:click="onDeleteDialog" :disabled="loading">Delete</md-button>
                      <md-button class="md-raised md-primary" v-on:click="onBack" :disabled="loading">Back</md-button>
                    </md-card-actions>
                  </md-card>

                  <md-snackbar :md-active.sync="snackbar" md-position="left" >
                    The login form is shown!
                    <md-button class="md-primary" @click="snackbar = false">Close</md-button>
                  </md-snackbar>
            </form>
  		</div>`,
        data: () => ({
            form: {
                title: null,
                id: null,
                name: null,
                pass: null,
                description: null,
            },
            hasMessagesName: false,
            hasMessagesPassword: false,
            hasMessagesDescription: false,
            snackbar: true,
            loading: false,
            error: false,
            dialog: false
        }),
        created() {
            if (!appConfig.item) {
                this.$router.push('/users-items');
            } else {
                this.init();
            }
        },
        computed: {
            messageClassName() {
                return {
                    'md-invalid': this.hasMessagesName
                }
            },
            messageClassPassword() {
                return {
                    'md-invalid': this.hasMessagesPassword
                }
            },
            messageClassDescription() {
                return {
                    'md-invalid': this.hasMessagesDescription
                }
            }
        },
        methods: {
            init() {
                this.form = appConfig.item;
                this.form.title = appConfig.item.name;
                window.setTimeout(() => {
                    this.snackbar = false;
                }, 2000)
            },
            onUserEdit() {
                if (!this.form.name) {
                    this.hasMessagesName = true;
                }

                if (!this.form.pass) {
                    this.hasMessagesPassword = true;
                }

                if (!this.form.description) {
                    this.hasMessagesDescription = true;
                }

                if (this.form.name && this.form.pass && this.form.description) {
                    this.loading = true;
                    this.error = false;

                    this.$http.post(appConfig.url + 'api/users/update', {
                        id: this.form.id,
                        name: this.form.name,
                        pass: this.form.pass,
                        description: this.form.description,
                        authorization: appConfig.access_token,
                    })
                        .then(result => {
                            this.loading = false;
                            this.error = false;
                            this.$router.push('users-items');
                        })
                        .catch((error) => {
                            this.loading = false;
                            this.error = true;
                        })
                }
            },
            onDeleteDialog() {
                this.dialog = true;
            },
            onDelete() {
                this.$http.post(appConfig.url + 'api/users/delete', {
                    id: this.form.id,
                    authorization: appConfig.access_token,
                })
                    .then(result => {
                        this.loading = false;
                        this.error = false;
                        this.$router.push('users-items');
                    })
                    .catch((error) => {
                        this.loading = false;
                        this.error = true;
                    })
            },
            onBack() {
                this.$router.push('/users-items');
            },
            onClear() {
                this.login = '';
                this.hasMessagesLogin = false;
                this.password = '';
                this.hasMessagesPassword = false;
                this.error = false;
            },
        }
    });
    Vue.component('user-add', {
        template: `
		    <div style="width:500px; margin: auto; padding-top: 5vh; min-width: 300px">
                <form class="md-layout">
                  <md-card class="md-layout-item md-size-100 md-small-size-50">
                    <md-card-header style="background: #448aff; color: white;margin-bottom: 20px;padding: 10px;">
                      <div class="md-title" style="font-weight: bold;">Add item</div>
                    </md-card-header>

                    <md-card-content style="padding-bottom: 0px;">

                        <md-field :class="messageClassName">
                            <label>Name</label>
                            <md-input v-model="form.name" required v-on:keypress="hasMessagesName=false" :disabled="loading"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <md-field :class="messageClassPassword">
                            <label>Password</label>
                            <md-input v-model="form.pass" required v-on:keypress="hasMessagesPassword=false" :disabled="loading"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <md-field :class="messageClassDescription">
                            <label>Description</label>
                            <md-input v-model="form.description" required v-on:keypress="hasMessagesDescription=false" :disabled="loading"></md-input>
                            <span class="md-error">Value is requred</span>
                        </md-field>

                        <div style="text-align: right; margin-top: 40px;">
                            <span v-if="error" class="md-error" style="color: #ff1744; font-weight: bold; margin-right: 15px;">
                                Something went wrong
                            </span>
                        </div>
                    </md-card-content>

                    <md-progress-bar style="margin-top: 40px;" md-mode="indeterminate" v-if="loading" />

                    <md-card-actions style="margin: 20px;">
                      <md-button class="md-raised md-primary" v-on:click="onUserAdd" :disabled="loading">Submit</md-button>
                      <md-button class="md-raised md-primary" v-on:click="onClear" :disabled="loading">Clear</md-button>
                      <md-button class="md-raised md-primary" v-on:click="onBack" :disabled="loading">Back</md-button>
                    </md-card-actions>
                  </md-card>

                  <md-snackbar :md-active.sync="snackbar" md-position="left" >
                    The add form is shown!
                    <md-button class="md-primary" @click="snackbar = false">Close</md-button>
                  </md-snackbar>
            </form>
  		</div>`,
        data: () => ({
            form: {
                title: null,
                id: null,
                name: null,
                pass: null,
                description: null,
            },
            hasMessagesName: false,
            hasMessagesPassword: false,
            hasMessagesDescription: false,
            snackbar: true,
            loading: false,
            error: false,
            dialog: false
        }),
        created() {
            this.init();
        },
        computed: {
            messageClassName() {
                return {
                    'md-invalid': this.hasMessagesName
                }
            },
            messageClassPassword() {
                return {
                    'md-invalid': this.hasMessagesPassword
                }
            },
            messageClassDescription() {
                return {
                    'md-invalid': this.hasMessagesDescription
                }
            }
        },
        methods: {
            init() {
                appConfig.getAccessToken();
                window.setTimeout(() => {
                    this.snackbar = false;
                }, 2000)
            },
            onUserAdd() {
                if (!this.form.name) {
                    this.hasMessagesName = true;
                }

                if (!this.form.pass) {
                    this.hasMessagesPassword = true;
                }

                if (!this.form.description) {
                    this.hasMessagesDescription = true;
                }

                if (this.form.name && this.form.pass && this.form.description) {
                    this.loading = true;
                    this.error = false;

                    this.$http.post(appConfig.url + 'api/users/add', {
                        id: +new Date,
                        name: this.form.name,
                        pass: this.form.pass,
                        description: this.form.description,
                        authorization: appConfig.access_token,
                    })
                        .then(result => {
                            this.loading = false;
                            this.error = false;
                            this.$router.push('users-items');
                        })
                        .catch((error) => {
                            this.loading = false;
                            this.error = true;
                        })
                }
            },
            onBack() {
                this.$router.push('/users-items');
            },
            onClear() {
                this.form.name = '';
                this.hasMessagesName = false;
                this.form.pass = '';
                this.hasMessagesPassword = false;
                this.form.description = '';
                this.hasMessagesDescription = false;
                this.error = false;
            },
        }
    });

    Vue.component('audit-items', {
        template: `
		  <div>
			<md-table v-model="searched" md-sort="date" md-sort-order="desc" md-card md-fixed-header>
			  <md-table-toolbar>
				<div class="md-toolbar-section-start">
				  <h1 class="md-title">Audit ({{ searched.length }})</h1>
				</div>

				<md-field md-clearable class="md-toolbar-section-end">
				  <md-input placeholder="Search by name..." v-model="search" @input="searchOnTable" />
				</md-field>
			  </md-table-toolbar>
              <div style="display: none">{{ searched.length }}</div>

			  <md-table-empty-state>
			    <div v-if="!loading"> No items</div>
			    <md-progress-spinner v-show="loading" :md-diameter="70" :md-stroke="10" md-mode="indeterminate"></md-progress-spinner>
			  </md-table-empty-state>

			  <md-table-row slot="md-table-row" slot-scope="{ item }" v-on:click1="showDetails(item)">
				<md-table-cell md-label="Date" md-sort-by="date">{{ item.date }}</md-table-cell>
				<md-table-cell md-label="Name" md-sort-by="name">{{ item.name }}</md-table-cell>
				<md-table-cell md-label="Description" md-sort-by="description">{{ item.description }}</md-table-cell>

			  </md-table-row>
			</md-table>
  		</div>`,
        data: () => ({
            items: [],
            filteredItems: [],
            recordsCount: 20,
            positionY: 0,
            search: null,
            searched: [],
            loading: true,
        }),
        created() {
            this.getItems();
            this.searched = this.items;
            appConfig.$emit('login', {});
        },
        methods: {
            getItems() {
                appConfig.getAccessToken();

                if (!appConfig.access_token) {
                    this.$router.push('login');
                    return;
                }

                this.$http.get(appConfig.url + 'api/audit/get', {headers: {'Authorization': appConfig.access_token}})
                    .then(result => {
                        this.items = result.data;
                        this.filteredItems = result.data;
                        this.searched = this.items;
                        this.loading = false;
                        setTimeout(() => {
                            //document.querySelector('.md-table-content').addEventListener('scroll', this.handleScroll)
                        }, 100)
                    })
                    .catch(error => {
                        this.$router.push('login');
                    });
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            handleScroll() {
                let position = document.querySelector('.md-table-content').scrollTop;
                let items, positionY, recordsCount;
                recordsCount = this.recordsCount;
                positionY = this.positionY;
                items = this.filteredItems.slice(0, recordsCount);
                if (position > positionY) {
                    this.items = items;
                    this.searched = items;
                    this.recordsCount = recordsCount + 10;
                    this.positionY = positionY + 200;
                }
            },
            searchOnTable() {
                this.searched = this.searchByName(this.filteredItems, this.search)
            },
            searchByName(items, term) {
                if (term) {
                    return items.filter(item => this.toLower(item.name).includes(this.toLower(term)))
                }
                return items
            },
            toLower(text) {
                return text.toString().toLowerCase()
            },
            showDetails(item) {
                appConfig.item = item;
                this.$router.push('phone-edit');
            },
        }
    });

    Vue.component('tableUI', {
        template: `
		  <div>
			<md-table v-model="searched" md-sort="name" md-sort-order="asc" md-card md-fixed-header>
			  <md-table-toolbar>
				<div class="md-toolbar-section-start">
				  <h1 class="md-title">Pictures ({{ searched.length }})</h1>
				</div>

				<md-field md-clearable class="md-toolbar-section-end">
				  <md-input placeholder="Search by name..." v-model="search" @input="searchOnTable" />
				</md-field>
			  </md-table-toolbar>

			  <md-table-empty-state>
                <md-progress-spinner :md-diameter="70" :md-stroke="10" md-mode="indeterminate"></md-progress-spinner>
			  </md-table-empty-state>
              <div style="display: none">{{ searched.length }}</div>

			  <md-table-empty-state>
			    <div v-if="!loading"> No items</div>
			    <md-progress-spinner v-show="loading" :md-diameter="70" :md-stroke="10" md-mode="indeterminate"></md-progress-spinner>
			  </md-table-empty-state>

			  <md-table-row slot="md-table-row" slot-scope="{ item }" v-on:click="showDetails(item)">
			    <md-table-cell md-label="Pic" md-sort-by="pic">
			    <md-avatar class="md-large" style="width: 126px;height: 115px;">
				  <img :src="item.pic" alt="People">
				</md-avatar></md-table-cell>
				<md-table-cell md-label="Name" md-sort-by="name">{{ item.name }}</md-table-cell>
				<md-table-cell md-label="Category" md-sort-by="category">{{ item.category }}</md-table-cell>
				<md-table-cell md-label="Description" md-sort-by="description">{{ item.description }}</md-table-cell>
			  </md-table-row>
			</md-table>
  		</div>`,
        data: () => ({
            items: [],
            filteredItems: [],
            search: null,
            searched: [],
            loading: true,
            byName: true,
        }),
        created() {
            this.getItems();
            this.searched = this.items;
            appConfig.$emit('login', {});
        },
        methods: {
            getItems() {
                this.$http.get(appConfig.url + 'api/pic/get')
                    .then(result => {
                        this.items = [].concat(result.data.sort(this.sort));
                        this.filteredItems = [].concat(result.data.sort(this.sort));
                        this.searched = this.items;
                        console.log('this.searched ',this.searched.length)
                        this.loading = false;
                        setTimeout(() => {
                            //document.querySelector('.md-table-content').addEventListener('scroll', this.handleScroll)
                            this.getItemsAll();
                        }, 100)
                    })
                    .catch(error => {
                    });
            },
            getItemsAll() {
                this.$http.get(appConfig.url + 'api/pic/getall')
                    .then(result => {
                        this.items = [].concat(result.data.sort(this.sort));
                        this.filteredItems = [].concat(result.data.sort(this.sort));
                        this.searched = this.items;
                        this.loading = false;
                    })
                    .catch(error => {
                    });
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            newUser() {
                window.alert('Noop')
            },
            searchOnTable() {
                this.searched = this.searchByName(this.filteredItems, this.search)
                console.log('this.searched ',this.searched.length)
            },
            searchByName(items, term) {
                if (term) {
                    return items.filter(item => this.toLower(item.name).includes(this.toLower(term)))
                }
                return items
            },
            toLower(text) {
                return text.toString().toLowerCase()
            },
            showDetails(item) {
                appConfig.item = item;
                this.$router.push('collection-edit');
            },
        }
    });
    Vue.component('pictures-items', {
        template: `
		<div>
		<md-card class="md-layout-item " style="position: fixed; z-index: 5; width1: 100%; margin: 0px; padding: 0px; margin-top: -12px;">
		 <md-card-header>
          <div class="md-title">Pictures ({{ searched.length }})</div>
        </md-card-header>
            <md-card-content style="padding-bottom: 0px;">
				<md-field md-clearable class="md-toolbar-section-end" style="width:250px">
				  <md-input placeholder="Search by name..." v-model="search" @input="searchOnTable" />
				</md-field>
            </md-card-content>

            <md-card-actions style="margin-bottom: 20px;">
                   <!--   <md-button type="button" class="md-raised md-primary">Back</md-button>-->
                    </md-card-actions>
            </md-card>


            <md-empty-state v-if="loading" style="padding-top: 35vh;">
                <md-progress-spinner :md-diameter="70" :md-stroke="10" md-mode="indeterminate"></md-progress-spinner>
            </md-empty-state>

			<md-list v-if="!loading" class="md-triple-line" v-for="item in searched" v-bind:key="item.id" style="background: rgb(238, 238, 238);">
			  <md-list-item style="background: rgb(238, 238, 238);">
                  <md-card md-with-hover style="width: 50%; margin: auto;">
                        <md-card-header>
                          <div class="md-title">{{item.name}}</div>
                          <div class="md-subhead">{{item.category}}</div>
                          <div class="md-subhead">{{item.group}}</div>
                        </md-card-header>
                        <md-card-content style="margin-left: 60px">
                            <md-avatar style="width: 90%;height: 50%; margin-bottom: 20px;">
                              <img :src="item.pic" :alt="item.name" v-on:click="onPhotoClick(item.pic)">
                            </md-avatar>
                        </md-card-content>
                  </md-card>
               </md-list-item>
			</md-list>
  		</div>`,
        data: () => ({
            items: [],
            loading: true,
            filteredItems: [],
            search: null,
            searched: [],
        }),
        created() {
            this.getItems();
            appConfig.$emit('login', {});
        },
        methods: {
            getItems() {
                this.$http.get(appConfig.url + 'api/pic/get')
                    .then(result => {
                        this.items = [].concat(result.data.sort(this.sort));
                        this.filteredItems = [].concat(result.data.sort(this.sort));
                        this.searched = this.items;
                        this.loading = false;
                        setTimeout(() => {
                            //document.querySelector('.md-table-content').addEventListener('scroll', this.handleScroll)
                            this.getItemsAll();
                        }, 100)
                    })
                    .catch(error => {
                    });
            },
            getItemsAll() {
                this.$http.get(appConfig.url + 'api/pic/getall')
                    .then(result => {
                        this.items = [].concat(result.data.sort(this.sort));
                        this.filteredItems = [].concat(result.data.sort(this.sort));
                        this.searched = this.items;
                        this.loading = false;
                    })
                    .catch(error => {
                    });
            },
            sort(a, b) {
                return parseInt(b.id) - parseInt(a.id);
            },
            searchOnTable() {
                this.searched = this.searchByName(this.filteredItems, this.search)
            },
            searchByName(items, term) {
                if (term) {
                    return items.filter(item => this.toLower(item.name).includes(this.toLower(term)))
                }
                return items
            },
            toLower(text) {
                return text.toString().toLowerCase()
            },
            onPhotoClick(pic) {
                let w = window.open('about:blank');
                let image = new Image();
                image.src = pic;
                setTimeout(function(){
                    w.document.write(image.outerHTML);
                }, 0);
            },
        }
    });

    Vue.use(VueMaterial.default);

    const routes = [
        {path: '/', component: Login},
        {path: '*', component: Login},
        {path: '/login', component: Login},

        {path: '/collection-items', component: Collection},
        {path: '/collection-edit', component: CollectionEdit},
        {path: '/collection-add', component: CollectionAdd},

        {path: '/users-items', component: UsersItems},
        {path: '/user-add', component: UserAdd},
        {path: '/user-edit', component: UserEdit},

        {path: '/audit-items', component: AuditItems},
        {path: '/audit-edit', component: AuditEdit},

        {path: '/table', component: Table},
        {path: '/pictures', component: Pictures},
    ];

    const router = new VueRouter({
        routes,
    });

    new Vue({
        el: '#app',
        router,
        data: () => ({
            menuVisible: false,
            login: appConfig.login,
        }),
        created() {
            this.init();
            appConfig.route = this.$route.path.split('/')[1];

            //appConfig.url = 'https://gredunov.herokuapp.com/';
            appConfig.url = 'http://localhost:3000/';

            appConfig.getAccessToken = () => {
                appConfig.access_token = localStorage.getItem('access_token');
            };

            appConfig.$on('route', route => {
                this.changeRoute(route);
            });

            appConfig.$on('login', () => {
                this.login = true;
            });

            appConfig.$on('logout', () => {
                this.login = false;
            });
        },
        methods: {
            init() {
            },
            changeRoute(route) {
                appConfig.route = route;
                this.init();

                if (this.$router.currentRoute.path === '/' + route) {
                    return false;
                }

                this.$router.push('/' + route);
                return false;
            },
            emitEvent(event) {
                appConfig.$emit(event, {});
                this.map = true;
                closeNav();
            },
            logout() {
                localStorage.setItem('access_token', null);
                this.changeRoute('login');
                appConfig.$emit('logout', {});
            }
        },
    })
</script>
